C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.1\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051
                    -_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption functions are in this file.
  39          * \date         October 01, 2017
  40          * \author       _Centro "E.Piaggio"_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          
  50          #include "globals.h"
  51          #include "utils.h"
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 2   

  53          //===================================================================     global
  54          
  55          
  56          // PWM vaules needed to obtain 8 Volts given a certain input tension
  57          // Numbers are sperimentally calculated //[index] (milliampere)
  58          CYCODE uint8 pwm_preload_values[29] = {100,    //0 (11500)
  59                                                       100,//83
  60                                                       100,//78
  61                                                        76,
  62                                                        74,
  63                                                        72,    //5 (14000)
  64                                                        70,
  65                                                        68,
  66                                                        67,
  67                                                        65,
  68                                                        64,    //10 (16500)
  69                                                        63,
  70                                                        62,
  71                                                        61,
  72                                                        60,
  73                                                        59,    //15 (19000)
  74                                                        58,
  75                                                        57,
  76                                                        56,
  77                                                        56,
  78                                                        55,    //20 (21500)
  79                                                        54,
  80                                                        54,
  81                                                        53,
  82                                                        52,
  83                                                        52,    //25 (24000)
  84                                                        52,
  85                                                        51,
  86                                                        51};   //28 (25500)
  87          
  88          CYCODE uint8 hitech_pwm_preload_values[36] = {  100,   //0 (8000)
  89                                                          76,
  90                                                          71,
  91                                                          69,
  92                                                          67,
  93                                                          65,     //5 (10500)
  94                                                          63,
  95                                                          61,
  96                                                          60,
  97                                                          58,
  98                                                          57,     //10 (13000)
  99                                                          56,
 100                                                          55,
 101                                                          54,
 102                                                          53,
 103                                                          52,     //15 (15500)
 104                                                          51,
 105                                                          50,
 106                                                          49,
 107                                                          49,
 108                                                          48,     //20 (18000)
 109                                                          47,
 110                                                          47,
 111                                                          46,
 112                                                          45,
 113                                                          45,     //25 (20500)
 114                                                          45,
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 3   

 115                                                          44,
 116                                                          44,
 117                                                          43,
 118                                                          43,     //30 (23000)
 119                                                          43,
 120                                                          43,
 121                                                          42,
 122                                                          42,
 123                                                          42};    //35 (25500)
 124          
 125          CYCODE uint8 hitech_pwm_preload_values_6v[32] = {100,   //0 (6000)
 126                                                            76,
 127                                                            71,
 128                                                            68,
 129                                                            66,
 130                                                            64,   //5 (8750)
 131                                                            62,
 132                                                            60,
 133                                                            58,
 134                                                            56,
 135                                                            54,   //10 (11500)
 136                                                            53,
 137                                                            52,
 138                                                            51,
 139                                                            50,
 140                                                            49,   //15 ()
 141                                                            47,
 142                                                            46,
 143                                                            45,
 144                                                            44,
 145                                                            43,   //20 ()
 146                                                            42,
 147                                                            41,
 148                                                            40,
 149                                                            39,
 150                                                            38,   //25 ()
 151                                                            37,
 152                                                            37,
 153                                                            37,
 154                                                            37,
 155                                                            36};  //30 (24750)
 156          
 157          //==============================================================================
 158          //                                                            WATCHDOG INTERRUPT
 159          //==============================================================================
 160          
 161          CY_ISR(ISR_WATCHDOG_Handler){
 162   1      
 163   1          // Set WDT flag
 164   1          
 165   1          watchdog_flag = TRUE;
 166   1      
 167   1      }
 168          
 169          //==============================================================================
 170          //                                                            RS485 RX INTERRUPT
 171          //==============================================================================
 172          
 173          CY_ISR(ISR_RS485_RX_ExInterrupt) {
 174   1      
 175   1          // Set RS485 flag
 176   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 4   

 177   1          interrupt_flag = TRUE;
 178   1           
 179   1      }
 180          
 181          //==============================================================================
 182          //                                                             INTERRUPT MANAGER
 183          //==============================================================================
 184          // Manage interrupt from RS485 
 185          //==============================================================================
 186          // Processing RS-485 data frame:
 187          //
 188          // - WAIT_START:    Waits for beginning characters;
 189          // - WAIT_ID:       Waits for ID;
 190          // - WAIT_LENGTH:   Data length;
 191          // - RECEIVE:       Receive all bytes;
 192          // - UNLOAD:        Wait for another device end of transmission;
 193          //
 194          //==============================================================================
 195          
 196          void interrupt_manager(){
 197   1      
 198   1          
 199   1          //===========================================     local variables definition
 200   1      
 201   1          static uint8 CYDATA state = WAIT_START;                      // state
 202   1          
 203   1          //------------------------------------------------- local data packet
 204   1          static uint8 CYDATA data_packet_index;
 205   1          static uint8 CYDATA data_packet_length;
 206   1          static uint8 data_packet_buffer[128];                     
 207   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 208   1          //-------------------------------------------------
 209   1      
 210   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 211   1          CYBIT           rx_data_type;                       // my id?
 212   1          uint8 CYDATA    package_count = 0;                     
 213   1      
 214   1          //======================================================     receive routine
 215   1          
 216   1          // Get data until buffer is not empty 
 217   1          
 218   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 219   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 220   2              
 221   2              // Get next char
 222   2              rx_data = UART_RS485_GetChar();
 223   2              
 224   2              switch (state) {
 225   3                  //-----     wait for frame start     -------------------------------
 226   3                  case WAIT_START:
 227   3                  
 228   3                      rx_queue[0] = rx_queue[1];
 229   3                      rx_queue[1] = rx_queue[2];
 230   3                      rx_queue[2] = rx_data;
 231   3                      
 232   3                      // Check for header configuration package
 233   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 234   4                          rx_queue[0] = 0;
 235   4                          rx_queue[1] = 0;
 236   4                          rx_queue[2] = 0;
 237   4                          state       = WAIT_ID;                    
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 5   

 238   4                      }else
 239   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 240   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 241   3                              (rx_queue[2] == 10))        //ASCII - LF)
 242   3                              infoGet(INFO_ALL);
 243   3                      break;
 244   3      
 245   3                  //-----     wait for id     ----------------------------------------
 246   3                  case  WAIT_ID:
 247   3      
 248   3                      // packet is for my ID or is broadcast
 249   3                      if (rx_data == c_mem.id || rx_data == 0 || rx_data == c_mem.hand_ID)
 250   3                          rx_data_type = FALSE;
 251   3                      else                //packet is for others
 252   3                          rx_data_type = TRUE;
 253   3                      
 254   3                      data_packet_length = 0;
 255   3                      state = WAIT_LENGTH;
 256   3                      break;
 257   3      
 258   3                  //-----     wait for length     ------------------------------------
 259   3                  case  WAIT_LENGTH:
 260   3      
 261   3       
 262   3                      data_packet_length = rx_data;
 263   3                      // check validity of pack length
 264   3                      if (data_packet_length <= 1) {
 265   4                          data_packet_length = 0;
 266   4                          state = WAIT_START;
 267   4                      } else if (data_packet_length > 128) {
 268   4                          data_packet_length = 0;
 269   4                          state = WAIT_START;
 270   4                      } else {
 271   4                          data_packet_index = 0;
 272   4                          
 273   4                          if(rx_data_type == FALSE)
 274   4                              state = RECEIVE;          // packet for me or broadcast
 275   4                          else
 276   4                              state = UNLOAD;           // packet for others
 277   4                      }
 278   3                      break;
 279   3      
 280   3                  //-----     receiving     -------------------------------------------
 281   3                  case RECEIVE:
 282   3      
 283   3                      data_packet_buffer[data_packet_index] = rx_data;
 284   3                      data_packet_index++;
 285   3                      
 286   3                      // check end of transmission
 287   3                      if (data_packet_index >= data_packet_length) {
 288   4                          // verify if frame ID corresponded to the device ID
 289   4                          if (rx_data_type == FALSE) {
 290   5                              // copying data from buffer to global packet
 291   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 292   5                              g_rx.length = data_packet_length;
 293   5                              g_rx.ready  = 1;
 294   5                              commProcess();
 295   5                          }
 296   4                          
 297   4                          data_packet_index  = 0;
 298   4                          data_packet_length = 0;
 299   4                          state              = WAIT_START;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 6   

 300   4                          package_count++;
 301   4                      
 302   4                      }
 303   3                      break;
 304   3      
 305   3                  //-----     other device is receving     ---------------------------
 306   3                  case UNLOAD:
 307   3                      if (!(--data_packet_length)) {
 308   4                          data_packet_index  = 0;
 309   4                          data_packet_length = 0;
 310   4                          RS485_CTS_Write(1);
 311   4                          RS485_CTS_Write(0);
 312   4                          state              = WAIT_START;
 313   4                          package_count++;
 314   4                      }
 315   3                      break;
 316   3              }
 317   2          }
 318   1      }
 319          
 320          //==============================================================================
 321          //                                                            FUNCTION SCHEDULER
 322          //==============================================================================
 323          // Call all the function with the right frequency
 324          //==============================================================================
 325          // Base frequency 1000 Hz
 326          //==============================================================================
 327          
 328          void function_scheduler(void) {
 329   1       
 330   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 331   1          
 332   1          // Start ADC Conversion, SOC = 1
 333   1      
 334   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 335   1          
 336   1          ADC_SOC_Write(0x01); 
 337   1          
 338   1          // Check Interrupt 
 339   1      
 340   1          if (interrupt_flag){
 341   2              interrupt_flag = FALSE;
 342   2              interrupt_manager();
 343   2          }
 344   1        
 345   1          //---------------------------------- Get Encoders
 346   1      
 347   1          encoder_reading(0, FALSE); 
 348   1          
 349   1          // Check Interrupt     
 350   1          
 351   1          if (interrupt_flag){
 352   2              interrupt_flag = FALSE;
 353   2              interrupt_manager();
 354   2          }   
 355   1          
 356   1          encoder_reading(1, FALSE);
 357   1          
 358   1          // Check Interrupt 
 359   1          
 360   1          if (interrupt_flag){
 361   2              interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 7   

 362   2              interrupt_manager();
 363   2          }
 364   1          
 365   1          encoder_reading(2, FALSE);
 366   1          
 367   1          // Check Interrupt 
 368   1          
 369   1          if (interrupt_flag){
 370   2              interrupt_flag = FALSE;
 371   2              interrupt_manager();
 372   2          }
 373   1      
 374   1          //---------------------------------- Control Motors
 375   1          
 376   1          motor_control(0);
 377   1      
 378   1          // Check Interrupt 
 379   1      
 380   1          if (interrupt_flag){
 381   2              interrupt_flag = FALSE;
 382   2              interrupt_manager();
 383   2          }
 384   1          
 385   1          motor_control(1);
 386   1          
 387   1          // Check Interrupt 
 388   1          
 389   1          if (interrupt_flag){
 390   2              interrupt_flag = FALSE;
 391   2              interrupt_manager();
 392   2          }
 393   1      
 394   1          //---------------------------------- Read conversion buffer - LOCK function
 395   1      
 396   1          analog_read_end();
 397   1      
 398   1          //---------------------------------- Calibration 
 399   1      
 400   1          // Divider 100, freq = 10 Hz
 401   1          if (!(calibration_flag == STOP)) {
 402   2              if (counter_calibration == CALIBRATION_DIV) {
 403   3                  calibration();
 404   3                  counter_calibration = 0;
 405   3              }
 406   2              counter_calibration++;
 407   2          }
 408   1          // Check Interrupt 
 409   1          
 410   1          if (interrupt_flag){
 411   2              interrupt_flag = FALSE;
 412   2              interrupt_manager();
 413   2          }
 414   1      
 415   1          if(cuff_flag_force)
 416   1              drive_cuff();
 417   1              
 418   1          if (cuff_flag_proprio)
 419   1              slide_cuff();
 420   1      
 421   1          if (interrupt_flag){
 422   2              interrupt_flag = FALSE;
 423   2              interrupt_manager();
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 8   

 424   2          }
 425   1         
 426   1          //---------------------------------- Update States
 427   1          
 428   1          // Load k-1 state
 429   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 430   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 431   1      
 432   1          // Load k+1 state
 433   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 434   1      
 435   1          if (interrupt_flag){
 436   2              interrupt_flag = FALSE;
 437   2              interrupt_manager();
 438   2          }
 439   1      
 440   1          //CyDelayUs(100);
 441   1      
 442   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 443   1          MY_TIMER_WriteCounter(5000000);
 444   1      
 445   1      }
 446          
 447          
 448          //==============================================================================
 449          //                                                                MOTORS CONTROL
 450          //==============================================================================
 451          
 452          void motor_control(const uint8 idx) {
 453   1          
 454   1          uint8 CYDATA index = idx;
 455   1       
 456   1          int32 CYDATA curr_ref;
 457   1      
 458   1          int32 CYDATA pwm_input = 0;
 459   1          
 460   1          int32 CYDATA pos_error;
 461   1          int32 CYDATA curr_error;
 462   1          //int32 CYDATA defl_input[NUM_OF_MOTORS];
 463   1          
 464   1          int32 CYDATA k_p = c_mem.k_p;  
 465   1          int32 CYDATA k_i = c_mem.k_i; 
 466   1          int32 CYDATA k_d = c_mem.k_d; 
 467   1      
 468   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 469   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 470   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
 471   1      
 472   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 473   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 474   1          int32 CYDATA k_d_dl = c_mem.k_d_dl; 
 475   1      
 476   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 477   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 478   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;  
 479   1      
 480   1          // Static Variables
 481   1          
 482   1          static CYBIT dirM0, dirM1;
 483   1          
 484   1          static int32 prev_curr[NUM_OF_MOTORS];
 485   1      
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 9   

 486   1          static int32 pos_error_sum[NUM_OF_MOTORS];
 487   1          static int32 curr_error_sum[NUM_OF_MOTORS];
 488   1          
 489   1          // check index value
 490   1          if (index >= NUM_OF_MOTORS)
 491   1              return;
 492   1      
 493   1          switch(c_mem.control_mode) {
 494   2              case CONTROL_ANGLE:
 495   2              /*case DEFLECTION_CONTROL:
 496   2              
 497   2                  if(c_mem.control_mode == DEFLECTION_CONTROL){
 498   2                                      //for deflection control the shaft position must be summed to reference
 499   2                      defl_input[index] = (g_ref.pos[index] + g_meas.pos[2]);
 500   2                      pos_error = defl_input[index] - g_meas.pos[index];
 501   2                  }
 502   2                  else 
 503   2                      // position error*/
 504   2                  
 505   2                  pos_error = g_ref.pos[index] - g_meas.pos[index];
 506   2                 
 507   2                  if (interrupt_flag){
 508   3                      interrupt_flag = FALSE;
 509   3                      interrupt_manager();
 510   3                  }
 511   2                  
 512   2                  // error sum for integral
 513   2                  pos_error_sum[index] += pos_error;
 514   2      
 515   2                  //anti wind-up
 516   2                  if (pos_error_sum[index] > POS_INTEGRAL_SAT_LIMIT)
 517   2                      pos_error_sum[index] = POS_INTEGRAL_SAT_LIMIT;
 518   2                  else{
 519   3                      if (pos_error_sum[index] < -POS_INTEGRAL_SAT_LIMIT)
 520   3                          pos_error_sum[index] = -POS_INTEGRAL_SAT_LIMIT;
 521   3                  }
 522   2                    
 523   2                  if (interrupt_flag){
 524   3                      interrupt_flag = FALSE;
 525   3                      interrupt_manager();
 526   3                  }
 527   2                  // pwm_input init
 528   2                  pwm_input = 0;
 529   2                  // Proportional
 530   2                  if (k_p != 0) {
 531   3                          
 532   3                      if ((pos_error > 131072) || (pos_error < -131072))  //if grater than 2^17
 533   3                          pwm_input = (int32)(k_p * (pos_error >> 8)) >> 8;
 534   3                      else
 535   3                          pwm_input = (int32)(k_p * pos_error) >> 16;
 536   3                  }
 537   2                  
 538   2                  if (interrupt_flag){
 539   3                      interrupt_flag = FALSE;
 540   3                      interrupt_manager();
 541   3                  }
 542   2                            
 543   2                  // Integral
 544   2                  if (k_i != 0) 
 545   2                      pwm_input += (int32)((k_i >> 6) * pos_error_sum[index]) >> 10;
 546   2                  
 547   2                  // Derivative
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 10  

 548   2                  if (k_d != 0)
 549   2                      pwm_input += (int32)(k_d * (g_measOld.pos[index] - g_meas.pos[index])) >> 16;
 550   2               
 551   2          
 552   2                  if (interrupt_flag){
 553   3                      interrupt_flag = FALSE;
 554   3                      interrupt_manager();
 555   3                  }
 556   2                   
 557   2                  // Update measure
 558   2                  //prev_pos[index] = g_meas.pos[index];
 559   2      
 560   2                  if (index == 0){
 561   3                      if (pwm_input >= 0)
 562   3                          dirM0 = 1;
 563   3                          //direction |= 0x01;
 564   3                      else
 565   3                          dirM0 = 0;
 566   3                          //direction &= 0xFE;
 567   3                  }else{ // index == 1
 568   3                      if (pwm_input >= 0)
 569   3                          dirM1 = 1;
 570   3                         // direction |= 0x02;
 571   3                      else
 572   3                          dirM1 = 0;
 573   3                          //direction &= 0xFD;
 574   3                  }
 575   2                  
 576   2                  break;
 577   2      
 578   2              case CURR_AND_POS_CONTROL:
 579   2              /*case DEFL_CURRENT_CONTROL:
 580   2      
 581   2                  if(c_mem.control_mode == DEFL_CURRENT_CONTROL){
 582   2                      //for deflection control the shaft position must be summed to reference
 583   2                      defl_input[index] = (g_ref.pos[index] + g_meas.pos[2]);
 584   2                      pos_error = defl_input[index] - g_meas.pos[index];
 585   2                  }
 586   2                  else */
 587   2                  
 588   2                  pos_error = g_ref.pos[index] - g_meas.pos[index];
 589   2      
 590   2                  pos_error_sum[index] += pos_error;
 591   2      
 592   2                  if (interrupt_flag){
 593   3                      interrupt_flag = FALSE;
 594   3                      interrupt_manager();
 595   3                  }
 596   2      
 597   2                  // error_sum saturation
 598   2                  if (pos_error_sum[index] > POS_INTEGRAL_SAT_LIMIT)
 599   2                      pos_error_sum[index] = POS_INTEGRAL_SAT_LIMIT;
 600   2                  else{
 601   3                      if (pos_error_sum[index] < -POS_INTEGRAL_SAT_LIMIT)
 602   3                          pos_error_sum[index] = -POS_INTEGRAL_SAT_LIMIT;
 603   3                  }
 604   2                  // ------ position PID control -----
 605   2      
 606   2                  curr_ref = 0;
 607   2      
 608   2                  if (interrupt_flag){
 609   3                      interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 11  

 610   3                      interrupt_manager();
 611   3                  }
 612   2      
 613   2                  // Proportional
 614   2                  if (k_p_dl != 0)
 615   2                      curr_ref += (int32)(k_p_dl * pos_error) >> 16;
 616   2      
 617   2                  // Integral
 618   2                  if (k_i_dl != 0)
 619   2                      curr_ref += (int32)(k_i_dl * pos_error_sum[index]) >> 16;
 620   2                  
 621   2                  // Derivative
 622   2                  if (k_d_dl != 0)
 623   2                      curr_ref += (int32)(k_d_dl * (g_measOld.pos[index] - g_meas.pos[index])) >> 16;
 624   2                              
 625   2                  if (interrupt_flag){
 626   3                      interrupt_flag = FALSE;
 627   3                      interrupt_manager();
 628   3                  }
 629   2      
 630   2                  // saturate max current
 631   2                  if (curr_ref > c_mem.current_limit)
 632   2                      curr_ref = c_mem.current_limit;
 633   2                  else {
 634   3                      if (curr_ref < -c_mem.current_limit)
 635   3                          curr_ref = -c_mem.current_limit;
 636   3                  }
 637   2      
 638   2                  if (interrupt_flag){
 639   3                      interrupt_flag = FALSE;
 640   3                      interrupt_manager();
 641   3                  }
 642   2      
 643   2                  // current error
 644   2                  curr_error = curr_ref - g_meas.curr[index];
 645   2      
 646   2                  curr_error_sum[index] += curr_error;
 647   2      
 648   2                  if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
 649   2                      curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 650   2                  else{
 651   3                      if (curr_error_sum[index] < -CURR_INTEGRAL_SAT_LIMIT)
 652   3                          curr_error_sum[index] = -CURR_INTEGRAL_SAT_LIMIT;
 653   3                  }
 654   2      
 655   2                  if (interrupt_flag){
 656   3                      interrupt_flag = FALSE;
 657   3                      interrupt_manager();
 658   3                  }
 659   2      
 660   2                  // ----- current PID control -----
 661   2      
 662   2                  pwm_input = 0;
 663   2      
 664   2                  // Proportional
 665   2                  if (k_p_c_dl != 0)
 666   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 667   2                  
 668   2                  // Integral
 669   2                  if (k_i_c_dl != 0)
 670   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum[index]) >> 16;
 671   2                  
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 12  

 672   2                  // Derivative
 673   2                  if (k_d_c_dl != 0)
 674   2                      pwm_input += (int32)(k_d_c_dl * (prev_curr[index] - g_meas.curr[index])) >> 16;
 675   2                  
 676   2                  // Update current
 677   2                  prev_curr[index] = g_meas.curr[index];
 678   2      
 679   2                  if (interrupt_flag){
 680   3                      interrupt_flag = FALSE;
 681   3                      interrupt_manager();
 682   3                  }
 683   2      
 684   2                  if (index == 0){
 685   3                      if (pwm_input >= 0)
 686   3                          dirM0 = 1;
 687   3                          //direction |= 0x01;
 688   3                      else
 689   3                          dirM0 = 0;
 690   3                          //direction &= 0xFE;
 691   3                  }else{ // index == 1
 692   3                      if (pwm_input >= 0)
 693   3                          dirM1 = 1;
 694   3                         // direction |= 0x02;
 695   3                      else
 696   3                          dirM1 = 0;
 697   3                          //direction &= 0xFD;
 698   3                  }
 699   2      
 700   2                  break;
 701   2      
 702   2              case CONTROL_CURRENT:
 703   2      
 704   2                  // Current ref from pos ref
 705   2                  curr_ref = g_ref.pos[index] >> g_mem.res[index];
 706   2      
 707   2                  // saturate max current
 708   2                  if (curr_ref > c_mem.current_limit)
 709   2                      curr_ref = c_mem.current_limit;
 710   2                  
 711   2                  // Current error
 712   2                  curr_error = abs(curr_ref) - g_meas.curr[index];
 713   2      
 714   2                  // Error sum for integral
 715   2                  curr_error_sum[index] += curr_error;
 716   2      
 717   2                  //anti wind-up
 718   2                  if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
 719   2                      curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 720   2                  else{
 721   3                      if (curr_error_sum[index] < 0)
 722   3                          curr_error_sum[index] = 0;
 723   3                  }
 724   2      
 725   2                  // pwm_input init
 726   2                  pwm_input = 0;
 727   2      
 728   2                  // Proportional
 729   2                  if (k_p_c != 0)
 730   2                      pwm_input += (int32)(k_p * curr_error) >> 16;
 731   2      
 732   2      
 733   2                  // Integral
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 13  

 734   2                  if (k_i_c != 0)
 735   2                      pwm_input += (int32)(k_i_c * (curr_error_sum[index] >> 6)) >> 10;
 736   2                  
 737   2                  // Derivative
 738   2                  if (k_d_c != 0)
 739   2                      pwm_input += (int32)(k_d_c * (prev_curr[index] - g_meas.curr[index])) >> 16;
 740   2      
 741   2                  // Saturate pwm_input
 742   2                  if (pwm_input < 0)
 743   2                      pwm_input = 0;
 744   2      
 745   2                  // Update measure
 746   2                  prev_curr[index] = g_meas.curr[index];
 747   2                  
 748   2                  if (index == 0){
 749   3                      if (pwm_input >= 0)
 750   3                          dirM0 = 1;
 751   3                          //direction |= 0x01;
 752   3                      else
 753   3                          dirM0 = 0;
 754   3                          //direction &= 0xFE;
 755   3                  }else{ // index == 1
 756   3                      if (pwm_input >= 0)
 757   3                          dirM1 = 1;
 758   3                         // direction |= 0x02;
 759   3                      else
 760   3                          dirM1 = 0;
 761   3                          //direction &= 0xFD;
 762   3                  }
 763   2                  
 764   2                  break;
 765   2      
 766   2              case CONTROL_PWM:
 767   2                  // Direct PWM value
 768   2                  pwm_input = g_ref.pos[index] >> g_mem.res[index];
 769   2      
 770   2                  if (index == 0){
 771   3                      if (pwm_input >= 0)
 772   3                          dirM0 = 1;
 773   3                          //direction |= 0x01;
 774   3                      else
 775   3                          dirM0 = 0;
 776   3                          //direction &= 0xFE;
 777   3                  }else{ // index == 1
 778   3                      if (pwm_input >= 0)
 779   3                          dirM1 = 1;
 780   3                         // direction |= 0x02;
 781   3                      else
 782   3                          dirM1 = 0;
 783   3                          //direction &= 0xFD;
 784   3                  }
 785   2      
 786   2                  break;
 787   2      
 788   2              default:
 789   2                  break;
 790   2          }
 791   1          
 792   1          if (interrupt_flag){
 793   2              interrupt_flag = FALSE;
 794   2              interrupt_manager();
 795   2          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 14  

 796   1              
 797   1          // abs(pwm_input) must be lower or equal to PWM_MAX_VALUE
 798   1          if(pwm_input >  PWM_MAX_VALUE) 
 799   1              pwm_input =  PWM_MAX_VALUE;
 800   1          if(pwm_input < -PWM_MAX_VALUE) 
 801   1              pwm_input = -PWM_MAX_VALUE;
 802   1          
 803   1          if (interrupt_flag){
 804   2              interrupt_flag = FALSE;
 805   2              interrupt_manager();
 806   2          }   
 807   1      
 808   1          // remap pwm_input on pwm_limit based on input tension to have maximum 8 volts
 809   1          if (c_mem.control_mode != CONTROL_PWM)
 810   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 811   1      
 812   1          // drive direction and pwm duty cycle
 813   1              
 814   1          if (dirM0){
 815   2              if (dirM1)
 816   2                  MOTOR_DIR_Write(0x03);
 817   2              else
 818   2                  MOTOR_DIR_Write(0x01);
 819   2          }
 820   1          else{
 821   2              if (dirM1)
 822   2                  MOTOR_DIR_Write(0x02);
 823   2              else
 824   2                  MOTOR_DIR_Write(0x00);
 825   2          }
 826   1      
 827   1          if (interrupt_flag){
 828   2              interrupt_flag = FALSE;
 829   2              interrupt_manager();
 830   2          }
 831   1          
 832   1          if (index == 0) {
 833   2              pwm_sign[0] = SIGN(pwm_input);
 834   2              PWM_MOTORS_WriteCompare1(abs(pwm_input));
 835   2          }
 836   1          else {// index == 1
 837   2              pwm_sign[1] = SIGN(pwm_input);
 838   2              PWM_MOTORS_WriteCompare2(abs(pwm_input));
 839   2          }
 840   1          
 841   1          if (interrupt_flag){
 842   2              interrupt_flag = FALSE;
 843   2              interrupt_manager();
 844   2          }
 845   1      }
 846          
 847          //==============================================================================
 848          //                                                           ANALOG MEASUREMENTS
 849          //==============================================================================
 850          
 851          void analog_read_end() {
 852   1             
 853   1          /* =========================================================================
 854   1          /   Ideal formulation to calculate tension and current
 855   1          /
 856   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
 857   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 15  

 858   1          /
 859   1          /   Definition:
 860   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
 861   1          /   offset = 2000 -> hardware amplifier bias in mV
 862   1          /   gain = 8.086 -> amplifier gain
 863   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
 864   1          /
 865   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
 866   1          /   and offset unit of measurment is counts, instead dev_tension and
 867   1          /   g_meas.curr[] are converted in properly unit.
 868   1          /  =========================================================================
 869   1          */
 870   1          
 871   1          // Wait for conversion end
 872   1          while(!ADC_STATUS_Read()){
 873   2              if (interrupt_flag){
 874   3                  interrupt_flag = FALSE;
 875   3                  interrupt_manager();
 876   3              }
 877   2          }
 878   1          
 879   1          // Convert tension read
 880   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
 881   1          
 882   1          if (interrupt_flag){
 883   2              interrupt_flag = FALSE;
 884   2              interrupt_manager();
 885   2          }
 886   1      
 887   1          // Until there is no valid input tension repeat this measurement
 888   1          
 889   1          if (dev_tension > 0){
 890   2              
 891   2              // Set PWM depends on tension
 892   2              pwm_limit_search();
 893   2              
 894   2              // Check Interrupt 
 895   2          
 896   2              if (interrupt_flag){
 897   3                  interrupt_flag = FALSE;
 898   3                  interrupt_manager();
 899   3              }
 900   2      
 901   2              // Filter and Set currents
 902   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign[0]);
 903   2              
 904   2              // Check Interrupt 
 905   2          
 906   2              if (interrupt_flag){
 907   3                  interrupt_flag = FALSE;
 908   3                  interrupt_manager();
 909   3              }
 910   2              g_meas.curr[1] = filter_i2((int16) (((int32)(ADC_buf[2] - 1638) * 25771) >> 13) * pwm_sign[1]);
 911   2              
 912   2              // Check Interrupt 
 913   2          
 914   2              if (interrupt_flag){
 915   3                  interrupt_flag = FALSE;
 916   3                  interrupt_manager();
 917   3              }
 918   2          }
 919   1          else {
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 16  

 920   2              g_meas.curr[0] = 0;
 921   2              g_meas.curr[1] = 0;
 922   2          }
 923   1      }
 924          
 925          //==============================================================================
 926          //                                                               ENCODER READING
 927          //==============================================================================
 928          
 929          void encoder_reading(const uint8 idx, const uint8 flag)
 930          {
 931   1          uint8 CYDATA index = idx;
 932   1          
 933   1          uint8 jj;
 934   1          
 935   1          uint32 data_encoder;
 936   1          int32 value_encoder;
 937   1          int32 aux;
 938   1      
 939   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 940   1      
 941   1          static uint8 error[NUM_OF_SENSORS];
 942   1          
 943   1          static CYBIT only_first_time = TRUE;
 944   1      
 945   1          // static int32 l_value[NUM_OF_SENSORS];   //last value for vel
 946   1          // static int32 ll_value[NUM_OF_SENSORS];  //last last value for vel
 947   1          // static int32 lll_value[NUM_OF_SENSORS];  //last last last value for vel
 948   1      
 949   1          if (index >= NUM_OF_SENSORS)
 950   1              return;
 951   1          
 952   1          if (reset_last_value_flag) {
 953   2              for (jj = NUM_OF_SENSORS; jj--;) {
 954   3                  last_value_encoder[jj] = 0;
 955   3              }
 956   2              reset_last_value_flag = 0;
 957   2          }
 958   1      
 959   1          //======================================================     reading sensors
 960   1          if (index == 0)
 961   1                  data_encoder = SHIFTREG_ENC_1_ReadData() & 0x3FFFF;
 962   1          else {
 963   2              if (index == 1)
 964   2                  data_encoder = SHIFTREG_ENC_2_ReadData() & 0x3FFFF;
 965   2              else {
 966   3                  if (index == 2)
 967   3                      data_encoder = SHIFTREG_ENC_3_ReadData() & 0x3FFFF;
 968   3                  else // index == 3
 969   3                      data_encoder = SHIFTREG_ENC_4_ReadData() & 0x3FFFF;
 970   3              }
 971   2          }    
 972   1      
 973   1          if (check_enc_data(&data_encoder)) {
 974   2              if(flag)    // if the flag is set, save the measurement without offset to initialize cuff's zero p
             -osition
 975   2                  value_encoder = (int16) (32768 - ((data_encoder & 0x3FFC0) >> 2));
 976   2              else
 977   2                  value_encoder = (int16) (32768 - ((data_encoder & 0x3FFC0) >> 2) + g_mem.m_off[index]);  
 978   2      
 979   2              // Initialize last_value_encoder
 980   2              if (only_first_time) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 17  

 981   3                  last_value_encoder[index] = value_encoder;
 982   3                  
 983   3                  if (index == (NUM_OF_SENSORS - 1))
 984   3                      only_first_time = 0;
 985   3              }
 986   2      
 987   2              // Take care of rotations
 988   2              aux = value_encoder - last_value_encoder[index];
 989   2      
 990   2              // ====================== 1 TURN ======================
 991   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 992   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 993   2              //              |                         |      |           |      |                         |
 994   2              //           -16384                     16383    |           |   -16384                     16383
 995   2              //                                               |           |
 996   2              //                                           24575           -24576
 997   2              //                                               |___________|
 998   2              //                                                   49152
 999   2      
1000   2              // if we are in the right interval, take care of rotation
1001   2              // and update the variable only if the difference between
1002   2              // one measure and another is less than 1/4 of turn
1003   2      
1004   2              // Considering we are sampling at 1kHz, this means that our shaft needs
1005   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
1006   2              // equal to 250 turn/s -> 15000 RPM
1007   2      
1008   2              if (aux > 49152)
1009   2                  g_meas.rot[index]--;
1010   2              else{ 
1011   3                  if (aux < -49152)
1012   3                      g_meas.rot[index]++;
1013   3                  else{
1014   4                      if (abs(aux) > 16384) { // if two measure are too far
1015   5                          error[index]++;
1016   5                          if (error[index] < 10)
1017   5                              // Discard
1018   5                              return;
1019   5                      }
1020   4                  }
1021   3              }
1022   2              
1023   2              error[index] = 0;
1024   2              
1025   2              last_value_encoder[index] = value_encoder;
1026   2      
1027   2              value_encoder += (int32)g_meas.rot[index] << 16;
1028   2      
1029   2              if (c_mem.m_mult[index] != 1.0)
1030   2                  value_encoder *= c_mem.m_mult[index];
1031   2            
1032   2              g_meas.pos[index] = value_encoder;
1033   2          }
1034   1      
1035   1          // // velocity calculation
1036   1          // switch(i) {
1037   1          //     case 0: {
1038   1          //         g_meas.vel[i] = (int16)filter_vel_1((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1039   1          //         break;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 18  

1040   1          //     }
1041   1          //     case 1: {
1042   1          //         g_meas.vel[i] = (int16)filter_vel_2((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1043   1          //         break;
1044   1          //     }
1045   1          //     case 2: {
1046   1          //         g_meas.vel[i] = (int16)filter_vel_3((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1047   1          //         break;
1048   1          //     }
1049   1          // }
1050   1      
1051   1          // // update old values
1052   1          // lll_value[i] = ll_value[i];
1053   1          // ll_value[i] = l_value[i];
1054   1          // l_value[i] = value_encoder;
1055   1      }
1056          
1057          
1058          //==============================================================================
1059          //                                                          CALIBRATION FUNCTION
1060          //==============================================================================
1061          
1062          void calibration()
1063          {
1064   1          static int32 old_k_p;
1065   1          static int32 old_k_i;
1066   1          static int32 old_k_d;
1067   1      
1068   1          static uint8 pause_counter = 0;
1069   1      
1070   1          switch(calibration_flag) {
1071   2              case START:
1072   2                  ISR_RS485_RX_Disable();
1073   2      
1074   2                  // save old PID values
1075   2                  old_k_p = c_mem.k_p;
1076   2                  old_k_i = c_mem.k_i;
1077   2                  old_k_d = c_mem.k_d;
1078   2      
1079   2                  // goto to zero position
1080   2                  g_refNew.pos[0] = 0;
1081   2                  g_refNew.pos[1] = 0;
1082   2      
1083   2                  // Activate motors
1084   2                  if (!(g_refNew.onoff & 0x03)) {
1085   3                      MOTOR_ON_OFF_Write(0x03);
1086   3                  }
1087   2      
1088   2                  // wait for motors to reach zero position
1089   2                  calibration_flag = PAUSE_1;
1090   2                  break;
1091   2      
1092   2              case PAUSE_1:
1093   2                  pause_counter++;
1094   2      
1095   2                  if (pause_counter == 10) {
1096   3                      pause_counter = 0;
1097   3      
1098   3                      // set new temp values for PID parameters
1099   3                      c_mem.k_p = 0.1 * 65536;
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 19  

1100   3                      c_mem.k_i = 0;
1101   3                      c_mem.k_d = 0.3 * 65536;
1102   3      
1103   3                      calibration_flag = CONTINUE_1;
1104   3                  }
1105   2                  break;
1106   2      
1107   2              case CONTINUE_1:
1108   2                  // increment of 0.5 degree
1109   2                  g_refNew.pos[0] += 65536 / 720;
1110   2                  g_refNew.pos[1] -= 65536 / 720;
1111   2      
1112   2                  // check if one of the motors reach the threashold
1113   2                  if ((g_meas.curr[0] > CALIB_CURRENT) || (g_meas.curr[1] > CALIB_CURRENT)) {
1114   3                      // save current value as MAX_STIFFNESS
1115   3                      g_mem.max_stiffness = g_ref.pos[0];
1116   3      
1117   3                      // reset old values for PID parameters
1118   3                      c_mem.k_p = old_k_p;
1119   3                      c_mem.k_i = old_k_i;
1120   3                      c_mem.k_d = old_k_d;
1121   3      
1122   3                      // go back to zero position
1123   3                      g_refNew.pos[0] = 0;
1124   3                      g_refNew.pos[1] = 0;
1125   3      
1126   3                      // wait for motors to reach zero position
1127   3                      calibration_flag = PAUSE_2;
1128   3                  }
1129   2                  break;
1130   2      
1131   2              case PAUSE_2:
1132   2                  pause_counter++;
1133   2      
1134   2                  if (pause_counter == 10) {
1135   3                      pause_counter =0;
1136   3      
1137   3                      calibration_flag = CONTINUE_2;
1138   3                  }
1139   2                  break;
1140   2      
1141   2              case CONTINUE_2:
1142   2                  // Deactivate motors
1143   2                  if (!(g_refNew.onoff & 0x03)) {
1144   3                      MOTOR_ON_OFF_Write(0x00);
1145   3                  }
1146   2      
1147   2                  // store memory to save MAX_STIFFNESS as default value
1148   2                  memStore(DEFAULT_EEPROM_DISPLACEMENT);
1149   2                  memStore(0);
1150   2      
1151   2                  calibration_flag = STOP;
1152   2      
1153   2                  ISR_RS485_RX_Enable();
1154   2                  break;
1155   2      
1156   2              case STOP:
1157   2              default:
1158   2                  break;
1159   2          }
1160   1      }
1161          
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 20  

1162          
1163          //==============================================================================
1164          //                                                              PWM_LIMIT_SEARCH
1165          //==============================================================================
1166          
1167          void pwm_limit_search() {
1168   1          
1169   1          uint8  CYDATA index;
1170   1          uint16 CYDATA max_tension = 25500;
1171   1          uint16 CYDATA max_tension_6v_mod = 14750;
1172   1      
1173   1          if(g_mem.power_tension < 8000) {
1174   2              //Mod. 6 Volts
1175   2              if(dev_tension > max_tension_6v_mod)
1176   2                  dev_pwm_limit = 0;
1177   2      
1178   2              else {
1179   3                  if(dev_tension < g_mem.power_tension)
1180   3                      dev_pwm_limit = 100;
1181   3                  else {
1182   4                      index = (uint8)((dev_tension - g_mem.power_tension) >> 9);
1183   4                      dev_pwm_limit = hitech_pwm_preload_values_6v[index];
1184   4                  }
1185   3              }
1186   2          }
1187   1          else {
1188   2              // 8 - 12 volts
1189   2              if (dev_tension > max_tension)    // Max value 
1190   2                  dev_pwm_limit = 0;
1191   2              else{ 
1192   3                  if (dev_tension < g_mem.power_tension) // Min value
1193   3                      dev_pwm_limit = 100;
1194   3                  else {                  
1195   4                      index = (uint8)((dev_tension - 8000) >> 9);
1196   4                      if(g_mem.power_tension < 11500)
1197   4                          dev_pwm_limit = hitech_pwm_preload_values[index];
1198   4                      else
1199   4                          dev_pwm_limit = pwm_preload_values[index];
1200   4                  }
1201   3              }
1202   2          }
1203   1      }
1204          
1205          
1206          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 21  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 165
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 167
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 177
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 179
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 212
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 218
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 222
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 224
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6068              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 226
0033         ?C0006:
                                           ; SOURCE LINE # 228
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 229
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 230
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 233
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 22  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 234
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 235
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 236
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 237
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 238
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 239
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 242
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 243
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 246
0069         ?C0010:
                                           ; SOURCE LINE # 249
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 600B              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 6007              JZ      ?C0012
0075 900000      E     MOV     DPTR,#c_mem+081H
0078 E0                MOVX    A,@DPTR
0079 B50004            CJNE    A,rx_data,?C0011
007C         ?C0012:
                                           ; SOURCE LINE # 250
007C C200        R     CLR     rx_data_type
007E 8002              SJMP    ?C0013
0080         ?C0011:
                                           ; SOURCE LINE # 252
0080 D200        R     SETB    rx_data_type
0082         ?C0013:
                                           ; SOURCE LINE # 254
0082 E4                CLR     A
0083 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 255
0085 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 256
0088 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 259
008B         ?C0014:
                                           ; SOURCE LINE # 262
008B 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 264
008E E500        R     MOV     A,data_packet_length
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 23  

0090 D3                SETB    C
0091 9401              SUBB    A,#01H
0093 5008              JNC     ?C0015
                                           ; SOURCE LINE # 265
0095 E4                CLR     A
0096 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 266
0098 F500        R     MOV     state,A
                                           ; SOURCE LINE # 267
009A 020000      R     LJMP    ?C0003
009D         ?C0015:
009D E500        R     MOV     A,data_packet_length
009F D3                SETB    C
00A0 9480              SUBB    A,#080H
00A2 4008              JC      ?C0017
                                           ; SOURCE LINE # 268
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 269
00A7 F500        R     MOV     state,A
                                           ; SOURCE LINE # 270
00A9 020000      R     LJMP    ?C0003
00AC         ?C0017:
                                           ; SOURCE LINE # 271
00AC E4                CLR     A
00AD F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 273
00AF 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 274
00B2 750003      R     MOV     state,#03H
00B5 020000      R     LJMP    ?C0003
00B8         ?C0019:
                                           ; SOURCE LINE # 276
00B8 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
00BB 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 281
00BE         ?C0021:
                                           ; SOURCE LINE # 283
00BE 7400        R     MOV     A,#LOW data_packet_buffer
00C0 2500        R     ADD     A,data_packet_index
00C2 F582              MOV     DPL,A
00C4 E4                CLR     A
00C5 3400        R     ADDC    A,#HIGH data_packet_buffer
00C7 F583              MOV     DPH,A
00C9 E500        R     MOV     A,rx_data
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 284
00CC 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 287
00CE E500        R     MOV     A,data_packet_index
00D0 C3                CLR     C
00D1 9500        R     SUBB    A,data_packet_length
00D3 5003              JNC     $ + 5H
00D5 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 289
00D8 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 291
00DB AF00        R     MOV     R7,data_packet_length
00DD 7E00              MOV     R6,#00H
00DF 7800        E     MOV     R0,#LOW g_rx
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 24  

00E1 7C00        E     MOV     R4,#HIGH g_rx
00E3 7D01              MOV     R5,#01H
00E5 7B01              MOV     R3,#01H
00E7 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E9 7900        R     MOV     R1,#LOW data_packet_buffer
00EB 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 292
00EE 900000      E     MOV     DPTR,#g_rx+080H
00F1 E4                CLR     A
00F2 F0                MOVX    @DPTR,A
00F3 A3                INC     DPTR
00F4 E500        R     MOV     A,data_packet_length
00F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
00F7 900000      E     MOV     DPTR,#g_rx+084H
00FA 7401              MOV     A,#01H
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 294
00FD 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 295
0100         ?C0023:
                                           ; SOURCE LINE # 297
0100 E4                CLR     A
0101 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 298
0103 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 299
0105 F500        R     MOV     state,A
                                           ; SOURCE LINE # 300
0107 0500        R     INC     package_count
                                           ; SOURCE LINE # 302
                                           ; SOURCE LINE # 303
0109 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 306
010C         ?C0024:
                                           ; SOURCE LINE # 307
010C 1500        R     DEC     data_packet_length
010E E500        R     MOV     A,data_packet_length
0110 6003              JZ      $ + 5H
0112 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 308
0115 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 309
0117 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 310
0119 7F01              MOV     R7,#01H
011B 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 311
011E E4                CLR     A
011F FF                MOV     R7,A
0120 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 312
0123 E4                CLR     A
0124 F500        R     MOV     state,A
                                           ; SOURCE LINE # 313
0126 0500        R     INC     package_count
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 315
0128 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 316
                                           ; SOURCE LINE # 317
012B 020000      R     LJMP    ?C0003
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 25  

                                           ; SOURCE LINE # 318
012E         ?C0026:
012E 22                RET     
             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 334
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 336
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 340
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 341
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 342
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 343
0016         ?C0027:
                                           ; SOURCE LINE # 347
0016 E4                CLR     A
0017 FD                MOV     R5,A
0018 FF                MOV     R7,A
0019 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 351
001C 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 352
001F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 353
0021 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 354
0024         ?C0028:
                                           ; SOURCE LINE # 356
0024 E4                CLR     A
0025 FD                MOV     R5,A
0026 7F01              MOV     R7,#01H
0028 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 360
002B 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 361
002E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 362
0030 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 363
0033         ?C0029:
                                           ; SOURCE LINE # 365
0033 E4                CLR     A
0034 FD                MOV     R5,A
0035 7F02              MOV     R7,#02H
0037 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 369
003A 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 370
003D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 371
003F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 372
0042         ?C0030:
                                           ; SOURCE LINE # 376
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 26  

0042 E4                CLR     A
0043 FF                MOV     R7,A
0044 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 380
0047 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 381
004A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 382
004C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 383
004F         ?C0031:
                                           ; SOURCE LINE # 385
004F 7F01              MOV     R7,#01H
0051 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 389
0054 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 390
0057 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 391
0059 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 392
005C         ?C0032:
                                           ; SOURCE LINE # 396
005C 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 401
005F 900000      E     MOV     DPTR,#calibration_flag
0062 E0                MOVX    A,@DPTR
0063 7003              JNZ     ?C0034
0065 D3                SETB    C
0066 8001              SJMP    ?C0035
0068         ?C0034:
0068 C3                CLR     C
0069         ?C0035:
0069 4024              JC      ?C0033
                                           ; SOURCE LINE # 402
006B 900000      R     MOV     DPTR,#counter_calibration
006E E0                MOVX    A,@DPTR
006F 7004              JNZ     ?C0201
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 6464              XRL     A,#064H
0075         ?C0201:
0075 700A              JNZ     ?C0036
                                           ; SOURCE LINE # 403
0077 120000      R     LCALL   calibration
                                           ; SOURCE LINE # 404
007A E4                CLR     A
007B 900000      R     MOV     DPTR,#counter_calibration
007E F0                MOVX    @DPTR,A
007F A3                INC     DPTR
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 405
0081         ?C0036:
                                           ; SOURCE LINE # 406
0081 900000      R     MOV     DPTR,#counter_calibration+01H
0084 E0                MOVX    A,@DPTR
0085 04                INC     A
0086 F0                MOVX    @DPTR,A
0087 7006              JNZ     ?C0202
0089 900000      R     MOV     DPTR,#counter_calibration
008C E0                MOVX    A,@DPTR
008D 04                INC     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 27  

008E F0                MOVX    @DPTR,A
008F         ?C0202:
                                           ; SOURCE LINE # 407
008F         ?C0033:
                                           ; SOURCE LINE # 410
008F 300005            JNB     interrupt_flag,?C0037
                                           ; SOURCE LINE # 411
0092 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 412
0094 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 413
0097         ?C0037:
                                           ; SOURCE LINE # 415
0097 300003            JNB     cuff_flag_force,?C0038
                                           ; SOURCE LINE # 416
009A 120000      E     LCALL   drive_cuff
009D         ?C0038:
                                           ; SOURCE LINE # 418
009D 300003            JNB     cuff_flag_proprio,?C0039
                                           ; SOURCE LINE # 419
00A0 120000      E     LCALL   slide_cuff
00A3         ?C0039:
                                           ; SOURCE LINE # 421
00A3 300005            JNB     interrupt_flag,?C0040
                                           ; SOURCE LINE # 422
00A6 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 423
00A8 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 424
00AB         ?C0040:
                                           ; SOURCE LINE # 429
00AB 7800        E     MOV     R0,#LOW g_measOld
00AD 7C00        E     MOV     R4,#HIGH g_measOld
00AF 7D01              MOV     R5,#01H
00B1 7B01              MOV     R3,#01H
00B3 7A00        E     MOV     R2,#HIGH g_meas
00B5 7900        E     MOV     R1,#LOW g_meas
00B7 7E00              MOV     R6,#00H
00B9 7F1F              MOV     R7,#01FH
00BB 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 430
00BE 7800        E     MOV     R0,#LOW g_refOld
00C0 7C00        E     MOV     R4,#HIGH g_refOld
00C2 7D01              MOV     R5,#01H
00C4 7B01              MOV     R3,#01H
00C6 7A00        E     MOV     R2,#HIGH g_ref
00C8 7900        E     MOV     R1,#LOW g_ref
00CA 7E00              MOV     R6,#00H
00CC 7F09              MOV     R7,#09H
00CE 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 433
00D1 7800        E     MOV     R0,#LOW g_ref
00D3 7C00        E     MOV     R4,#HIGH g_ref
00D5 7D01              MOV     R5,#01H
00D7 7B01              MOV     R3,#01H
00D9 7A00        E     MOV     R2,#HIGH g_refNew
00DB 7900        E     MOV     R1,#LOW g_refNew
00DD 7E00              MOV     R6,#00H
00DF 7F09              MOV     R7,#09H
00E1 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 435
00E4 300005            JNB     interrupt_flag,?C0041
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 28  

                                           ; SOURCE LINE # 436
00E7 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 437
00E9 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 438
00EC         ?C0041:
                                           ; SOURCE LINE # 442
00EC 120000      E     LCALL   MY_TIMER_ReadCounter
00EF 900000      E     MOV     DPTR,#timer_value
00F2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 443
00F5 7F40              MOV     R7,#040H
00F7 7E4B              MOV     R6,#04BH
00F9 7D4C              MOV     R5,#04CH
00FB 7C00              MOV     R4,#00H
00FD 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 445
0100 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION _motor_control (BEGIN)
                                           ; SOURCE LINE # 452
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 454
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 458
0002 E4                CLR     A
0003 F500        R     MOV     pwm_input+03H,A
0005 F500        R     MOV     pwm_input+02H,A
0007 F500        R     MOV     pwm_input+01H,A
0009 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 464
000B 900000      E     MOV     DPTR,#c_mem+02H
000E E0                MOVX    A,@DPTR
000F FC                MOV     R4,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 FD                MOV     R5,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FE                MOV     R6,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F500        R     MOV     k_p+03H,A
001A 8E00        R     MOV     k_p+02H,R6
001C 8D00        R     MOV     k_p+01H,R5
001E 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 465
0020 A3                INC     DPTR
0021 E0                MOVX    A,@DPTR
0022 FC                MOV     R4,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 FD                MOV     R5,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FE                MOV     R6,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B F500        R     MOV     k_i+03H,A
002D 8E00        R     MOV     k_i+02H,R6
002F 8D00        R     MOV     k_i+01H,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 29  

0031 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 466
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FC                MOV     R4,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 FD                MOV     R5,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B FE                MOV     R6,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E F500        R     MOV     k_d+03H,A
0040 8E00        R     MOV     k_d+02H,R6
0042 8D00        R     MOV     k_d+01H,R5
0044 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 468
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FC                MOV     R4,A
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B FD                MOV     R5,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FE                MOV     R6,A
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 F500        R     MOV     k_p_c+03H,A
0053 8E00        R     MOV     k_p_c+02H,R6
0055 8D00        R     MOV     k_p_c+01H,R5
0057 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 469
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FC                MOV     R4,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FD                MOV     R5,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FE                MOV     R6,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 F500        R     MOV     k_i_c+03H,A
0066 8E00        R     MOV     k_i_c+02H,R6
0068 8D00        R     MOV     k_i_c+01H,R5
006A 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 470
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FC                MOV     R4,A
006F A3                INC     DPTR
0070 E0                MOVX    A,@DPTR
0071 FD                MOV     R5,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 FE                MOV     R6,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 F500        R     MOV     k_d_c+03H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 30  

0079 8E00        R     MOV     k_d_c+02H,R6
007B 8D00        R     MOV     k_d_c+01H,R5
007D 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 472
007F A3                INC     DPTR
0080 E0                MOVX    A,@DPTR
0081 FC                MOV     R4,A
0082 A3                INC     DPTR
0083 E0                MOVX    A,@DPTR
0084 FD                MOV     R5,A
0085 A3                INC     DPTR
0086 E0                MOVX    A,@DPTR
0087 FE                MOV     R6,A
0088 A3                INC     DPTR
0089 E0                MOVX    A,@DPTR
008A F500        R     MOV     k_p_dl+03H,A
008C 8E00        R     MOV     k_p_dl+02H,R6
008E 8D00        R     MOV     k_p_dl+01H,R5
0090 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 473
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 FC                MOV     R4,A
0095 A3                INC     DPTR
0096 E0                MOVX    A,@DPTR
0097 FD                MOV     R5,A
0098 A3                INC     DPTR
0099 E0                MOVX    A,@DPTR
009A FE                MOV     R6,A
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D F500        R     MOV     k_i_dl+03H,A
009F 8E00        R     MOV     k_i_dl+02H,R6
00A1 8D00        R     MOV     k_i_dl+01H,R5
00A3 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 474
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 FC                MOV     R4,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FD                MOV     R5,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FE                MOV     R6,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 F500        R     MOV     k_d_dl+03H,A
00B2 8E00        R     MOV     k_d_dl+02H,R6
00B4 8D00        R     MOV     k_d_dl+01H,R5
00B6 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 476
00B8 A3                INC     DPTR
00B9 E0                MOVX    A,@DPTR
00BA FC                MOV     R4,A
00BB A3                INC     DPTR
00BC E0                MOVX    A,@DPTR
00BD FD                MOV     R5,A
00BE A3                INC     DPTR
00BF E0                MOVX    A,@DPTR
00C0 FE                MOV     R6,A
00C1 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 31  

00C2 E0                MOVX    A,@DPTR
00C3 F500        R     MOV     k_p_c_dl+03H,A
00C5 8E00        R     MOV     k_p_c_dl+02H,R6
00C7 8D00        R     MOV     k_p_c_dl+01H,R5
00C9 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 477
00CB A3                INC     DPTR
00CC E0                MOVX    A,@DPTR
00CD FC                MOV     R4,A
00CE A3                INC     DPTR
00CF E0                MOVX    A,@DPTR
00D0 FD                MOV     R5,A
00D1 A3                INC     DPTR
00D2 E0                MOVX    A,@DPTR
00D3 FE                MOV     R6,A
00D4 A3                INC     DPTR
00D5 E0                MOVX    A,@DPTR
00D6 F500        R     MOV     k_i_c_dl+03H,A
00D8 8E00        R     MOV     k_i_c_dl+02H,R6
00DA 8D00        R     MOV     k_i_c_dl+01H,R5
00DC 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 478
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 FC                MOV     R4,A
00E1 A3                INC     DPTR
00E2 E0                MOVX    A,@DPTR
00E3 FD                MOV     R5,A
00E4 A3                INC     DPTR
00E5 E0                MOVX    A,@DPTR
00E6 FE                MOV     R6,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 F500        R     MOV     k_d_c_dl+03H,A
00EB 8E00        R     MOV     k_d_c_dl+02H,R6
00ED 8D00        R     MOV     k_d_c_dl+01H,R5
00EF 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 490
00F1 E500        R     MOV     A,index
00F3 C3                CLR     C
00F4 9402              SUBB    A,#02H
00F6 4003              JC      $ + 5H
00F8 020000      R     LJMP    ?C0044
00FB         ?C0043:
                                           ; SOURCE LINE # 493
00FB 900000      E     MOV     DPTR,#c_mem+036H
00FE E0                MOVX    A,@DPTR
00FF 14                DEC     A
0100 7003              JNZ     $ + 5H
0102 020000      R     LJMP    ?C0109
0105 14                DEC     A
0106 7003              JNZ     $ + 5H
0108 020000      R     LJMP    ?C0094
010B 14                DEC     A
010C 7003              JNZ     $ + 5H
010E 020000      R     LJMP    ?C0066
0111 2403              ADD     A,#03H
0113 6003              JZ      $ + 5H
0115 020000      R     LJMP    ?C0045
                                           ; SOURCE LINE # 494
0118         ?C0046:
                                           ; SOURCE LINE # 505
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 32  

0118 E500        R     MOV     A,index
011A 25E0              ADD     A,ACC
011C 25E0              ADD     A,ACC
011E 2400        E     ADD     A,#LOW g_meas
0120 F582              MOV     DPL,A
0122 E4                CLR     A
0123 3400        E     ADDC    A,#HIGH g_meas
0125 F583              MOV     DPH,A
0127 E0                MOVX    A,@DPTR
0128 F8                MOV     R0,A
0129 A3                INC     DPTR
012A E0                MOVX    A,@DPTR
012B F9                MOV     R1,A
012C A3                INC     DPTR
012D E0                MOVX    A,@DPTR
012E FA                MOV     R2,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FB                MOV     R3,A
0132 E500        R     MOV     A,index
0134 25E0              ADD     A,ACC
0136 25E0              ADD     A,ACC
0138 2400        E     ADD     A,#LOW g_ref
013A F582              MOV     DPL,A
013C E4                CLR     A
013D 3400        E     ADDC    A,#HIGH g_ref
013F F583              MOV     DPH,A
0141 E0                MOVX    A,@DPTR
0142 FC                MOV     R4,A
0143 A3                INC     DPTR
0144 E0                MOVX    A,@DPTR
0145 FD                MOV     R5,A
0146 A3                INC     DPTR
0147 E0                MOVX    A,@DPTR
0148 FE                MOV     R6,A
0149 A3                INC     DPTR
014A E0                MOVX    A,@DPTR
014B C3                CLR     C
014C 9B                SUBB    A,R3
014D F500        R     MOV     pos_error+03H,A
014F EE                MOV     A,R6
0150 9A                SUBB    A,R2
0151 F500        R     MOV     pos_error+02H,A
0153 ED                MOV     A,R5
0154 99                SUBB    A,R1
0155 F500        R     MOV     pos_error+01H,A
0157 EC                MOV     A,R4
0158 98                SUBB    A,R0
0159 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 507
015B 300005            JNB     interrupt_flag,?C0047
                                           ; SOURCE LINE # 508
015E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 509
0160 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 510
0163         ?C0047:
                                           ; SOURCE LINE # 513
0163 E500        R     MOV     A,index
0165 25E0              ADD     A,ACC
0167 25E0              ADD     A,ACC
0169 2400        R     ADD     A,#LOW pos_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 33  

016B F582              MOV     DPL,A
016D E4                CLR     A
016E 3400        R     ADDC    A,#HIGH pos_error_sum
0170 F583              MOV     DPH,A
0172 C083              PUSH    DPH
0174 C082              PUSH    DPL
0176 E0                MOVX    A,@DPTR
0177 FC                MOV     R4,A
0178 A3                INC     DPTR
0179 E0                MOVX    A,@DPTR
017A FD                MOV     R5,A
017B A3                INC     DPTR
017C E0                MOVX    A,@DPTR
017D FE                MOV     R6,A
017E A3                INC     DPTR
017F E0                MOVX    A,@DPTR
0180 2500        R     ADD     A,pos_error+03H
0182 FF                MOV     R7,A
0183 EE                MOV     A,R6
0184 3500        R     ADDC    A,pos_error+02H
0186 FE                MOV     R6,A
0187 ED                MOV     A,R5
0188 3500        R     ADDC    A,pos_error+01H
018A FD                MOV     R5,A
018B EC                MOV     A,R4
018C 3500        R     ADDC    A,pos_error
018E FC                MOV     R4,A
018F D082              POP     DPL
0191 D083              POP     DPH
0193 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 516
0196 E500        R     MOV     A,index
0198 25E0              ADD     A,ACC
019A 25E0              ADD     A,ACC
019C 2400        R     ADD     A,#LOW pos_error_sum
019E F582              MOV     DPL,A
01A0 E4                CLR     A
01A1 3400        R     ADDC    A,#HIGH pos_error_sum
01A3 F583              MOV     DPH,A
01A5 E0                MOVX    A,@DPTR
01A6 FC                MOV     R4,A
01A7 A3                INC     DPTR
01A8 E0                MOVX    A,@DPTR
01A9 FD                MOV     R5,A
01AA A3                INC     DPTR
01AB E0                MOVX    A,@DPTR
01AC FE                MOV     R6,A
01AD A3                INC     DPTR
01AE E0                MOVX    A,@DPTR
01AF FF                MOV     R7,A
01B0 7BA0              MOV     R3,#0A0H
01B2 7A86              MOV     R2,#086H
01B4 7901              MOV     R1,#01H
01B6 7800              MOV     R0,#00H
01B8 C3                CLR     C
01B9 120000      E     LCALL   ?C?SLCMP
01BC 501C              JNC     ?C0048
                                           ; SOURCE LINE # 517
01BE 7FA0              MOV     R7,#0A0H
01C0 7E86              MOV     R6,#086H
01C2 7D01              MOV     R5,#01H
01C4 7C00              MOV     R4,#00H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 34  

01C6 E500        R     MOV     A,index
01C8 25E0              ADD     A,ACC
01CA 25E0              ADD     A,ACC
01CC 2400        R     ADD     A,#LOW pos_error_sum
01CE F582              MOV     DPL,A
01D0 E4                CLR     A
01D1 3400        R     ADDC    A,#HIGH pos_error_sum
01D3 F583              MOV     DPH,A
01D5 120000      E     LCALL   ?C?LSTXDATA
01D8 8042              SJMP    ?C0049
01DA         ?C0048:
                                           ; SOURCE LINE # 518
                                           ; SOURCE LINE # 519
01DA E500        R     MOV     A,index
01DC 25E0              ADD     A,ACC
01DE 25E0              ADD     A,ACC
01E0 2400        R     ADD     A,#LOW pos_error_sum
01E2 F582              MOV     DPL,A
01E4 E4                CLR     A
01E5 3400        R     ADDC    A,#HIGH pos_error_sum
01E7 F583              MOV     DPH,A
01E9 E0                MOVX    A,@DPTR
01EA FC                MOV     R4,A
01EB A3                INC     DPTR
01EC E0                MOVX    A,@DPTR
01ED FD                MOV     R5,A
01EE A3                INC     DPTR
01EF E0                MOVX    A,@DPTR
01F0 FE                MOV     R6,A
01F1 A3                INC     DPTR
01F2 E0                MOVX    A,@DPTR
01F3 FF                MOV     R7,A
01F4 7B60              MOV     R3,#060H
01F6 7A79              MOV     R2,#079H
01F8 79FE              MOV     R1,#0FEH
01FA 78FF              MOV     R0,#0FFH
01FC D3                SETB    C
01FD 120000      E     LCALL   ?C?SLCMP
0200 401A              JC      ?C0049
                                           ; SOURCE LINE # 520
0202 7F60              MOV     R7,#060H
0204 7E79              MOV     R6,#079H
0206 7DFE              MOV     R5,#0FEH
0208 7CFF              MOV     R4,#0FFH
020A E500        R     MOV     A,index
020C 25E0              ADD     A,ACC
020E 25E0              ADD     A,ACC
0210 2400        R     ADD     A,#LOW pos_error_sum
0212 F582              MOV     DPL,A
0214 E4                CLR     A
0215 3400        R     ADDC    A,#HIGH pos_error_sum
0217 F583              MOV     DPH,A
0219 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 521
021C         ?C0049:
                                           ; SOURCE LINE # 523
021C 300005            JNB     interrupt_flag,?C0051
                                           ; SOURCE LINE # 524
021F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 525
0221 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 526
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 35  

0224         ?C0051:
                                           ; SOURCE LINE # 528
0224 E4                CLR     A
0225 F500        R     MOV     pwm_input+03H,A
0227 F500        R     MOV     pwm_input+02H,A
0229 F500        R     MOV     pwm_input+01H,A
022B F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 530
022D FF                MOV     R7,A
022E FE                MOV     R6,A
022F FD                MOV     R5,A
0230 FC                MOV     R4,A
0231 AB00        R     MOV     R3,k_p+03H
0233 AA00        R     MOV     R2,k_p+02H
0235 A900        R     MOV     R1,k_p+01H
0237 A800        R     MOV     R0,k_p
0239 C3                CLR     C
023A 120000      E     LCALL   ?C?SLCMP
023D 606A              JZ      ?C0052
                                           ; SOURCE LINE # 532
023F E4                CLR     A
0240 FF                MOV     R7,A
0241 FE                MOV     R6,A
0242 7D02              MOV     R5,#02H
0244 FC                MOV     R4,A
0245 AB00        R     MOV     R3,pos_error+03H
0247 AA00        R     MOV     R2,pos_error+02H
0249 A900        R     MOV     R1,pos_error+01H
024B A800        R     MOV     R0,pos_error
024D D3                SETB    C
024E 120000      E     LCALL   ?C?SLCMP
0251 500F              JNC     ?C0054
0253 E4                CLR     A
0254 FF                MOV     R7,A
0255 FE                MOV     R6,A
0256 7DFE              MOV     R5,#0FEH
0258 7CFF              MOV     R4,#0FFH
025A A800        R     MOV     R0,pos_error
025C C3                CLR     C
025D 120000      E     LCALL   ?C?SLCMP
0260 5027              JNC     ?C0053
0262         ?C0054:
                                           ; SOURCE LINE # 533
0262 AF00        R     MOV     R7,pos_error+03H
0264 AE00        R     MOV     R6,pos_error+02H
0266 AD00        R     MOV     R5,pos_error+01H
0268 AC00        R     MOV     R4,pos_error
026A 7808              MOV     R0,#08H
026C 120000      E     LCALL   ?C?SLSHR
026F AB00        R     MOV     R3,k_p+03H
0271 AA00        R     MOV     R2,k_p+02H
0273 A900        R     MOV     R1,k_p+01H
0275 A800        R     MOV     R0,k_p
0277 120000      E     LCALL   ?C?LMUL
027A 7808              MOV     R0,#08H
027C 120000      E     LCALL   ?C?SLSHR
027F 8F00        R     MOV     pwm_input+03H,R7
0281 8E00        R     MOV     pwm_input+02H,R6
0283 8D00        R     MOV     pwm_input+01H,R5
0285 8C00        R     MOV     pwm_input,R4
0287 8020              SJMP    ?C0052
0289         ?C0053:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 36  

                                           ; SOURCE LINE # 535
0289 AF00        R     MOV     R7,pos_error+03H
028B AE00        R     MOV     R6,pos_error+02H
028D AD00        R     MOV     R5,pos_error+01H
028F AC00        R     MOV     R4,pos_error
0291 AB00        R     MOV     R3,k_p+03H
0293 AA00        R     MOV     R2,k_p+02H
0295 A900        R     MOV     R1,k_p+01H
0297 A800        R     MOV     R0,k_p
0299 120000      E     LCALL   ?C?LMUL
029C 7810              MOV     R0,#010H
029E 120000      E     LCALL   ?C?SLSHR
02A1 8F00        R     MOV     pwm_input+03H,R7
02A3 8E00        R     MOV     pwm_input+02H,R6
02A5 8D00        R     MOV     pwm_input+01H,R5
02A7 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 536
02A9         ?C0052:
                                           ; SOURCE LINE # 538
02A9 300005            JNB     interrupt_flag,?C0056
                                           ; SOURCE LINE # 539
02AC C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 540
02AE 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 541
02B1         ?C0056:
                                           ; SOURCE LINE # 544
02B1 E4                CLR     A
02B2 FF                MOV     R7,A
02B3 FE                MOV     R6,A
02B4 FD                MOV     R5,A
02B5 FC                MOV     R4,A
02B6 AB00        R     MOV     R3,k_i+03H
02B8 AA00        R     MOV     R2,k_i+02H
02BA A900        R     MOV     R1,k_i+01H
02BC A800        R     MOV     R0,k_i
02BE C3                CLR     C
02BF 120000      E     LCALL   ?C?SLCMP
02C2 6043              JZ      ?C0057
                                           ; SOURCE LINE # 545
02C4 AF00        R     MOV     R7,k_i+03H
02C6 AE00        R     MOV     R6,k_i+02H
02C8 AD00        R     MOV     R5,k_i+01H
02CA AC00        R     MOV     R4,k_i
02CC 7806              MOV     R0,#06H
02CE 120000      E     LCALL   ?C?SLSHR
02D1 E500        R     MOV     A,index
02D3 25E0              ADD     A,ACC
02D5 25E0              ADD     A,ACC
02D7 2400        R     ADD     A,#LOW pos_error_sum
02D9 F582              MOV     DPL,A
02DB E4                CLR     A
02DC 3400        R     ADDC    A,#HIGH pos_error_sum
02DE F583              MOV     DPH,A
02E0 E0                MOVX    A,@DPTR
02E1 F8                MOV     R0,A
02E2 A3                INC     DPTR
02E3 E0                MOVX    A,@DPTR
02E4 F9                MOV     R1,A
02E5 A3                INC     DPTR
02E6 E0                MOVX    A,@DPTR
02E7 FA                MOV     R2,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 37  

02E8 A3                INC     DPTR
02E9 E0                MOVX    A,@DPTR
02EA FB                MOV     R3,A
02EB 120000      E     LCALL   ?C?LMUL
02EE 780A              MOV     R0,#0AH
02F0 120000      E     LCALL   ?C?SLSHR
02F3 E500        R     MOV     A,pwm_input+03H
02F5 2F                ADD     A,R7
02F6 F500        R     MOV     pwm_input+03H,A
02F8 E500        R     MOV     A,pwm_input+02H
02FA 3E                ADDC    A,R6
02FB F500        R     MOV     pwm_input+02H,A
02FD E500        R     MOV     A,pwm_input+01H
02FF 3D                ADDC    A,R5
0300 F500        R     MOV     pwm_input+01H,A
0302 E500        R     MOV     A,pwm_input
0304 3C                ADDC    A,R4
0305 F500        R     MOV     pwm_input,A
0307         ?C0057:
                                           ; SOURCE LINE # 548
0307 E4                CLR     A
0308 FF                MOV     R7,A
0309 FE                MOV     R6,A
030A FD                MOV     R5,A
030B FC                MOV     R4,A
030C AB00        R     MOV     R3,k_d+03H
030E AA00        R     MOV     R2,k_d+02H
0310 A900        R     MOV     R1,k_d+01H
0312 A800        R     MOV     R0,k_d
0314 C3                CLR     C
0315 120000      E     LCALL   ?C?SLCMP
0318 6063              JZ      ?C0058
                                           ; SOURCE LINE # 549
031A E500        R     MOV     A,index
031C 25E0              ADD     A,ACC
031E 25E0              ADD     A,ACC
0320 2400        E     ADD     A,#LOW g_meas
0322 F582              MOV     DPL,A
0324 E4                CLR     A
0325 3400        E     ADDC    A,#HIGH g_meas
0327 F583              MOV     DPH,A
0329 E0                MOVX    A,@DPTR
032A F8                MOV     R0,A
032B A3                INC     DPTR
032C E0                MOVX    A,@DPTR
032D F9                MOV     R1,A
032E A3                INC     DPTR
032F E0                MOVX    A,@DPTR
0330 FA                MOV     R2,A
0331 A3                INC     DPTR
0332 E0                MOVX    A,@DPTR
0333 FB                MOV     R3,A
0334 E500        R     MOV     A,index
0336 25E0              ADD     A,ACC
0338 25E0              ADD     A,ACC
033A 2400        E     ADD     A,#LOW g_measOld
033C F582              MOV     DPL,A
033E E4                CLR     A
033F 3400        E     ADDC    A,#HIGH g_measOld
0341 F583              MOV     DPH,A
0343 E0                MOVX    A,@DPTR
0344 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 38  

0345 A3                INC     DPTR
0346 E0                MOVX    A,@DPTR
0347 FD                MOV     R5,A
0348 A3                INC     DPTR
0349 E0                MOVX    A,@DPTR
034A FE                MOV     R6,A
034B A3                INC     DPTR
034C E0                MOVX    A,@DPTR
034D C3                CLR     C
034E 9B                SUBB    A,R3
034F FF                MOV     R7,A
0350 EE                MOV     A,R6
0351 9A                SUBB    A,R2
0352 FE                MOV     R6,A
0353 ED                MOV     A,R5
0354 99                SUBB    A,R1
0355 FD                MOV     R5,A
0356 EC                MOV     A,R4
0357 98                SUBB    A,R0
0358 FC                MOV     R4,A
0359 AB00        R     MOV     R3,k_d+03H
035B AA00        R     MOV     R2,k_d+02H
035D A900        R     MOV     R1,k_d+01H
035F A800        R     MOV     R0,k_d
0361 120000      E     LCALL   ?C?LMUL
0364 7810              MOV     R0,#010H
0366 120000      E     LCALL   ?C?SLSHR
0369 E500        R     MOV     A,pwm_input+03H
036B 2F                ADD     A,R7
036C F500        R     MOV     pwm_input+03H,A
036E E500        R     MOV     A,pwm_input+02H
0370 3E                ADDC    A,R6
0371 F500        R     MOV     pwm_input+02H,A
0373 E500        R     MOV     A,pwm_input+01H
0375 3D                ADDC    A,R5
0376 F500        R     MOV     pwm_input+01H,A
0378 E500        R     MOV     A,pwm_input
037A 3C                ADDC    A,R4
037B F500        R     MOV     pwm_input,A
037D         ?C0058:
                                           ; SOURCE LINE # 552
037D 300005            JNB     interrupt_flag,?C0059
                                           ; SOURCE LINE # 553
0380 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 554
0382 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 555
0385         ?C0059:
                                           ; SOURCE LINE # 560
0385 E500        R     MOV     A,index
0387 701C              JNZ     ?C0060
                                           ; SOURCE LINE # 561
0389 FF                MOV     R7,A
038A FE                MOV     R6,A
038B FD                MOV     R5,A
038C FC                MOV     R4,A
038D AB00        R     MOV     R3,pwm_input+03H
038F AA00        R     MOV     R2,pwm_input+02H
0391 A900        R     MOV     R1,pwm_input+01H
0393 A800        R     MOV     R0,pwm_input
0395 C3                CLR     C
0396 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 39  

0399 4005              JC      ?C0061
                                           ; SOURCE LINE # 562
039B D200        R     SETB    dirM0
039D 020000      R     LJMP    ?C0045
03A0         ?C0061:
                                           ; SOURCE LINE # 565
03A0 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 567
03A2 020000      R     LJMP    ?C0045
03A5         ?C0060:
                                           ; SOURCE LINE # 568
03A5 E4                CLR     A
03A6 FF                MOV     R7,A
03A7 FE                MOV     R6,A
03A8 FD                MOV     R5,A
03A9 FC                MOV     R4,A
03AA AB00        R     MOV     R3,pwm_input+03H
03AC AA00        R     MOV     R2,pwm_input+02H
03AE A900        R     MOV     R1,pwm_input+01H
03B0 A800        R     MOV     R0,pwm_input
03B2 C3                CLR     C
03B3 120000      E     LCALL   ?C?SLCMP
03B6 4005              JC      ?C0064
                                           ; SOURCE LINE # 569
03B8 D200        R     SETB    dirM1
03BA 020000      R     LJMP    ?C0045
03BD         ?C0064:
                                           ; SOURCE LINE # 572
03BD C200        R     CLR     dirM1
                                           ; SOURCE LINE # 574
                                           ; SOURCE LINE # 576
03BF 020000      R     LJMP    ?C0045
                                           ; SOURCE LINE # 578
03C2         ?C0066:
                                           ; SOURCE LINE # 588
03C2 E500        R     MOV     A,index
03C4 25E0              ADD     A,ACC
03C6 25E0              ADD     A,ACC
03C8 2400        E     ADD     A,#LOW g_meas
03CA F582              MOV     DPL,A
03CC E4                CLR     A
03CD 3400        E     ADDC    A,#HIGH g_meas
03CF F583              MOV     DPH,A
03D1 E0                MOVX    A,@DPTR
03D2 F8                MOV     R0,A
03D3 A3                INC     DPTR
03D4 E0                MOVX    A,@DPTR
03D5 F9                MOV     R1,A
03D6 A3                INC     DPTR
03D7 E0                MOVX    A,@DPTR
03D8 FA                MOV     R2,A
03D9 A3                INC     DPTR
03DA E0                MOVX    A,@DPTR
03DB FB                MOV     R3,A
03DC E500        R     MOV     A,index
03DE 25E0              ADD     A,ACC
03E0 25E0              ADD     A,ACC
03E2 2400        E     ADD     A,#LOW g_ref
03E4 F582              MOV     DPL,A
03E6 E4                CLR     A
03E7 3400        E     ADDC    A,#HIGH g_ref
03E9 F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 40  

03EB E0                MOVX    A,@DPTR
03EC FC                MOV     R4,A
03ED A3                INC     DPTR
03EE E0                MOVX    A,@DPTR
03EF FD                MOV     R5,A
03F0 A3                INC     DPTR
03F1 E0                MOVX    A,@DPTR
03F2 FE                MOV     R6,A
03F3 A3                INC     DPTR
03F4 E0                MOVX    A,@DPTR
03F5 C3                CLR     C
03F6 9B                SUBB    A,R3
03F7 F500        R     MOV     pos_error+03H,A
03F9 EE                MOV     A,R6
03FA 9A                SUBB    A,R2
03FB F500        R     MOV     pos_error+02H,A
03FD ED                MOV     A,R5
03FE 99                SUBB    A,R1
03FF F500        R     MOV     pos_error+01H,A
0401 EC                MOV     A,R4
0402 98                SUBB    A,R0
0403 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 590
0405 E500        R     MOV     A,index
0407 25E0              ADD     A,ACC
0409 25E0              ADD     A,ACC
040B 2400        R     ADD     A,#LOW pos_error_sum
040D F582              MOV     DPL,A
040F E4                CLR     A
0410 3400        R     ADDC    A,#HIGH pos_error_sum
0412 F583              MOV     DPH,A
0414 C083              PUSH    DPH
0416 C082              PUSH    DPL
0418 E0                MOVX    A,@DPTR
0419 FC                MOV     R4,A
041A A3                INC     DPTR
041B E0                MOVX    A,@DPTR
041C FD                MOV     R5,A
041D A3                INC     DPTR
041E E0                MOVX    A,@DPTR
041F FE                MOV     R6,A
0420 A3                INC     DPTR
0421 E0                MOVX    A,@DPTR
0422 2500        R     ADD     A,pos_error+03H
0424 FF                MOV     R7,A
0425 EE                MOV     A,R6
0426 3500        R     ADDC    A,pos_error+02H
0428 FE                MOV     R6,A
0429 ED                MOV     A,R5
042A 3500        R     ADDC    A,pos_error+01H
042C FD                MOV     R5,A
042D EC                MOV     A,R4
042E 3500        R     ADDC    A,pos_error
0430 FC                MOV     R4,A
0431 D082              POP     DPL
0433 D083              POP     DPH
0435 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 592
0438 300005            JNB     interrupt_flag,?C0067
                                           ; SOURCE LINE # 593
043B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 594
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 41  

043D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 595
0440         ?C0067:
                                           ; SOURCE LINE # 598
0440 E500        R     MOV     A,index
0442 25E0              ADD     A,ACC
0444 25E0              ADD     A,ACC
0446 2400        R     ADD     A,#LOW pos_error_sum
0448 F582              MOV     DPL,A
044A E4                CLR     A
044B 3400        R     ADDC    A,#HIGH pos_error_sum
044D F583              MOV     DPH,A
044F E0                MOVX    A,@DPTR
0450 FC                MOV     R4,A
0451 A3                INC     DPTR
0452 E0                MOVX    A,@DPTR
0453 FD                MOV     R5,A
0454 A3                INC     DPTR
0455 E0                MOVX    A,@DPTR
0456 FE                MOV     R6,A
0457 A3                INC     DPTR
0458 E0                MOVX    A,@DPTR
0459 FF                MOV     R7,A
045A 7BA0              MOV     R3,#0A0H
045C 7A86              MOV     R2,#086H
045E 7901              MOV     R1,#01H
0460 7800              MOV     R0,#00H
0462 C3                CLR     C
0463 120000      E     LCALL   ?C?SLCMP
0466 501C              JNC     ?C0068
                                           ; SOURCE LINE # 599
0468 7FA0              MOV     R7,#0A0H
046A 7E86              MOV     R6,#086H
046C 7D01              MOV     R5,#01H
046E 7C00              MOV     R4,#00H
0470 E500        R     MOV     A,index
0472 25E0              ADD     A,ACC
0474 25E0              ADD     A,ACC
0476 2400        R     ADD     A,#LOW pos_error_sum
0478 F582              MOV     DPL,A
047A E4                CLR     A
047B 3400        R     ADDC    A,#HIGH pos_error_sum
047D F583              MOV     DPH,A
047F 120000      E     LCALL   ?C?LSTXDATA
0482 8042              SJMP    ?C0069
0484         ?C0068:
                                           ; SOURCE LINE # 600
                                           ; SOURCE LINE # 601
0484 E500        R     MOV     A,index
0486 25E0              ADD     A,ACC
0488 25E0              ADD     A,ACC
048A 2400        R     ADD     A,#LOW pos_error_sum
048C F582              MOV     DPL,A
048E E4                CLR     A
048F 3400        R     ADDC    A,#HIGH pos_error_sum
0491 F583              MOV     DPH,A
0493 E0                MOVX    A,@DPTR
0494 FC                MOV     R4,A
0495 A3                INC     DPTR
0496 E0                MOVX    A,@DPTR
0497 FD                MOV     R5,A
0498 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 42  

0499 E0                MOVX    A,@DPTR
049A FE                MOV     R6,A
049B A3                INC     DPTR
049C E0                MOVX    A,@DPTR
049D FF                MOV     R7,A
049E 7B60              MOV     R3,#060H
04A0 7A79              MOV     R2,#079H
04A2 79FE              MOV     R1,#0FEH
04A4 78FF              MOV     R0,#0FFH
04A6 D3                SETB    C
04A7 120000      E     LCALL   ?C?SLCMP
04AA 401A              JC      ?C0069
                                           ; SOURCE LINE # 602
04AC 7F60              MOV     R7,#060H
04AE 7E79              MOV     R6,#079H
04B0 7DFE              MOV     R5,#0FEH
04B2 7CFF              MOV     R4,#0FFH
04B4 E500        R     MOV     A,index
04B6 25E0              ADD     A,ACC
04B8 25E0              ADD     A,ACC
04BA 2400        R     ADD     A,#LOW pos_error_sum
04BC F582              MOV     DPL,A
04BE E4                CLR     A
04BF 3400        R     ADDC    A,#HIGH pos_error_sum
04C1 F583              MOV     DPH,A
04C3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 603
04C6         ?C0069:
                                           ; SOURCE LINE # 606
04C6 E4                CLR     A
04C7 F500        R     MOV     curr_ref+03H,A
04C9 F500        R     MOV     curr_ref+02H,A
04CB F500        R     MOV     curr_ref+01H,A
04CD F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 608
04CF 300005            JNB     interrupt_flag,?C0071
                                           ; SOURCE LINE # 609
04D2 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 610
04D4 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 611
04D7         ?C0071:
                                           ; SOURCE LINE # 614
04D7 E4                CLR     A
04D8 FF                MOV     R7,A
04D9 FE                MOV     R6,A
04DA FD                MOV     R5,A
04DB FC                MOV     R4,A
04DC AB00        R     MOV     R3,k_p_dl+03H
04DE AA00        R     MOV     R2,k_p_dl+02H
04E0 A900        R     MOV     R1,k_p_dl+01H
04E2 A800        R     MOV     R0,k_p_dl
04E4 C3                CLR     C
04E5 120000      E     LCALL   ?C?SLCMP
04E8 6026              JZ      ?C0072
                                           ; SOURCE LINE # 615
04EA AF00        R     MOV     R7,pos_error+03H
04EC AE00        R     MOV     R6,pos_error+02H
04EE AD00        R     MOV     R5,pos_error+01H
04F0 AC00        R     MOV     R4,pos_error
04F2 A800        R     MOV     R0,k_p_dl
04F4 120000      E     LCALL   ?C?LMUL
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 43  

04F7 7810              MOV     R0,#010H
04F9 120000      E     LCALL   ?C?SLSHR
04FC E500        R     MOV     A,curr_ref+03H
04FE 2F                ADD     A,R7
04FF F500        R     MOV     curr_ref+03H,A
0501 E500        R     MOV     A,curr_ref+02H
0503 3E                ADDC    A,R6
0504 F500        R     MOV     curr_ref+02H,A
0506 E500        R     MOV     A,curr_ref+01H
0508 3D                ADDC    A,R5
0509 F500        R     MOV     curr_ref+01H,A
050B E500        R     MOV     A,curr_ref
050D 3C                ADDC    A,R4
050E F500        R     MOV     curr_ref,A
0510         ?C0072:
                                           ; SOURCE LINE # 618
0510 E4                CLR     A
0511 FF                MOV     R7,A
0512 FE                MOV     R6,A
0513 FD                MOV     R5,A
0514 FC                MOV     R4,A
0515 AB00        R     MOV     R3,k_i_dl+03H
0517 AA00        R     MOV     R2,k_i_dl+02H
0519 A900        R     MOV     R1,k_i_dl+01H
051B A800        R     MOV     R0,k_i_dl
051D C3                CLR     C
051E 120000      E     LCALL   ?C?SLCMP
0521 6038              JZ      ?C0073
                                           ; SOURCE LINE # 619
0523 E500        R     MOV     A,index
0525 25E0              ADD     A,ACC
0527 25E0              ADD     A,ACC
0529 2400        R     ADD     A,#LOW pos_error_sum
052B F582              MOV     DPL,A
052D E4                CLR     A
052E 3400        R     ADDC    A,#HIGH pos_error_sum
0530 F583              MOV     DPH,A
0532 E0                MOVX    A,@DPTR
0533 FC                MOV     R4,A
0534 A3                INC     DPTR
0535 E0                MOVX    A,@DPTR
0536 FD                MOV     R5,A
0537 A3                INC     DPTR
0538 E0                MOVX    A,@DPTR
0539 FE                MOV     R6,A
053A A3                INC     DPTR
053B E0                MOVX    A,@DPTR
053C FF                MOV     R7,A
053D A800        R     MOV     R0,k_i_dl
053F 120000      E     LCALL   ?C?LMUL
0542 7810              MOV     R0,#010H
0544 120000      E     LCALL   ?C?SLSHR
0547 E500        R     MOV     A,curr_ref+03H
0549 2F                ADD     A,R7
054A F500        R     MOV     curr_ref+03H,A
054C E500        R     MOV     A,curr_ref+02H
054E 3E                ADDC    A,R6
054F F500        R     MOV     curr_ref+02H,A
0551 E500        R     MOV     A,curr_ref+01H
0553 3D                ADDC    A,R5
0554 F500        R     MOV     curr_ref+01H,A
0556 E500        R     MOV     A,curr_ref
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 44  

0558 3C                ADDC    A,R4
0559 F500        R     MOV     curr_ref,A
055B         ?C0073:
                                           ; SOURCE LINE # 622
055B E4                CLR     A
055C FF                MOV     R7,A
055D FE                MOV     R6,A
055E FD                MOV     R5,A
055F FC                MOV     R4,A
0560 AB00        R     MOV     R3,k_d_dl+03H
0562 AA00        R     MOV     R2,k_d_dl+02H
0564 A900        R     MOV     R1,k_d_dl+01H
0566 A800        R     MOV     R0,k_d_dl
0568 C3                CLR     C
0569 120000      E     LCALL   ?C?SLCMP
056C 6063              JZ      ?C0074
                                           ; SOURCE LINE # 623
056E E500        R     MOV     A,index
0570 25E0              ADD     A,ACC
0572 25E0              ADD     A,ACC
0574 2400        E     ADD     A,#LOW g_meas
0576 F582              MOV     DPL,A
0578 E4                CLR     A
0579 3400        E     ADDC    A,#HIGH g_meas
057B F583              MOV     DPH,A
057D E0                MOVX    A,@DPTR
057E F8                MOV     R0,A
057F A3                INC     DPTR
0580 E0                MOVX    A,@DPTR
0581 F9                MOV     R1,A
0582 A3                INC     DPTR
0583 E0                MOVX    A,@DPTR
0584 FA                MOV     R2,A
0585 A3                INC     DPTR
0586 E0                MOVX    A,@DPTR
0587 FB                MOV     R3,A
0588 E500        R     MOV     A,index
058A 25E0              ADD     A,ACC
058C 25E0              ADD     A,ACC
058E 2400        E     ADD     A,#LOW g_measOld
0590 F582              MOV     DPL,A
0592 E4                CLR     A
0593 3400        E     ADDC    A,#HIGH g_measOld
0595 F583              MOV     DPH,A
0597 E0                MOVX    A,@DPTR
0598 FC                MOV     R4,A
0599 A3                INC     DPTR
059A E0                MOVX    A,@DPTR
059B FD                MOV     R5,A
059C A3                INC     DPTR
059D E0                MOVX    A,@DPTR
059E FE                MOV     R6,A
059F A3                INC     DPTR
05A0 E0                MOVX    A,@DPTR
05A1 C3                CLR     C
05A2 9B                SUBB    A,R3
05A3 FF                MOV     R7,A
05A4 EE                MOV     A,R6
05A5 9A                SUBB    A,R2
05A6 FE                MOV     R6,A
05A7 ED                MOV     A,R5
05A8 99                SUBB    A,R1
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 45  

05A9 FD                MOV     R5,A
05AA EC                MOV     A,R4
05AB 98                SUBB    A,R0
05AC FC                MOV     R4,A
05AD AB00        R     MOV     R3,k_d_dl+03H
05AF AA00        R     MOV     R2,k_d_dl+02H
05B1 A900        R     MOV     R1,k_d_dl+01H
05B3 A800        R     MOV     R0,k_d_dl
05B5 120000      E     LCALL   ?C?LMUL
05B8 7810              MOV     R0,#010H
05BA 120000      E     LCALL   ?C?SLSHR
05BD E500        R     MOV     A,curr_ref+03H
05BF 2F                ADD     A,R7
05C0 F500        R     MOV     curr_ref+03H,A
05C2 E500        R     MOV     A,curr_ref+02H
05C4 3E                ADDC    A,R6
05C5 F500        R     MOV     curr_ref+02H,A
05C7 E500        R     MOV     A,curr_ref+01H
05C9 3D                ADDC    A,R5
05CA F500        R     MOV     curr_ref+01H,A
05CC E500        R     MOV     A,curr_ref
05CE 3C                ADDC    A,R4
05CF F500        R     MOV     curr_ref,A
05D1         ?C0074:
                                           ; SOURCE LINE # 625
05D1 300005            JNB     interrupt_flag,?C0075
                                           ; SOURCE LINE # 626
05D4 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 627
05D6 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 628
05D9         ?C0075:
                                           ; SOURCE LINE # 631
05D9 900000      E     MOV     DPTR,#c_mem+032H
05DC E0                MOVX    A,@DPTR
05DD FE                MOV     R6,A
05DE A3                INC     DPTR
05DF E0                MOVX    A,@DPTR
05E0 FF                MOV     R7,A
05E1 EE                MOV     A,R6
05E2 33                RLC     A
05E3 95E0              SUBB    A,ACC
05E5 FD                MOV     R5,A
05E6 FC                MOV     R4,A
05E7 AB00        R     MOV     R3,curr_ref+03H
05E9 AA00        R     MOV     R2,curr_ref+02H
05EB A900        R     MOV     R1,curr_ref+01H
05ED A800        R     MOV     R0,curr_ref
05EF D3                SETB    C
05F0 120000      E     LCALL   ?C?SLCMP
05F3 4016              JC      ?C0076
                                           ; SOURCE LINE # 632
05F5 900000      E     MOV     DPTR,#c_mem+032H
05F8 E0                MOVX    A,@DPTR
05F9 FE                MOV     R6,A
05FA A3                INC     DPTR
05FB E0                MOVX    A,@DPTR
05FC FF                MOV     R7,A
05FD EE                MOV     A,R6
05FE 33                RLC     A
05FF 95E0              SUBB    A,ACC
0601 8F00        R     MOV     curr_ref+03H,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 46  

0603 8E00        R     MOV     curr_ref+02H,R6
0605 F500        R     MOV     curr_ref+01H,A
0607 F500        R     MOV     curr_ref,A
0609 803C              SJMP    ?C0077
060B         ?C0076:
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
060B 900000      E     MOV     DPTR,#c_mem+032H
060E E0                MOVX    A,@DPTR
060F FE                MOV     R6,A
0610 A3                INC     DPTR
0611 E0                MOVX    A,@DPTR
0612 FF                MOV     R7,A
0613 C3                CLR     C
0614 E4                CLR     A
0615 9F                SUBB    A,R7
0616 FF                MOV     R7,A
0617 E4                CLR     A
0618 9E                SUBB    A,R6
0619 FE                MOV     R6,A
061A 33                RLC     A
061B 95E0              SUBB    A,ACC
061D FD                MOV     R5,A
061E FC                MOV     R4,A
061F AB00        R     MOV     R3,curr_ref+03H
0621 AA00        R     MOV     R2,curr_ref+02H
0623 A900        R     MOV     R1,curr_ref+01H
0625 A800        R     MOV     R0,curr_ref
0627 C3                CLR     C
0628 120000      E     LCALL   ?C?SLCMP
062B 501A              JNC     ?C0077
                                           ; SOURCE LINE # 635
062D 900000      E     MOV     DPTR,#c_mem+032H
0630 E0                MOVX    A,@DPTR
0631 FE                MOV     R6,A
0632 A3                INC     DPTR
0633 E0                MOVX    A,@DPTR
0634 FF                MOV     R7,A
0635 C3                CLR     C
0636 E4                CLR     A
0637 9F                SUBB    A,R7
0638 FF                MOV     R7,A
0639 E4                CLR     A
063A 9E                SUBB    A,R6
063B FE                MOV     R6,A
063C 33                RLC     A
063D 95E0              SUBB    A,ACC
063F 8F00        R     MOV     curr_ref+03H,R7
0641 8E00        R     MOV     curr_ref+02H,R6
0643 F500        R     MOV     curr_ref+01H,A
0645 F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 636
0647         ?C0077:
                                           ; SOURCE LINE # 638
0647 300005            JNB     interrupt_flag,?C0079
                                           ; SOURCE LINE # 639
064A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 640
064C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 641
064F         ?C0079:
                                           ; SOURCE LINE # 644
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 47  

064F E500        R     MOV     A,index
0651 25E0              ADD     A,ACC
0653 2400        E     ADD     A,#LOW g_meas+0CH
0655 F582              MOV     DPL,A
0657 E4                CLR     A
0658 3400        E     ADDC    A,#HIGH g_meas+0CH
065A F583              MOV     DPH,A
065C E0                MOVX    A,@DPTR
065D FE                MOV     R6,A
065E A3                INC     DPTR
065F E0                MOVX    A,@DPTR
0660 FF                MOV     R7,A
0661 FB                MOV     R3,A
0662 AA06              MOV     R2,AR6
0664 EA                MOV     A,R2
0665 33                RLC     A
0666 95E0              SUBB    A,ACC
0668 F9                MOV     R1,A
0669 F8                MOV     R0,A
066A C3                CLR     C
066B E500        R     MOV     A,curr_ref+03H
066D 9B                SUBB    A,R3
066E F500        R     MOV     curr_error+03H,A
0670 E500        R     MOV     A,curr_ref+02H
0672 9A                SUBB    A,R2
0673 F500        R     MOV     curr_error+02H,A
0675 E500        R     MOV     A,curr_ref+01H
0677 99                SUBB    A,R1
0678 F500        R     MOV     curr_error+01H,A
067A E500        R     MOV     A,curr_ref
067C 98                SUBB    A,R0
067D F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 646
067F E500        R     MOV     A,index
0681 25E0              ADD     A,ACC
0683 25E0              ADD     A,ACC
0685 2400        R     ADD     A,#LOW curr_error_sum
0687 F582              MOV     DPL,A
0689 E4                CLR     A
068A 3400        R     ADDC    A,#HIGH curr_error_sum
068C F583              MOV     DPH,A
068E C083              PUSH    DPH
0690 C082              PUSH    DPL
0692 E0                MOVX    A,@DPTR
0693 FC                MOV     R4,A
0694 A3                INC     DPTR
0695 E0                MOVX    A,@DPTR
0696 FD                MOV     R5,A
0697 A3                INC     DPTR
0698 E0                MOVX    A,@DPTR
0699 FE                MOV     R6,A
069A A3                INC     DPTR
069B E0                MOVX    A,@DPTR
069C 2500        R     ADD     A,curr_error+03H
069E FF                MOV     R7,A
069F EE                MOV     A,R6
06A0 3500        R     ADDC    A,curr_error+02H
06A2 FE                MOV     R6,A
06A3 ED                MOV     A,R5
06A4 3500        R     ADDC    A,curr_error+01H
06A6 FD                MOV     R5,A
06A7 EC                MOV     A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 48  

06A8 3500        R     ADDC    A,curr_error
06AA FC                MOV     R4,A
06AB D082              POP     DPL
06AD D083              POP     DPH
06AF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 648
06B2 E500        R     MOV     A,index
06B4 25E0              ADD     A,ACC
06B6 25E0              ADD     A,ACC
06B8 2400        R     ADD     A,#LOW curr_error_sum
06BA F582              MOV     DPL,A
06BC E4                CLR     A
06BD 3400        R     ADDC    A,#HIGH curr_error_sum
06BF F583              MOV     DPH,A
06C1 E0                MOVX    A,@DPTR
06C2 FC                MOV     R4,A
06C3 A3                INC     DPTR
06C4 E0                MOVX    A,@DPTR
06C5 FD                MOV     R5,A
06C6 A3                INC     DPTR
06C7 E0                MOVX    A,@DPTR
06C8 FE                MOV     R6,A
06C9 A3                INC     DPTR
06CA E0                MOVX    A,@DPTR
06CB FF                MOV     R7,A
06CC 7BA0              MOV     R3,#0A0H
06CE 7A86              MOV     R2,#086H
06D0 7901              MOV     R1,#01H
06D2 7800              MOV     R0,#00H
06D4 C3                CLR     C
06D5 120000      E     LCALL   ?C?SLCMP
06D8 501C              JNC     ?C0080
                                           ; SOURCE LINE # 649
06DA 7FA0              MOV     R7,#0A0H
06DC 7E86              MOV     R6,#086H
06DE 7D01              MOV     R5,#01H
06E0 7C00              MOV     R4,#00H
06E2 E500        R     MOV     A,index
06E4 25E0              ADD     A,ACC
06E6 25E0              ADD     A,ACC
06E8 2400        R     ADD     A,#LOW curr_error_sum
06EA F582              MOV     DPL,A
06EC E4                CLR     A
06ED 3400        R     ADDC    A,#HIGH curr_error_sum
06EF F583              MOV     DPH,A
06F1 120000      E     LCALL   ?C?LSTXDATA
06F4 8042              SJMP    ?C0081
06F6         ?C0080:
                                           ; SOURCE LINE # 650
                                           ; SOURCE LINE # 651
06F6 E500        R     MOV     A,index
06F8 25E0              ADD     A,ACC
06FA 25E0              ADD     A,ACC
06FC 2400        R     ADD     A,#LOW curr_error_sum
06FE F582              MOV     DPL,A
0700 E4                CLR     A
0701 3400        R     ADDC    A,#HIGH curr_error_sum
0703 F583              MOV     DPH,A
0705 E0                MOVX    A,@DPTR
0706 FC                MOV     R4,A
0707 A3                INC     DPTR
0708 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 49  

0709 FD                MOV     R5,A
070A A3                INC     DPTR
070B E0                MOVX    A,@DPTR
070C FE                MOV     R6,A
070D A3                INC     DPTR
070E E0                MOVX    A,@DPTR
070F FF                MOV     R7,A
0710 7B60              MOV     R3,#060H
0712 7A79              MOV     R2,#079H
0714 79FE              MOV     R1,#0FEH
0716 78FF              MOV     R0,#0FFH
0718 D3                SETB    C
0719 120000      E     LCALL   ?C?SLCMP
071C 401A              JC      ?C0081
                                           ; SOURCE LINE # 652
071E 7F60              MOV     R7,#060H
0720 7E79              MOV     R6,#079H
0722 7DFE              MOV     R5,#0FEH
0724 7CFF              MOV     R4,#0FFH
0726 E500        R     MOV     A,index
0728 25E0              ADD     A,ACC
072A 25E0              ADD     A,ACC
072C 2400        R     ADD     A,#LOW curr_error_sum
072E F582              MOV     DPL,A
0730 E4                CLR     A
0731 3400        R     ADDC    A,#HIGH curr_error_sum
0733 F583              MOV     DPH,A
0735 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 653
0738         ?C0081:
                                           ; SOURCE LINE # 655
0738 300005            JNB     interrupt_flag,?C0083
                                           ; SOURCE LINE # 656
073B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 657
073D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 658
0740         ?C0083:
                                           ; SOURCE LINE # 662
0740 E4                CLR     A
0741 F500        R     MOV     pwm_input+03H,A
0743 F500        R     MOV     pwm_input+02H,A
0745 F500        R     MOV     pwm_input+01H,A
0747 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 665
0749 FF                MOV     R7,A
074A FE                MOV     R6,A
074B FD                MOV     R5,A
074C FC                MOV     R4,A
074D AB00        R     MOV     R3,k_p_c_dl+03H
074F AA00        R     MOV     R2,k_p_c_dl+02H
0751 A900        R     MOV     R1,k_p_c_dl+01H
0753 A800        R     MOV     R0,k_p_c_dl
0755 C3                CLR     C
0756 120000      E     LCALL   ?C?SLCMP
0759 6026              JZ      ?C0084
                                           ; SOURCE LINE # 666
075B AF00        R     MOV     R7,curr_error+03H
075D AE00        R     MOV     R6,curr_error+02H
075F AD00        R     MOV     R5,curr_error+01H
0761 AC00        R     MOV     R4,curr_error
0763 A800        R     MOV     R0,k_p_c_dl
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 50  

0765 120000      E     LCALL   ?C?LMUL
0768 7810              MOV     R0,#010H
076A 120000      E     LCALL   ?C?SLSHR
076D E500        R     MOV     A,pwm_input+03H
076F 2F                ADD     A,R7
0770 F500        R     MOV     pwm_input+03H,A
0772 E500        R     MOV     A,pwm_input+02H
0774 3E                ADDC    A,R6
0775 F500        R     MOV     pwm_input+02H,A
0777 E500        R     MOV     A,pwm_input+01H
0779 3D                ADDC    A,R5
077A F500        R     MOV     pwm_input+01H,A
077C E500        R     MOV     A,pwm_input
077E 3C                ADDC    A,R4
077F F500        R     MOV     pwm_input,A
0781         ?C0084:
                                           ; SOURCE LINE # 669
0781 E4                CLR     A
0782 FF                MOV     R7,A
0783 FE                MOV     R6,A
0784 FD                MOV     R5,A
0785 FC                MOV     R4,A
0786 AB00        R     MOV     R3,k_i_c_dl+03H
0788 AA00        R     MOV     R2,k_i_c_dl+02H
078A A900        R     MOV     R1,k_i_c_dl+01H
078C A800        R     MOV     R0,k_i_c_dl
078E C3                CLR     C
078F 120000      E     LCALL   ?C?SLCMP
0792 6038              JZ      ?C0085
                                           ; SOURCE LINE # 670
0794 E500        R     MOV     A,index
0796 25E0              ADD     A,ACC
0798 25E0              ADD     A,ACC
079A 2400        R     ADD     A,#LOW curr_error_sum
079C F582              MOV     DPL,A
079E E4                CLR     A
079F 3400        R     ADDC    A,#HIGH curr_error_sum
07A1 F583              MOV     DPH,A
07A3 E0                MOVX    A,@DPTR
07A4 FC                MOV     R4,A
07A5 A3                INC     DPTR
07A6 E0                MOVX    A,@DPTR
07A7 FD                MOV     R5,A
07A8 A3                INC     DPTR
07A9 E0                MOVX    A,@DPTR
07AA FE                MOV     R6,A
07AB A3                INC     DPTR
07AC E0                MOVX    A,@DPTR
07AD FF                MOV     R7,A
07AE A800        R     MOV     R0,k_i_c_dl
07B0 120000      E     LCALL   ?C?LMUL
07B3 7810              MOV     R0,#010H
07B5 120000      E     LCALL   ?C?SLSHR
07B8 E500        R     MOV     A,pwm_input+03H
07BA 2F                ADD     A,R7
07BB F500        R     MOV     pwm_input+03H,A
07BD E500        R     MOV     A,pwm_input+02H
07BF 3E                ADDC    A,R6
07C0 F500        R     MOV     pwm_input+02H,A
07C2 E500        R     MOV     A,pwm_input+01H
07C4 3D                ADDC    A,R5
07C5 F500        R     MOV     pwm_input+01H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 51  

07C7 E500        R     MOV     A,pwm_input
07C9 3C                ADDC    A,R4
07CA F500        R     MOV     pwm_input,A
07CC         ?C0085:
                                           ; SOURCE LINE # 673
07CC E4                CLR     A
07CD FF                MOV     R7,A
07CE FE                MOV     R6,A
07CF FD                MOV     R5,A
07D0 FC                MOV     R4,A
07D1 AB00        R     MOV     R3,k_d_c_dl+03H
07D3 AA00        R     MOV     R2,k_d_c_dl+02H
07D5 A900        R     MOV     R1,k_d_c_dl+01H
07D7 A800        R     MOV     R0,k_d_c_dl
07D9 C3                CLR     C
07DA 120000      E     LCALL   ?C?SLCMP
07DD 6064              JZ      ?C0086
                                           ; SOURCE LINE # 674
07DF E500        R     MOV     A,index
07E1 25E0              ADD     A,ACC
07E3 2400        E     ADD     A,#LOW g_meas+0CH
07E5 F582              MOV     DPL,A
07E7 E4                CLR     A
07E8 3400        E     ADDC    A,#HIGH g_meas+0CH
07EA F583              MOV     DPH,A
07EC E0                MOVX    A,@DPTR
07ED FE                MOV     R6,A
07EE A3                INC     DPTR
07EF E0                MOVX    A,@DPTR
07F0 FF                MOV     R7,A
07F1 FB                MOV     R3,A
07F2 AA06              MOV     R2,AR6
07F4 EA                MOV     A,R2
07F5 33                RLC     A
07F6 95E0              SUBB    A,ACC
07F8 F9                MOV     R1,A
07F9 F8                MOV     R0,A
07FA E500        R     MOV     A,index
07FC 25E0              ADD     A,ACC
07FE 25E0              ADD     A,ACC
0800 2400        R     ADD     A,#LOW prev_curr
0802 F582              MOV     DPL,A
0804 E4                CLR     A
0805 3400        R     ADDC    A,#HIGH prev_curr
0807 F583              MOV     DPH,A
0809 E0                MOVX    A,@DPTR
080A FC                MOV     R4,A
080B A3                INC     DPTR
080C E0                MOVX    A,@DPTR
080D FD                MOV     R5,A
080E A3                INC     DPTR
080F E0                MOVX    A,@DPTR
0810 FE                MOV     R6,A
0811 A3                INC     DPTR
0812 E0                MOVX    A,@DPTR
0813 C3                CLR     C
0814 9B                SUBB    A,R3
0815 FF                MOV     R7,A
0816 EE                MOV     A,R6
0817 9A                SUBB    A,R2
0818 FE                MOV     R6,A
0819 ED                MOV     A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 52  

081A 99                SUBB    A,R1
081B FD                MOV     R5,A
081C EC                MOV     A,R4
081D 98                SUBB    A,R0
081E FC                MOV     R4,A
081F AB00        R     MOV     R3,k_d_c_dl+03H
0821 AA00        R     MOV     R2,k_d_c_dl+02H
0823 A900        R     MOV     R1,k_d_c_dl+01H
0825 A800        R     MOV     R0,k_d_c_dl
0827 120000      E     LCALL   ?C?LMUL
082A 7810              MOV     R0,#010H
082C 120000      E     LCALL   ?C?SLSHR
082F E500        R     MOV     A,pwm_input+03H
0831 2F                ADD     A,R7
0832 F500        R     MOV     pwm_input+03H,A
0834 E500        R     MOV     A,pwm_input+02H
0836 3E                ADDC    A,R6
0837 F500        R     MOV     pwm_input+02H,A
0839 E500        R     MOV     A,pwm_input+01H
083B 3D                ADDC    A,R5
083C F500        R     MOV     pwm_input+01H,A
083E E500        R     MOV     A,pwm_input
0840 3C                ADDC    A,R4
0841 F500        R     MOV     pwm_input,A
0843         ?C0086:
                                           ; SOURCE LINE # 677
0843 E500        R     MOV     A,index
0845 25E0              ADD     A,ACC
0847 2400        E     ADD     A,#LOW g_meas+0CH
0849 F582              MOV     DPL,A
084B E4                CLR     A
084C 3400        E     ADDC    A,#HIGH g_meas+0CH
084E F583              MOV     DPH,A
0850 E0                MOVX    A,@DPTR
0851 FE                MOV     R6,A
0852 A3                INC     DPTR
0853 E0                MOVX    A,@DPTR
0854 FF                MOV     R7,A
0855 EE                MOV     A,R6
0856 33                RLC     A
0857 95E0              SUBB    A,ACC
0859 FD                MOV     R5,A
085A FC                MOV     R4,A
085B E500        R     MOV     A,index
085D 25E0              ADD     A,ACC
085F 25E0              ADD     A,ACC
0861 2400        R     ADD     A,#LOW prev_curr
0863 F582              MOV     DPL,A
0865 E4                CLR     A
0866 3400        R     ADDC    A,#HIGH prev_curr
0868 F583              MOV     DPH,A
086A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 679
086D 300005            JNB     interrupt_flag,?C0087
                                           ; SOURCE LINE # 680
0870 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 681
0872 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 682
0875         ?C0087:
                                           ; SOURCE LINE # 684
0875 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 53  

0877 701C              JNZ     ?C0088
                                           ; SOURCE LINE # 685
0879 FF                MOV     R7,A
087A FE                MOV     R6,A
087B FD                MOV     R5,A
087C FC                MOV     R4,A
087D AB00        R     MOV     R3,pwm_input+03H
087F AA00        R     MOV     R2,pwm_input+02H
0881 A900        R     MOV     R1,pwm_input+01H
0883 A800        R     MOV     R0,pwm_input
0885 C3                CLR     C
0886 120000      E     LCALL   ?C?SLCMP
0889 4005              JC      ?C0089
                                           ; SOURCE LINE # 686
088B D200        R     SETB    dirM0
088D 020000      R     LJMP    ?C0045
0890         ?C0089:
                                           ; SOURCE LINE # 689
0890 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 691
0892 020000      R     LJMP    ?C0045
0895         ?C0088:
                                           ; SOURCE LINE # 692
0895 E4                CLR     A
0896 FF                MOV     R7,A
0897 FE                MOV     R6,A
0898 FD                MOV     R5,A
0899 FC                MOV     R4,A
089A AB00        R     MOV     R3,pwm_input+03H
089C AA00        R     MOV     R2,pwm_input+02H
089E A900        R     MOV     R1,pwm_input+01H
08A0 A800        R     MOV     R0,pwm_input
08A2 C3                CLR     C
08A3 120000      E     LCALL   ?C?SLCMP
08A6 4005              JC      ?C0092
                                           ; SOURCE LINE # 693
08A8 D200        R     SETB    dirM1
08AA 020000      R     LJMP    ?C0045
08AD         ?C0092:
                                           ; SOURCE LINE # 696
08AD C200        R     CLR     dirM1
                                           ; SOURCE LINE # 698
                                           ; SOURCE LINE # 700
08AF 020000      R     LJMP    ?C0045
                                           ; SOURCE LINE # 702
08B2         ?C0094:
                                           ; SOURCE LINE # 705
08B2 E500        R     MOV     A,index
08B4 25E0              ADD     A,ACC
08B6 25E0              ADD     A,ACC
08B8 2400        E     ADD     A,#LOW g_ref
08BA F582              MOV     DPL,A
08BC E4                CLR     A
08BD 3400        E     ADDC    A,#HIGH g_ref
08BF F583              MOV     DPH,A
08C1 E0                MOVX    A,@DPTR
08C2 FC                MOV     R4,A
08C3 A3                INC     DPTR
08C4 E0                MOVX    A,@DPTR
08C5 FD                MOV     R5,A
08C6 A3                INC     DPTR
08C7 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 54  

08C8 FE                MOV     R6,A
08C9 A3                INC     DPTR
08CA E0                MOVX    A,@DPTR
08CB FF                MOV     R7,A
08CC 7400        E     MOV     A,#LOW g_mem+037H
08CE 2500        R     ADD     A,index
08D0 F582              MOV     DPL,A
08D2 E4                CLR     A
08D3 3400        E     ADDC    A,#HIGH g_mem+037H
08D5 F583              MOV     DPH,A
08D7 E0                MOVX    A,@DPTR
08D8 F9                MOV     R1,A
08D9 F8                MOV     R0,A
08DA 120000      E     LCALL   ?C?SLSHR
08DD 8F00        R     MOV     curr_ref+03H,R7
08DF 8E00        R     MOV     curr_ref+02H,R6
08E1 8D00        R     MOV     curr_ref+01H,R5
08E3 8C00        R     MOV     curr_ref,R4
                                           ; SOURCE LINE # 708
08E5 900000      E     MOV     DPTR,#c_mem+032H
08E8 E0                MOVX    A,@DPTR
08E9 FE                MOV     R6,A
08EA A3                INC     DPTR
08EB E0                MOVX    A,@DPTR
08EC FF                MOV     R7,A
08ED EE                MOV     A,R6
08EE 33                RLC     A
08EF 95E0              SUBB    A,ACC
08F1 FD                MOV     R5,A
08F2 FC                MOV     R4,A
08F3 AB00        R     MOV     R3,curr_ref+03H
08F5 AA00        R     MOV     R2,curr_ref+02H
08F7 A900        R     MOV     R1,curr_ref+01H
08F9 A800        R     MOV     R0,curr_ref
08FB D3                SETB    C
08FC 120000      E     LCALL   ?C?SLCMP
08FF 4014              JC      ?C0095
                                           ; SOURCE LINE # 709
0901 900000      E     MOV     DPTR,#c_mem+032H
0904 E0                MOVX    A,@DPTR
0905 FE                MOV     R6,A
0906 A3                INC     DPTR
0907 E0                MOVX    A,@DPTR
0908 FF                MOV     R7,A
0909 EE                MOV     A,R6
090A 33                RLC     A
090B 95E0              SUBB    A,ACC
090D 8F00        R     MOV     curr_ref+03H,R7
090F 8E00        R     MOV     curr_ref+02H,R6
0911 F500        R     MOV     curr_ref+01H,A
0913 F500        R     MOV     curr_ref,A
0915         ?C0095:
                                           ; SOURCE LINE # 712
0915 AE00        R     MOV     R6,curr_ref+02H
0917 AF00        R     MOV     R7,curr_ref+03H
0919 120000      E     LCALL   _abs
091C E500        R     MOV     A,index
091E 25E0              ADD     A,ACC
0920 2400        E     ADD     A,#LOW g_meas+0CH
0922 F582              MOV     DPL,A
0924 E4                CLR     A
0925 3400        E     ADDC    A,#HIGH g_meas+0CH
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 55  

0927 F583              MOV     DPH,A
0929 E0                MOVX    A,@DPTR
092A FC                MOV     R4,A
092B A3                INC     DPTR
092C E0                MOVX    A,@DPTR
092D FD                MOV     R5,A
092E C3                CLR     C
092F EF                MOV     A,R7
0930 9D                SUBB    A,R5
0931 FF                MOV     R7,A
0932 EE                MOV     A,R6
0933 9C                SUBB    A,R4
0934 FE                MOV     R6,A
0935 33                RLC     A
0936 95E0              SUBB    A,ACC
0938 8F00        R     MOV     curr_error+03H,R7
093A 8E00        R     MOV     curr_error+02H,R6
093C F500        R     MOV     curr_error+01H,A
093E F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 715
0940 E500        R     MOV     A,index
0942 25E0              ADD     A,ACC
0944 25E0              ADD     A,ACC
0946 2400        R     ADD     A,#LOW curr_error_sum
0948 F582              MOV     DPL,A
094A E4                CLR     A
094B 3400        R     ADDC    A,#HIGH curr_error_sum
094D F583              MOV     DPH,A
094F C083              PUSH    DPH
0951 C082              PUSH    DPL
0953 E0                MOVX    A,@DPTR
0954 FC                MOV     R4,A
0955 A3                INC     DPTR
0956 E0                MOVX    A,@DPTR
0957 FD                MOV     R5,A
0958 A3                INC     DPTR
0959 E0                MOVX    A,@DPTR
095A FE                MOV     R6,A
095B A3                INC     DPTR
095C E0                MOVX    A,@DPTR
095D 2500        R     ADD     A,curr_error+03H
095F FF                MOV     R7,A
0960 EE                MOV     A,R6
0961 3500        R     ADDC    A,curr_error+02H
0963 FE                MOV     R6,A
0964 ED                MOV     A,R5
0965 3500        R     ADDC    A,curr_error+01H
0967 FD                MOV     R5,A
0968 EC                MOV     A,R4
0969 3500        R     ADDC    A,curr_error
096B FC                MOV     R4,A
096C D082              POP     DPL
096E D083              POP     DPH
0970 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 718
0973 E500        R     MOV     A,index
0975 25E0              ADD     A,ACC
0977 25E0              ADD     A,ACC
0979 2400        R     ADD     A,#LOW curr_error_sum
097B F582              MOV     DPL,A
097D E4                CLR     A
097E 3400        R     ADDC    A,#HIGH curr_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 56  

0980 F583              MOV     DPH,A
0982 E0                MOVX    A,@DPTR
0983 FC                MOV     R4,A
0984 A3                INC     DPTR
0985 E0                MOVX    A,@DPTR
0986 FD                MOV     R5,A
0987 A3                INC     DPTR
0988 E0                MOVX    A,@DPTR
0989 FE                MOV     R6,A
098A A3                INC     DPTR
098B E0                MOVX    A,@DPTR
098C FF                MOV     R7,A
098D 7BA0              MOV     R3,#0A0H
098F 7A86              MOV     R2,#086H
0991 7901              MOV     R1,#01H
0993 7800              MOV     R0,#00H
0995 C3                CLR     C
0996 120000      E     LCALL   ?C?SLCMP
0999 501C              JNC     ?C0096
                                           ; SOURCE LINE # 719
099B 7FA0              MOV     R7,#0A0H
099D 7E86              MOV     R6,#086H
099F 7D01              MOV     R5,#01H
09A1 7C00              MOV     R4,#00H
09A3 E500        R     MOV     A,index
09A5 25E0              ADD     A,ACC
09A7 25E0              ADD     A,ACC
09A9 2400        R     ADD     A,#LOW curr_error_sum
09AB F582              MOV     DPL,A
09AD E4                CLR     A
09AE 3400        R     ADDC    A,#HIGH curr_error_sum
09B0 F583              MOV     DPH,A
09B2 120000      E     LCALL   ?C?LSTXDATA
09B5 803C              SJMP    ?C0097
09B7         ?C0096:
                                           ; SOURCE LINE # 720
                                           ; SOURCE LINE # 721
09B7 E500        R     MOV     A,index
09B9 25E0              ADD     A,ACC
09BB 25E0              ADD     A,ACC
09BD 2400        R     ADD     A,#LOW curr_error_sum
09BF F582              MOV     DPL,A
09C1 E4                CLR     A
09C2 3400        R     ADDC    A,#HIGH curr_error_sum
09C4 F583              MOV     DPH,A
09C6 E0                MOVX    A,@DPTR
09C7 FC                MOV     R4,A
09C8 A3                INC     DPTR
09C9 E0                MOVX    A,@DPTR
09CA FD                MOV     R5,A
09CB A3                INC     DPTR
09CC E0                MOVX    A,@DPTR
09CD FE                MOV     R6,A
09CE A3                INC     DPTR
09CF E0                MOVX    A,@DPTR
09D0 FF                MOV     R7,A
09D1 E4                CLR     A
09D2 FB                MOV     R3,A
09D3 FA                MOV     R2,A
09D4 F9                MOV     R1,A
09D5 F8                MOV     R0,A
09D6 D3                SETB    C
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 57  

09D7 120000      E     LCALL   ?C?SLCMP
09DA 4017              JC      ?C0097
                                           ; SOURCE LINE # 722
09DC E4                CLR     A
09DD FF                MOV     R7,A
09DE FE                MOV     R6,A
09DF FD                MOV     R5,A
09E0 FC                MOV     R4,A
09E1 E500        R     MOV     A,index
09E3 25E0              ADD     A,ACC
09E5 25E0              ADD     A,ACC
09E7 2400        R     ADD     A,#LOW curr_error_sum
09E9 F582              MOV     DPL,A
09EB E4                CLR     A
09EC 3400        R     ADDC    A,#HIGH curr_error_sum
09EE F583              MOV     DPH,A
09F0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 723
09F3         ?C0097:
                                           ; SOURCE LINE # 726
09F3 E4                CLR     A
09F4 F500        R     MOV     pwm_input+03H,A
09F6 F500        R     MOV     pwm_input+02H,A
09F8 F500        R     MOV     pwm_input+01H,A
09FA F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 729
09FC FF                MOV     R7,A
09FD FE                MOV     R6,A
09FE FD                MOV     R5,A
09FF FC                MOV     R4,A
0A00 AB00        R     MOV     R3,k_p_c+03H
0A02 AA00        R     MOV     R2,k_p_c+02H
0A04 A900        R     MOV     R1,k_p_c+01H
0A06 A800        R     MOV     R0,k_p_c
0A08 C3                CLR     C
0A09 120000      E     LCALL   ?C?SLCMP
0A0C 602C              JZ      ?C0099
                                           ; SOURCE LINE # 730
0A0E AF00        R     MOV     R7,curr_error+03H
0A10 AE00        R     MOV     R6,curr_error+02H
0A12 AD00        R     MOV     R5,curr_error+01H
0A14 AC00        R     MOV     R4,curr_error
0A16 AB00        R     MOV     R3,k_p+03H
0A18 AA00        R     MOV     R2,k_p+02H
0A1A A900        R     MOV     R1,k_p+01H
0A1C A800        R     MOV     R0,k_p
0A1E 120000      E     LCALL   ?C?LMUL
0A21 7810              MOV     R0,#010H
0A23 120000      E     LCALL   ?C?SLSHR
0A26 E500        R     MOV     A,pwm_input+03H
0A28 2F                ADD     A,R7
0A29 F500        R     MOV     pwm_input+03H,A
0A2B E500        R     MOV     A,pwm_input+02H
0A2D 3E                ADDC    A,R6
0A2E F500        R     MOV     pwm_input+02H,A
0A30 E500        R     MOV     A,pwm_input+01H
0A32 3D                ADDC    A,R5
0A33 F500        R     MOV     pwm_input+01H,A
0A35 E500        R     MOV     A,pwm_input
0A37 3C                ADDC    A,R4
0A38 F500        R     MOV     pwm_input,A
0A3A         ?C0099:
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 58  

                                           ; SOURCE LINE # 734
0A3A E4                CLR     A
0A3B FF                MOV     R7,A
0A3C FE                MOV     R6,A
0A3D FD                MOV     R5,A
0A3E FC                MOV     R4,A
0A3F AB00        R     MOV     R3,k_i_c+03H
0A41 AA00        R     MOV     R2,k_i_c+02H
0A43 A900        R     MOV     R1,k_i_c+01H
0A45 A800        R     MOV     R0,k_i_c
0A47 C3                CLR     C
0A48 120000      E     LCALL   ?C?SLCMP
0A4B 603D              JZ      ?C0100
                                           ; SOURCE LINE # 735
0A4D E500        R     MOV     A,index
0A4F 25E0              ADD     A,ACC
0A51 25E0              ADD     A,ACC
0A53 2400        R     ADD     A,#LOW curr_error_sum
0A55 F582              MOV     DPL,A
0A57 E4                CLR     A
0A58 3400        R     ADDC    A,#HIGH curr_error_sum
0A5A F583              MOV     DPH,A
0A5C E0                MOVX    A,@DPTR
0A5D FC                MOV     R4,A
0A5E A3                INC     DPTR
0A5F E0                MOVX    A,@DPTR
0A60 FD                MOV     R5,A
0A61 A3                INC     DPTR
0A62 E0                MOVX    A,@DPTR
0A63 FE                MOV     R6,A
0A64 A3                INC     DPTR
0A65 E0                MOVX    A,@DPTR
0A66 FF                MOV     R7,A
0A67 7806              MOV     R0,#06H
0A69 120000      E     LCALL   ?C?SLSHR
0A6C A800        R     MOV     R0,k_i_c
0A6E 120000      E     LCALL   ?C?LMUL
0A71 780A              MOV     R0,#0AH
0A73 120000      E     LCALL   ?C?SLSHR
0A76 E500        R     MOV     A,pwm_input+03H
0A78 2F                ADD     A,R7
0A79 F500        R     MOV     pwm_input+03H,A
0A7B E500        R     MOV     A,pwm_input+02H
0A7D 3E                ADDC    A,R6
0A7E F500        R     MOV     pwm_input+02H,A
0A80 E500        R     MOV     A,pwm_input+01H
0A82 3D                ADDC    A,R5
0A83 F500        R     MOV     pwm_input+01H,A
0A85 E500        R     MOV     A,pwm_input
0A87 3C                ADDC    A,R4
0A88 F500        R     MOV     pwm_input,A
0A8A         ?C0100:
                                           ; SOURCE LINE # 738
0A8A E4                CLR     A
0A8B FF                MOV     R7,A
0A8C FE                MOV     R6,A
0A8D FD                MOV     R5,A
0A8E FC                MOV     R4,A
0A8F AB00        R     MOV     R3,k_d_c+03H
0A91 AA00        R     MOV     R2,k_d_c+02H
0A93 A900        R     MOV     R1,k_d_c+01H
0A95 A800        R     MOV     R0,k_d_c
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 59  

0A97 C3                CLR     C
0A98 120000      E     LCALL   ?C?SLCMP
0A9B 6064              JZ      ?C0101
                                           ; SOURCE LINE # 739
0A9D E500        R     MOV     A,index
0A9F 25E0              ADD     A,ACC
0AA1 2400        E     ADD     A,#LOW g_meas+0CH
0AA3 F582              MOV     DPL,A
0AA5 E4                CLR     A
0AA6 3400        E     ADDC    A,#HIGH g_meas+0CH
0AA8 F583              MOV     DPH,A
0AAA E0                MOVX    A,@DPTR
0AAB FE                MOV     R6,A
0AAC A3                INC     DPTR
0AAD E0                MOVX    A,@DPTR
0AAE FF                MOV     R7,A
0AAF FB                MOV     R3,A
0AB0 AA06              MOV     R2,AR6
0AB2 EA                MOV     A,R2
0AB3 33                RLC     A
0AB4 95E0              SUBB    A,ACC
0AB6 F9                MOV     R1,A
0AB7 F8                MOV     R0,A
0AB8 E500        R     MOV     A,index
0ABA 25E0              ADD     A,ACC
0ABC 25E0              ADD     A,ACC
0ABE 2400        R     ADD     A,#LOW prev_curr
0AC0 F582              MOV     DPL,A
0AC2 E4                CLR     A
0AC3 3400        R     ADDC    A,#HIGH prev_curr
0AC5 F583              MOV     DPH,A
0AC7 E0                MOVX    A,@DPTR
0AC8 FC                MOV     R4,A
0AC9 A3                INC     DPTR
0ACA E0                MOVX    A,@DPTR
0ACB FD                MOV     R5,A
0ACC A3                INC     DPTR
0ACD E0                MOVX    A,@DPTR
0ACE FE                MOV     R6,A
0ACF A3                INC     DPTR
0AD0 E0                MOVX    A,@DPTR
0AD1 C3                CLR     C
0AD2 9B                SUBB    A,R3
0AD3 FF                MOV     R7,A
0AD4 EE                MOV     A,R6
0AD5 9A                SUBB    A,R2
0AD6 FE                MOV     R6,A
0AD7 ED                MOV     A,R5
0AD8 99                SUBB    A,R1
0AD9 FD                MOV     R5,A
0ADA EC                MOV     A,R4
0ADB 98                SUBB    A,R0
0ADC FC                MOV     R4,A
0ADD AB00        R     MOV     R3,k_d_c+03H
0ADF AA00        R     MOV     R2,k_d_c+02H
0AE1 A900        R     MOV     R1,k_d_c+01H
0AE3 A800        R     MOV     R0,k_d_c
0AE5 120000      E     LCALL   ?C?LMUL
0AE8 7810              MOV     R0,#010H
0AEA 120000      E     LCALL   ?C?SLSHR
0AED E500        R     MOV     A,pwm_input+03H
0AEF 2F                ADD     A,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 60  

0AF0 F500        R     MOV     pwm_input+03H,A
0AF2 E500        R     MOV     A,pwm_input+02H
0AF4 3E                ADDC    A,R6
0AF5 F500        R     MOV     pwm_input+02H,A
0AF7 E500        R     MOV     A,pwm_input+01H
0AF9 3D                ADDC    A,R5
0AFA F500        R     MOV     pwm_input+01H,A
0AFC E500        R     MOV     A,pwm_input
0AFE 3C                ADDC    A,R4
0AFF F500        R     MOV     pwm_input,A
0B01         ?C0101:
                                           ; SOURCE LINE # 742
0B01 E4                CLR     A
0B02 FF                MOV     R7,A
0B03 FE                MOV     R6,A
0B04 FD                MOV     R5,A
0B05 FC                MOV     R4,A
0B06 AB00        R     MOV     R3,pwm_input+03H
0B08 AA00        R     MOV     R2,pwm_input+02H
0B0A A900        R     MOV     R1,pwm_input+01H
0B0C A800        R     MOV     R0,pwm_input
0B0E C3                CLR     C
0B0F 120000      E     LCALL   ?C?SLCMP
0B12 5009              JNC     ?C0102
                                           ; SOURCE LINE # 743
0B14 E4                CLR     A
0B15 F500        R     MOV     pwm_input+03H,A
0B17 F500        R     MOV     pwm_input+02H,A
0B19 F500        R     MOV     pwm_input+01H,A
0B1B F500        R     MOV     pwm_input,A
0B1D         ?C0102:
                                           ; SOURCE LINE # 746
0B1D E500        R     MOV     A,index
0B1F 25E0              ADD     A,ACC
0B21 2400        E     ADD     A,#LOW g_meas+0CH
0B23 F582              MOV     DPL,A
0B25 E4                CLR     A
0B26 3400        E     ADDC    A,#HIGH g_meas+0CH
0B28 F583              MOV     DPH,A
0B2A E0                MOVX    A,@DPTR
0B2B FE                MOV     R6,A
0B2C A3                INC     DPTR
0B2D E0                MOVX    A,@DPTR
0B2E FF                MOV     R7,A
0B2F EE                MOV     A,R6
0B30 33                RLC     A
0B31 95E0              SUBB    A,ACC
0B33 FD                MOV     R5,A
0B34 FC                MOV     R4,A
0B35 E500        R     MOV     A,index
0B37 25E0              ADD     A,ACC
0B39 25E0              ADD     A,ACC
0B3B 2400        R     ADD     A,#LOW prev_curr
0B3D F582              MOV     DPL,A
0B3F E4                CLR     A
0B40 3400        R     ADDC    A,#HIGH prev_curr
0B42 F583              MOV     DPH,A
0B44 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 748
0B47 E500        R     MOV     A,index
0B49 701C              JNZ     ?C0103
                                           ; SOURCE LINE # 749
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 61  

0B4B FF                MOV     R7,A
0B4C FE                MOV     R6,A
0B4D FD                MOV     R5,A
0B4E FC                MOV     R4,A
0B4F AB00        R     MOV     R3,pwm_input+03H
0B51 AA00        R     MOV     R2,pwm_input+02H
0B53 A900        R     MOV     R1,pwm_input+01H
0B55 A800        R     MOV     R0,pwm_input
0B57 C3                CLR     C
0B58 120000      E     LCALL   ?C?SLCMP
0B5B 4005              JC      ?C0104
                                           ; SOURCE LINE # 750
0B5D D200        R     SETB    dirM0
0B5F 020000      R     LJMP    ?C0045
0B62         ?C0104:
                                           ; SOURCE LINE # 753
0B62 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 755
0B64 020000      R     LJMP    ?C0045
0B67         ?C0103:
                                           ; SOURCE LINE # 756
0B67 E4                CLR     A
0B68 FF                MOV     R7,A
0B69 FE                MOV     R6,A
0B6A FD                MOV     R5,A
0B6B FC                MOV     R4,A
0B6C AB00        R     MOV     R3,pwm_input+03H
0B6E AA00        R     MOV     R2,pwm_input+02H
0B70 A900        R     MOV     R1,pwm_input+01H
0B72 A800        R     MOV     R0,pwm_input
0B74 C3                CLR     C
0B75 120000      E     LCALL   ?C?SLCMP
0B78 4004              JC      ?C0107
                                           ; SOURCE LINE # 757
0B7A D200        R     SETB    dirM1
0B7C 806E              SJMP    ?C0045
0B7E         ?C0107:
                                           ; SOURCE LINE # 760
0B7E C200        R     CLR     dirM1
                                           ; SOURCE LINE # 762
                                           ; SOURCE LINE # 764
0B80 806A              SJMP    ?C0045
                                           ; SOURCE LINE # 766
0B82         ?C0109:
                                           ; SOURCE LINE # 768
0B82 E500        R     MOV     A,index
0B84 25E0              ADD     A,ACC
0B86 25E0              ADD     A,ACC
0B88 2400        E     ADD     A,#LOW g_ref
0B8A F582              MOV     DPL,A
0B8C E4                CLR     A
0B8D 3400        E     ADDC    A,#HIGH g_ref
0B8F F583              MOV     DPH,A
0B91 E0                MOVX    A,@DPTR
0B92 FC                MOV     R4,A
0B93 A3                INC     DPTR
0B94 E0                MOVX    A,@DPTR
0B95 FD                MOV     R5,A
0B96 A3                INC     DPTR
0B97 E0                MOVX    A,@DPTR
0B98 FE                MOV     R6,A
0B99 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 62  

0B9A E0                MOVX    A,@DPTR
0B9B FF                MOV     R7,A
0B9C 7400        E     MOV     A,#LOW g_mem+037H
0B9E 2500        R     ADD     A,index
0BA0 F582              MOV     DPL,A
0BA2 E4                CLR     A
0BA3 3400        E     ADDC    A,#HIGH g_mem+037H
0BA5 F583              MOV     DPH,A
0BA7 E0                MOVX    A,@DPTR
0BA8 F9                MOV     R1,A
0BA9 F8                MOV     R0,A
0BAA 120000      E     LCALL   ?C?SLSHR
0BAD 8F00        R     MOV     pwm_input+03H,R7
0BAF 8E00        R     MOV     pwm_input+02H,R6
0BB1 8D00        R     MOV     pwm_input+01H,R5
0BB3 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 770
0BB5 E500        R     MOV     A,index
0BB7 701A              JNZ     ?C0110
                                           ; SOURCE LINE # 771
0BB9 FF                MOV     R7,A
0BBA FE                MOV     R6,A
0BBB FD                MOV     R5,A
0BBC FC                MOV     R4,A
0BBD AB00        R     MOV     R3,pwm_input+03H
0BBF AA00        R     MOV     R2,pwm_input+02H
0BC1 A900        R     MOV     R1,pwm_input+01H
0BC3 A800        R     MOV     R0,pwm_input
0BC5 C3                CLR     C
0BC6 120000      E     LCALL   ?C?SLCMP
0BC9 4004              JC      ?C0111
                                           ; SOURCE LINE # 772
0BCB D200        R     SETB    dirM0
0BCD 801D              SJMP    ?C0045
0BCF         ?C0111:
                                           ; SOURCE LINE # 775
0BCF C200        R     CLR     dirM0
                                           ; SOURCE LINE # 777
0BD1 8019              SJMP    ?C0045
0BD3         ?C0110:
                                           ; SOURCE LINE # 778
0BD3 E4                CLR     A
0BD4 FF                MOV     R7,A
0BD5 FE                MOV     R6,A
0BD6 FD                MOV     R5,A
0BD7 FC                MOV     R4,A
0BD8 AB00        R     MOV     R3,pwm_input+03H
0BDA AA00        R     MOV     R2,pwm_input+02H
0BDC A900        R     MOV     R1,pwm_input+01H
0BDE A800        R     MOV     R0,pwm_input
0BE0 C3                CLR     C
0BE1 120000      E     LCALL   ?C?SLCMP
0BE4 4004              JC      ?C0114
                                           ; SOURCE LINE # 779
0BE6 D200        R     SETB    dirM1
0BE8 8002              SJMP    ?C0045
0BEA         ?C0114:
                                           ; SOURCE LINE # 782
0BEA C200        R     CLR     dirM1
                                           ; SOURCE LINE # 784
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 788
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 63  

                                           ; SOURCE LINE # 789
                                           ; SOURCE LINE # 790
0BEC         ?C0045:
                                           ; SOURCE LINE # 792
0BEC 300005            JNB     interrupt_flag,?C0117
                                           ; SOURCE LINE # 793
0BEF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 794
0BF1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 795
0BF4         ?C0117:
                                           ; SOURCE LINE # 798
0BF4 E4                CLR     A
0BF5 7F64              MOV     R7,#064H
0BF7 FE                MOV     R6,A
0BF8 FD                MOV     R5,A
0BF9 FC                MOV     R4,A
0BFA AB00        R     MOV     R3,pwm_input+03H
0BFC AA00        R     MOV     R2,pwm_input+02H
0BFE A900        R     MOV     R1,pwm_input+01H
0C00 A800        R     MOV     R0,pwm_input
0C02 D3                SETB    C
0C03 120000      E     LCALL   ?C?SLCMP
0C06 400A              JC      ?C0118
                                           ; SOURCE LINE # 799
0C08 E4                CLR     A
0C09 750064      R     MOV     pwm_input+03H,#064H
0C0C F500        R     MOV     pwm_input+02H,A
0C0E F500        R     MOV     pwm_input+01H,A
0C10 F500        R     MOV     pwm_input,A
0C12         ?C0118:
                                           ; SOURCE LINE # 800
0C12 74FF              MOV     A,#0FFH
0C14 7F9C              MOV     R7,#09CH
0C16 FE                MOV     R6,A
0C17 FD                MOV     R5,A
0C18 FC                MOV     R4,A
0C19 AB00        R     MOV     R3,pwm_input+03H
0C1B AA00        R     MOV     R2,pwm_input+02H
0C1D A900        R     MOV     R1,pwm_input+01H
0C1F A800        R     MOV     R0,pwm_input
0C21 C3                CLR     C
0C22 120000      E     LCALL   ?C?SLCMP
0C25 500B              JNC     ?C0119
                                           ; SOURCE LINE # 801
0C27 74FF              MOV     A,#0FFH
0C29 75009C      R     MOV     pwm_input+03H,#09CH
0C2C F500        R     MOV     pwm_input+02H,A
0C2E F500        R     MOV     pwm_input+01H,A
0C30 F500        R     MOV     pwm_input,A
0C32         ?C0119:
                                           ; SOURCE LINE # 803
0C32 300005            JNB     interrupt_flag,?C0120
                                           ; SOURCE LINE # 804
0C35 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 805
0C37 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 806
0C3A         ?C0120:
                                           ; SOURCE LINE # 809
0C3A 900000      E     MOV     DPTR,#c_mem+036H
0C3D E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 64  

0C3E 6401              XRL     A,#01H
0C40 6037              JZ      ?C0121
                                           ; SOURCE LINE # 810
0C42 AF00        R     MOV     R7,pwm_input+03H
0C44 AE00        R     MOV     R6,pwm_input+02H
0C46 AD00        R     MOV     R5,pwm_input+01H
0C48 AC00        R     MOV     R4,pwm_input
0C4A 780A              MOV     R0,#0AH
0C4C 120000      E     LCALL   ?C?LSHL
0C4F E4                CLR     A
0C50 7B64              MOV     R3,#064H
0C52 FA                MOV     R2,A
0C53 F9                MOV     R1,A
0C54 F8                MOV     R0,A
0C55 120000      E     LCALL   ?C?SLDIV
0C58 A804              MOV     R0,AR4
0C5A A905              MOV     R1,AR5
0C5C AA06              MOV     R2,AR6
0C5E AB07              MOV     R3,AR7
0C60 900000      E     MOV     DPTR,#dev_pwm_limit
0C63 E0                MOVX    A,@DPTR
0C64 FF                MOV     R7,A
0C65 E4                CLR     A
0C66 FC                MOV     R4,A
0C67 FD                MOV     R5,A
0C68 FE                MOV     R6,A
0C69 120000      E     LCALL   ?C?LMUL
0C6C 780A              MOV     R0,#0AH
0C6E 120000      E     LCALL   ?C?SLSHR
0C71 8F00        R     MOV     pwm_input+03H,R7
0C73 8E00        R     MOV     pwm_input+02H,R6
0C75 8D00        R     MOV     pwm_input+01H,R5
0C77 8C00        R     MOV     pwm_input,R4
0C79         ?C0121:
                                           ; SOURCE LINE # 814
0C79 300011            JNB     dirM0,?C0122
                                           ; SOURCE LINE # 815
0C7C 300007            JNB     dirM1,?C0123
                                           ; SOURCE LINE # 816
0C7F 7F03              MOV     R7,#03H
0C81 120000      E     LCALL   _MOTOR_DIR_Write
0C84 8016              SJMP    ?C0125
0C86         ?C0123:
                                           ; SOURCE LINE # 818
0C86 7F01              MOV     R7,#01H
0C88 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 819
0C8B 800F              SJMP    ?C0125
0C8D         ?C0122:
                                           ; SOURCE LINE # 820
                                           ; SOURCE LINE # 821
0C8D 300007            JNB     dirM1,?C0126
                                           ; SOURCE LINE # 822
0C90 7F02              MOV     R7,#02H
0C92 120000      E     LCALL   _MOTOR_DIR_Write
0C95 8005              SJMP    ?C0125
0C97         ?C0126:
                                           ; SOURCE LINE # 824
0C97 E4                CLR     A
0C98 FF                MOV     R7,A
0C99 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 825
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 65  

0C9C         ?C0125:
                                           ; SOURCE LINE # 827
0C9C 300005            JNB     interrupt_flag,?C0128
                                           ; SOURCE LINE # 828
0C9F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 829
0CA1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 830
0CA4         ?C0128:
                                           ; SOURCE LINE # 832
0CA4 E500        R     MOV     A,index
0CA6 7046              JNZ     ?C0129
                                           ; SOURCE LINE # 833
0CA8 FF                MOV     R7,A
0CA9 FE                MOV     R6,A
0CAA FD                MOV     R5,A
0CAB FC                MOV     R4,A
0CAC AB00        R     MOV     R3,pwm_input+03H
0CAE AA00        R     MOV     R2,pwm_input+02H
0CB0 A900        R     MOV     R1,pwm_input+01H
0CB2 A800        R     MOV     R0,pwm_input
0CB4 D3                SETB    C
0CB5 120000      E     LCALL   ?C?SLCMP
0CB8 4006              JC      ?C0130
0CBA 7E00              MOV     R6,#00H
0CBC 7F01              MOV     R7,#01H
0CBE 801D              SJMP    ?C0131
0CC0         ?C0130:
0CC0 E4                CLR     A
0CC1 FF                MOV     R7,A
0CC2 FE                MOV     R6,A
0CC3 FD                MOV     R5,A
0CC4 FC                MOV     R4,A
0CC5 AB00        R     MOV     R3,pwm_input+03H
0CC7 AA00        R     MOV     R2,pwm_input+02H
0CC9 A900        R     MOV     R1,pwm_input+01H
0CCB A800        R     MOV     R0,pwm_input
0CCD C3                CLR     C
0CCE 120000      E     LCALL   ?C?SLCMP
0CD1 5006              JNC     ?C0132
0CD3 7EFF              MOV     R6,#0FFH
0CD5 7FFF              MOV     R7,#0FFH
0CD7 8004              SJMP    ?C0133
0CD9         ?C0132:
0CD9 7E00              MOV     R6,#00H
0CDB 7F00              MOV     R7,#00H
0CDD         ?C0133:
0CDD         ?C0131:
0CDD 900000      E     MOV     DPTR,#pwm_sign
0CE0 EF                MOV     A,R7
0CE1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 834
0CE2 AE00        R     MOV     R6,pwm_input+02H
0CE4 AF00        R     MOV     R7,pwm_input+03H
0CE6 120000      E     LCALL   _abs
0CE9 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 835
0CEC 8045              SJMP    ?C0134
0CEE         ?C0129:
                                           ; SOURCE LINE # 836
                                           ; SOURCE LINE # 837
0CEE E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 66  

0CEF FF                MOV     R7,A
0CF0 FE                MOV     R6,A
0CF1 FD                MOV     R5,A
0CF2 FC                MOV     R4,A
0CF3 AB00        R     MOV     R3,pwm_input+03H
0CF5 AA00        R     MOV     R2,pwm_input+02H
0CF7 A900        R     MOV     R1,pwm_input+01H
0CF9 A800        R     MOV     R0,pwm_input
0CFB D3                SETB    C
0CFC 120000      E     LCALL   ?C?SLCMP
0CFF 4006              JC      ?C0135
0D01 7E00              MOV     R6,#00H
0D03 7F01              MOV     R7,#01H
0D05 801D              SJMP    ?C0136
0D07         ?C0135:
0D07 E4                CLR     A
0D08 FF                MOV     R7,A
0D09 FE                MOV     R6,A
0D0A FD                MOV     R5,A
0D0B FC                MOV     R4,A
0D0C AB00        R     MOV     R3,pwm_input+03H
0D0E AA00        R     MOV     R2,pwm_input+02H
0D10 A900        R     MOV     R1,pwm_input+01H
0D12 A800        R     MOV     R0,pwm_input
0D14 C3                CLR     C
0D15 120000      E     LCALL   ?C?SLCMP
0D18 5006              JNC     ?C0137
0D1A 7EFF              MOV     R6,#0FFH
0D1C 7FFF              MOV     R7,#0FFH
0D1E 8004              SJMP    ?C0138
0D20         ?C0137:
0D20 7E00              MOV     R6,#00H
0D22 7F00              MOV     R7,#00H
0D24         ?C0138:
0D24         ?C0136:
0D24 900000      E     MOV     DPTR,#pwm_sign+01H
0D27 EF                MOV     A,R7
0D28 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 838
0D29 AE00        R     MOV     R6,pwm_input+02H
0D2B AF00        R     MOV     R7,pwm_input+03H
0D2D 120000      E     LCALL   _abs
0D30 120000      E     LCALL   _PWM_MOTORS_WriteCompare2
                                           ; SOURCE LINE # 839
0D33         ?C0134:
                                           ; SOURCE LINE # 841
0D33 300005            JNB     interrupt_flag,?C0044
                                           ; SOURCE LINE # 842
0D36 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 843
0D38 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 844
                                           ; SOURCE LINE # 845
0D3B         ?C0044:
0D3B 22                RET     
             ; FUNCTION _motor_control (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 851
0000         ?C0140:
                                           ; SOURCE LINE # 872
0000 120000      E     LCALL   ADC_STATUS_Read
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 67  

0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0141
                                           ; SOURCE LINE # 873
0006 3000F7            JNB     interrupt_flag,?C0140
                                           ; SOURCE LINE # 874
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 875
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 876
                                           ; SOURCE LINE # 877
000E 80F0              SJMP    ?C0140
0010         ?C0141:
                                           ; SOURCE LINE # 880
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 882
0038 300005            JNB     interrupt_flag,?C0143
                                           ; SOURCE LINE # 883
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 884
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 885
0040         ?C0143:
                                           ; SOURCE LINE # 889
0040 E4                CLR     A
0041 FF                MOV     R7,A
0042 FE                MOV     R6,A
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      E     MOV     DPTR,#dev_tension
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 68  

0054 120000      E     LCALL   ?C?SLCMP
0057 5003              JNC     $ + 5H
0059 020000      R     LJMP    ?C0144
                                           ; SOURCE LINE # 892
005C 120000      R     LCALL   pwm_limit_search
                                           ; SOURCE LINE # 896
005F 300005            JNB     interrupt_flag,?C0145
                                           ; SOURCE LINE # 897
0062 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 898
0064 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 899
0067         ?C0145:
                                           ; SOURCE LINE # 902
0067 900000      E     MOV     DPTR,#ADC_buf+03H
006A E0                MOVX    A,@DPTR
006B 249A              ADD     A,#09AH
006D FF                MOV     R7,A
006E 900000      E     MOV     DPTR,#ADC_buf+02H
0071 E0                MOVX    A,@DPTR
0072 34F9              ADDC    A,#0F9H
0074 FE                MOV     R6,A
0075 33                RLC     A
0076 95E0              SUBB    A,ACC
0078 FD                MOV     R5,A
0079 FC                MOV     R4,A
007A E4                CLR     A
007B 7BAB              MOV     R3,#0ABH
007D 7A64              MOV     R2,#064H
007F F9                MOV     R1,A
0080 F8                MOV     R0,A
0081 120000      E     LCALL   ?C?LMUL
0084 780D              MOV     R0,#0DH
0086 120000      E     LCALL   ?C?SLSHR
0089 900000      E     MOV     DPTR,#pwm_sign
008C E0                MOVX    A,@DPTR
008D FD                MOV     R5,A
008E 33                RLC     A
008F 95E0              SUBB    A,ACC
0091 FC                MOV     R4,A
0092 120000      E     LCALL   ?C?IMUL
0095 EE                MOV     A,R6
0096 33                RLC     A
0097 95E0              SUBB    A,ACC
0099 FD                MOV     R5,A
009A FC                MOV     R4,A
009B 120000      E     LCALL   _filter_i1
009E 900000      E     MOV     DPTR,#g_meas+0CH
00A1 EE                MOV     A,R6
00A2 F0                MOVX    @DPTR,A
00A3 A3                INC     DPTR
00A4 EF                MOV     A,R7
00A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 906
00A6 300005            JNB     interrupt_flag,?C0146
                                           ; SOURCE LINE # 907
00A9 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 908
00AB 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 909
00AE         ?C0146:
                                           ; SOURCE LINE # 910
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 69  

00AE 900000      E     MOV     DPTR,#ADC_buf+05H
00B1 E0                MOVX    A,@DPTR
00B2 249A              ADD     A,#09AH
00B4 FF                MOV     R7,A
00B5 900000      E     MOV     DPTR,#ADC_buf+04H
00B8 E0                MOVX    A,@DPTR
00B9 34F9              ADDC    A,#0F9H
00BB FE                MOV     R6,A
00BC 33                RLC     A
00BD 95E0              SUBB    A,ACC
00BF FD                MOV     R5,A
00C0 FC                MOV     R4,A
00C1 E4                CLR     A
00C2 7BAB              MOV     R3,#0ABH
00C4 7A64              MOV     R2,#064H
00C6 F9                MOV     R1,A
00C7 F8                MOV     R0,A
00C8 120000      E     LCALL   ?C?LMUL
00CB 780D              MOV     R0,#0DH
00CD 120000      E     LCALL   ?C?SLSHR
00D0 900000      E     MOV     DPTR,#pwm_sign+01H
00D3 E0                MOVX    A,@DPTR
00D4 FD                MOV     R5,A
00D5 33                RLC     A
00D6 95E0              SUBB    A,ACC
00D8 FC                MOV     R4,A
00D9 120000      E     LCALL   ?C?IMUL
00DC EE                MOV     A,R6
00DD 33                RLC     A
00DE 95E0              SUBB    A,ACC
00E0 FD                MOV     R5,A
00E1 FC                MOV     R4,A
00E2 120000      E     LCALL   _filter_i2
00E5 900000      E     MOV     DPTR,#g_meas+0EH
00E8 EE                MOV     A,R6
00E9 F0                MOVX    @DPTR,A
00EA A3                INC     DPTR
00EB EF                MOV     A,R7
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 914
00ED 300011            JNB     interrupt_flag,?C0149
                                           ; SOURCE LINE # 915
00F0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 916
00F2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 917
                                           ; SOURCE LINE # 918
00F5 22                RET     
00F6         ?C0144:
                                           ; SOURCE LINE # 919
                                           ; SOURCE LINE # 920
00F6 E4                CLR     A
00F7 900000      E     MOV     DPTR,#g_meas+0CH
00FA F0                MOVX    @DPTR,A
00FB A3                INC     DPTR
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 921
00FD A3                INC     DPTR
00FE F0                MOVX    @DPTR,A
00FF A3                INC     DPTR
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 922
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 70  

                                           ; SOURCE LINE # 923
0101         ?C0149:
0101 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 929
0000 900000      R     MOV     DPTR,#flag
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 930
                                           ; SOURCE LINE # 931
0005 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 949
0007 E500        R     MOV     A,index
0009 C3                CLR     C
000A 9403              SUBB    A,#03H
000C 4003              JC      $ + 5H
000E 020000      R     LJMP    ?C0151
0011         ?C0150:
                                           ; SOURCE LINE # 952
0011 300022            JNB     reset_last_value_flag,?C0152
                                           ; SOURCE LINE # 953
;---- Variable 'jj' assigned to Register 'R3' ----
0014 7B03              MOV     R3,#03H
0016         ?C0153:
0016 AF03              MOV     R7,AR3
0018 1B                DEC     R3
0019 EF                MOV     A,R7
001A 6018              JZ      ?C0154
                                           ; SOURCE LINE # 954
001C E4                CLR     A
001D FF                MOV     R7,A
001E FE                MOV     R6,A
001F FD                MOV     R5,A
0020 FC                MOV     R4,A
0021 EB                MOV     A,R3
0022 25E0              ADD     A,ACC
0024 25E0              ADD     A,ACC
0026 2400        R     ADD     A,#LOW last_value_encoder
0028 F582              MOV     DPL,A
002A E4                CLR     A
002B 3400        R     ADDC    A,#HIGH last_value_encoder
002D F583              MOV     DPH,A
002F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 955
0032 80E2              SJMP    ?C0153
0034         ?C0154:
                                           ; SOURCE LINE # 956
0034 C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 957
0036         ?C0152:
                                           ; SOURCE LINE # 960
0036 E500        R     MOV     A,index
0038 7013              JNZ     ?C0155
                                           ; SOURCE LINE # 961
003A 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
003D EF                MOV     A,R7
003E EE                MOV     A,R6
003F ED                MOV     A,R5
0040 5403              ANL     A,#03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 71  

0042 FD                MOV     R5,A
0043 E4                CLR     A
0044 FC                MOV     R4,A
0045 900000      R     MOV     DPTR,#data_encoder
0048 120000      E     LCALL   ?C?LSTXDATA
004B 8041              SJMP    ?C0156
004D         ?C0155:
                                           ; SOURCE LINE # 962
                                           ; SOURCE LINE # 963
004D E500        R     MOV     A,index
004F B40113            CJNE    A,#01H,?C0157
                                           ; SOURCE LINE # 964
0052 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0055 EF                MOV     A,R7
0056 EE                MOV     A,R6
0057 ED                MOV     A,R5
0058 5403              ANL     A,#03H
005A FD                MOV     R5,A
005B E4                CLR     A
005C FC                MOV     R4,A
005D 900000      R     MOV     DPTR,#data_encoder
0060 120000      E     LCALL   ?C?LSTXDATA
0063 8029              SJMP    ?C0156
0065         ?C0157:
                                           ; SOURCE LINE # 965
                                           ; SOURCE LINE # 966
0065 E500        R     MOV     A,index
0067 B40213            CJNE    A,#02H,?C0159
                                           ; SOURCE LINE # 967
006A 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
006D EF                MOV     A,R7
006E EE                MOV     A,R6
006F ED                MOV     A,R5
0070 5403              ANL     A,#03H
0072 FD                MOV     R5,A
0073 E4                CLR     A
0074 FC                MOV     R4,A
0075 900000      R     MOV     DPTR,#data_encoder
0078 120000      E     LCALL   ?C?LSTXDATA
007B 8011              SJMP    ?C0156
007D         ?C0159:
                                           ; SOURCE LINE # 969
007D 120000      E     LCALL   SHIFTREG_ENC_4_ReadData
0080 EF                MOV     A,R7
0081 EE                MOV     A,R6
0082 ED                MOV     A,R5
0083 5403              ANL     A,#03H
0085 FD                MOV     R5,A
0086 E4                CLR     A
0087 FC                MOV     R4,A
0088 900000      R     MOV     DPTR,#data_encoder
008B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 970
                                           ; SOURCE LINE # 971
008E         ?C0156:
                                           ; SOURCE LINE # 973
008E 7B01              MOV     R3,#01H
0090 7A00        R     MOV     R2,#HIGH data_encoder
0092 7900        R     MOV     R1,#LOW data_encoder
0094 120000      E     LCALL   _check_enc_data
0097 4003              JC      $ + 5H
0099 020000      R     LJMP    ?C0151
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 72  

                                           ; SOURCE LINE # 974
009C 900000      R     MOV     DPTR,#flag
009F E0                MOVX    A,@DPTR
00A0 602D              JZ      ?C0162
                                           ; SOURCE LINE # 975
00A2 A3                INC     DPTR
00A3 E0                MOVX    A,@DPTR
00A4 FC                MOV     R4,A
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 FD                MOV     R5,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FE                MOV     R6,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD 54C0              ANL     A,#0C0H
00AF FF                MOV     R7,A
00B0 EE                MOV     A,R6
00B1 ED                MOV     A,R5
00B2 5403              ANL     A,#03H
00B4 FD                MOV     R5,A
00B5 E4                CLR     A
00B6 FC                MOV     R4,A
00B7 7802              MOV     R0,#02H
00B9 120000      E     LCALL   ?C?ULSHR
00BC C3                CLR     C
00BD E4                CLR     A
00BE 9F                SUBB    A,R7
00BF FF                MOV     R7,A
00C0 7480              MOV     A,#080H
00C2 9E                SUBB    A,R6
00C3 FE                MOV     R6,A
00C4 33                RLC     A
00C5 95E0              SUBB    A,ACC
00C7 FD                MOV     R5,A
00C8 FC                MOV     R4,A
00C9 A3                INC     DPTR
00CA 120000      E     LCALL   ?C?LSTXDATA
00CD 804B              SJMP    ?C0163
00CF         ?C0162:
                                           ; SOURCE LINE # 977
00CF 900000      R     MOV     DPTR,#data_encoder
00D2 E0                MOVX    A,@DPTR
00D3 FC                MOV     R4,A
00D4 A3                INC     DPTR
00D5 E0                MOVX    A,@DPTR
00D6 FD                MOV     R5,A
00D7 A3                INC     DPTR
00D8 E0                MOVX    A,@DPTR
00D9 FE                MOV     R6,A
00DA A3                INC     DPTR
00DB E0                MOVX    A,@DPTR
00DC 54C0              ANL     A,#0C0H
00DE FF                MOV     R7,A
00DF EE                MOV     A,R6
00E0 ED                MOV     A,R5
00E1 5403              ANL     A,#03H
00E3 FD                MOV     R5,A
00E4 E4                CLR     A
00E5 FC                MOV     R4,A
00E6 7802              MOV     R0,#02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 73  

00E8 120000      E     LCALL   ?C?ULSHR
00EB C3                CLR     C
00EC E4                CLR     A
00ED 9F                SUBB    A,R7
00EE FB                MOV     R3,A
00EF 7480              MOV     A,#080H
00F1 9E                SUBB    A,R6
00F2 FA                MOV     R2,A
00F3 E500        R     MOV     A,index
00F5 25E0              ADD     A,ACC
00F7 25E0              ADD     A,ACC
00F9 2400        E     ADD     A,#LOW g_mem+03AH
00FB F582              MOV     DPL,A
00FD E4                CLR     A
00FE 3400        E     ADDC    A,#HIGH g_mem+03AH
0100 F583              MOV     DPH,A
0102 E0                MOVX    A,@DPTR
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 A3                INC     DPTR
0106 E0                MOVX    A,@DPTR
0107 FE                MOV     R6,A
0108 A3                INC     DPTR
0109 E0                MOVX    A,@DPTR
010A 2B                ADD     A,R3
010B FF                MOV     R7,A
010C EA                MOV     A,R2
010D 3E                ADDC    A,R6
010E FE                MOV     R6,A
010F 33                RLC     A
0110 95E0              SUBB    A,ACC
0112 FD                MOV     R5,A
0113 FC                MOV     R4,A
0114 900000      R     MOV     DPTR,#value_encoder
0117 120000      E     LCALL   ?C?LSTXDATA
011A         ?C0163:
                                           ; SOURCE LINE # 980
011A 300027            JNB     only_first_time,?C0164
                                           ; SOURCE LINE # 981
011D 900000      R     MOV     DPTR,#value_encoder
0120 E0                MOVX    A,@DPTR
0121 FC                MOV     R4,A
0122 A3                INC     DPTR
0123 E0                MOVX    A,@DPTR
0124 FD                MOV     R5,A
0125 A3                INC     DPTR
0126 E0                MOVX    A,@DPTR
0127 FE                MOV     R6,A
0128 A3                INC     DPTR
0129 E0                MOVX    A,@DPTR
012A FF                MOV     R7,A
012B E500        R     MOV     A,index
012D 25E0              ADD     A,ACC
012F 25E0              ADD     A,ACC
0131 2400        R     ADD     A,#LOW last_value_encoder
0133 F582              MOV     DPL,A
0135 E4                CLR     A
0136 3400        R     ADDC    A,#HIGH last_value_encoder
0138 F583              MOV     DPH,A
013A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 983
013D E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 74  

013F B40202            CJNE    A,#02H,?C0164
                                           ; SOURCE LINE # 984
0142 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 985
0144         ?C0164:
                                           ; SOURCE LINE # 988
0144 E500        R     MOV     A,index
0146 25E0              ADD     A,ACC
0148 25E0              ADD     A,ACC
014A 2400        R     ADD     A,#LOW last_value_encoder
014C F582              MOV     DPL,A
014E E4                CLR     A
014F 3400        R     ADDC    A,#HIGH last_value_encoder
0151 F583              MOV     DPH,A
0153 E0                MOVX    A,@DPTR
0154 F8                MOV     R0,A
0155 A3                INC     DPTR
0156 E0                MOVX    A,@DPTR
0157 F9                MOV     R1,A
0158 A3                INC     DPTR
0159 E0                MOVX    A,@DPTR
015A FA                MOV     R2,A
015B A3                INC     DPTR
015C E0                MOVX    A,@DPTR
015D FB                MOV     R3,A
015E 900000      R     MOV     DPTR,#value_encoder
0161 E0                MOVX    A,@DPTR
0162 FC                MOV     R4,A
0163 A3                INC     DPTR
0164 E0                MOVX    A,@DPTR
0165 FD                MOV     R5,A
0166 A3                INC     DPTR
0167 E0                MOVX    A,@DPTR
0168 FE                MOV     R6,A
0169 A3                INC     DPTR
016A E0                MOVX    A,@DPTR
016B C3                CLR     C
016C 9B                SUBB    A,R3
016D FF                MOV     R7,A
016E EE                MOV     A,R6
016F 9A                SUBB    A,R2
0170 FE                MOV     R6,A
0171 ED                MOV     A,R5
0172 99                SUBB    A,R1
0173 FD                MOV     R5,A
0174 EC                MOV     A,R4
0175 98                SUBB    A,R0
0176 FC                MOV     R4,A
0177 A3                INC     DPTR
0178 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1008
017B E4                CLR     A
017C FF                MOV     R7,A
017D 7EC0              MOV     R6,#0C0H
017F FD                MOV     R5,A
0180 FC                MOV     R4,A
0181 900000      R     MOV     DPTR,#aux
0184 E0                MOVX    A,@DPTR
0185 F8                MOV     R0,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 F9                MOV     R1,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 75  

0189 A3                INC     DPTR
018A E0                MOVX    A,@DPTR
018B FA                MOV     R2,A
018C A3                INC     DPTR
018D E0                MOVX    A,@DPTR
018E FB                MOV     R3,A
018F D3                SETB    C
0190 120000      E     LCALL   ?C?SLCMP
0193 4010              JC      ?C0166
                                           ; SOURCE LINE # 1009
0195 7400        E     MOV     A,#LOW g_meas+010H
0197 2500        R     ADD     A,index
0199 F582              MOV     DPL,A
019B E4                CLR     A
019C 3400        E     ADDC    A,#HIGH g_meas+010H
019E F583              MOV     DPH,A
01A0 E0                MOVX    A,@DPTR
01A1 14                DEC     A
01A2 F0                MOVX    @DPTR,A
01A3 8068              SJMP    ?C0167
01A5         ?C0166:
                                           ; SOURCE LINE # 1010
                                           ; SOURCE LINE # 1011
01A5 7F00              MOV     R7,#00H
01A7 7E40              MOV     R6,#040H
01A9 7DFF              MOV     R5,#0FFH
01AB 7CFF              MOV     R4,#0FFH
01AD 900000      R     MOV     DPTR,#aux
01B0 E0                MOVX    A,@DPTR
01B1 F8                MOV     R0,A
01B2 A3                INC     DPTR
01B3 E0                MOVX    A,@DPTR
01B4 F9                MOV     R1,A
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FA                MOV     R2,A
01B8 A3                INC     DPTR
01B9 E0                MOVX    A,@DPTR
01BA FB                MOV     R3,A
01BB C3                CLR     C
01BC 120000      E     LCALL   ?C?SLCMP
01BF 5010              JNC     ?C0168
                                           ; SOURCE LINE # 1012
01C1 7400        E     MOV     A,#LOW g_meas+010H
01C3 2500        R     ADD     A,index
01C5 F582              MOV     DPL,A
01C7 E4                CLR     A
01C8 3400        E     ADDC    A,#HIGH g_meas+010H
01CA F583              MOV     DPH,A
01CC E0                MOVX    A,@DPTR
01CD 04                INC     A
01CE F0                MOVX    @DPTR,A
01CF 803C              SJMP    ?C0167
01D1         ?C0168:
                                           ; SOURCE LINE # 1013
                                           ; SOURCE LINE # 1014
01D1 900000      R     MOV     DPTR,#aux
01D4 E0                MOVX    A,@DPTR
01D5 A3                INC     DPTR
01D6 E0                MOVX    A,@DPTR
01D7 A3                INC     DPTR
01D8 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 76  

01D9 FE                MOV     R6,A
01DA A3                INC     DPTR
01DB E0                MOVX    A,@DPTR
01DC FF                MOV     R7,A
01DD 120000      E     LCALL   _abs
01E0 D3                SETB    C
01E1 EF                MOV     A,R7
01E2 9400              SUBB    A,#00H
01E4 EE                MOV     A,R6
01E5 6480              XRL     A,#080H
01E7 94C0              SUBB    A,#0C0H
01E9 4022              JC      ?C0167
                                           ; SOURCE LINE # 1015
01EB 7400        R     MOV     A,#LOW error
01ED 2500        R     ADD     A,index
01EF F582              MOV     DPL,A
01F1 E4                CLR     A
01F2 3400        R     ADDC    A,#HIGH error
01F4 F583              MOV     DPH,A
01F6 E0                MOVX    A,@DPTR
01F7 04                INC     A
01F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1016
01F9 7400        R     MOV     A,#LOW error
01FB 2500        R     ADD     A,index
01FD F582              MOV     DPL,A
01FF E4                CLR     A
0200 3400        R     ADDC    A,#HIGH error
0202 F583              MOV     DPH,A
0204 E0                MOVX    A,@DPTR
0205 C3                CLR     C
0206 940A              SUBB    A,#0AH
0208 5003              JNC     $ + 5H
020A 020000      R     LJMP    ?C0151
020D         ?C0171:
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
                                           ; SOURCE LINE # 1021
020D         ?C0167:
                                           ; SOURCE LINE # 1023
020D 7400        R     MOV     A,#LOW error
020F 2500        R     ADD     A,index
0211 F582              MOV     DPL,A
0213 E4                CLR     A
0214 3400        R     ADDC    A,#HIGH error
0216 F583              MOV     DPH,A
0218 E4                CLR     A
0219 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1025
021A 900000      R     MOV     DPTR,#value_encoder
021D E0                MOVX    A,@DPTR
021E FC                MOV     R4,A
021F A3                INC     DPTR
0220 E0                MOVX    A,@DPTR
0221 FD                MOV     R5,A
0222 A3                INC     DPTR
0223 E0                MOVX    A,@DPTR
0224 FE                MOV     R6,A
0225 A3                INC     DPTR
0226 E0                MOVX    A,@DPTR
0227 FF                MOV     R7,A
0228 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 77  

022A 25E0              ADD     A,ACC
022C 25E0              ADD     A,ACC
022E 2400        R     ADD     A,#LOW last_value_encoder
0230 F582              MOV     DPL,A
0232 E4                CLR     A
0233 3400        R     ADDC    A,#HIGH last_value_encoder
0235 F583              MOV     DPH,A
0237 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1027
023A 900000      R     MOV     DPTR,#value_encoder
023D E0                MOVX    A,@DPTR
023E F8                MOV     R0,A
023F A3                INC     DPTR
0240 E0                MOVX    A,@DPTR
0241 F9                MOV     R1,A
0242 A3                INC     DPTR
0243 E0                MOVX    A,@DPTR
0244 FA                MOV     R2,A
0245 A3                INC     DPTR
0246 E0                MOVX    A,@DPTR
0247 FB                MOV     R3,A
0248 C000              PUSH    AR0
024A 7400        E     MOV     A,#LOW g_meas+010H
024C 2500        R     ADD     A,index
024E F582              MOV     DPL,A
0250 E4                CLR     A
0251 3400        E     ADDC    A,#HIGH g_meas+010H
0253 F583              MOV     DPH,A
0255 E0                MOVX    A,@DPTR
0256 FF                MOV     R7,A
0257 33                RLC     A
0258 95E0              SUBB    A,ACC
025A FE                MOV     R6,A
025B FD                MOV     R5,A
025C FC                MOV     R4,A
025D 7810              MOV     R0,#010H
025F 120000      E     LCALL   ?C?LSHL
0262 D000              POP     AR0
0264 EB                MOV     A,R3
0265 2F                ADD     A,R7
0266 FF                MOV     R7,A
0267 EA                MOV     A,R2
0268 3E                ADDC    A,R6
0269 FE                MOV     R6,A
026A E9                MOV     A,R1
026B 3D                ADDC    A,R5
026C FD                MOV     R5,A
026D E8                MOV     A,R0
026E 3C                ADDC    A,R4
026F FC                MOV     R4,A
0270 900000      R     MOV     DPTR,#value_encoder
0273 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1029
0276 E500        R     MOV     A,index
0278 25E0              ADD     A,ACC
027A 25E0              ADD     A,ACC
027C 2400        E     ADD     A,#LOW c_mem+046H
027E F582              MOV     DPL,A
0280 E4                CLR     A
0281 3400        E     ADDC    A,#HIGH c_mem+046H
0283 F583              MOV     DPH,A
0285 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 78  

0286 FC                MOV     R4,A
0287 A3                INC     DPTR
0288 E0                MOVX    A,@DPTR
0289 FD                MOV     R5,A
028A A3                INC     DPTR
028B E0                MOVX    A,@DPTR
028C FE                MOV     R6,A
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F FF                MOV     R7,A
0290 E4                CLR     A
0291 FB                MOV     R3,A
0292 FA                MOV     R2,A
0293 7980              MOV     R1,#080H
0295 783F              MOV     R0,#03FH
0297 120000      E     LCALL   ?C?FPCMP3
029A 6038              JZ      ?C0172
                                           ; SOURCE LINE # 1030
029C 900000      R     MOV     DPTR,#value_encoder
029F E0                MOVX    A,@DPTR
02A0 FC                MOV     R4,A
02A1 A3                INC     DPTR
02A2 E0                MOVX    A,@DPTR
02A3 FD                MOV     R5,A
02A4 A3                INC     DPTR
02A5 E0                MOVX    A,@DPTR
02A6 FE                MOV     R6,A
02A7 A3                INC     DPTR
02A8 E0                MOVX    A,@DPTR
02A9 FF                MOV     R7,A
02AA EC                MOV     A,R4
02AB 120000      E     LCALL   ?C?FCASTL
02AE E500        R     MOV     A,index
02B0 25E0              ADD     A,ACC
02B2 25E0              ADD     A,ACC
02B4 2400        E     ADD     A,#LOW c_mem+046H
02B6 F582              MOV     DPL,A
02B8 E4                CLR     A
02B9 3400        E     ADDC    A,#HIGH c_mem+046H
02BB F583              MOV     DPH,A
02BD E0                MOVX    A,@DPTR
02BE F8                MOV     R0,A
02BF A3                INC     DPTR
02C0 E0                MOVX    A,@DPTR
02C1 F9                MOV     R1,A
02C2 A3                INC     DPTR
02C3 E0                MOVX    A,@DPTR
02C4 FA                MOV     R2,A
02C5 A3                INC     DPTR
02C6 E0                MOVX    A,@DPTR
02C7 FB                MOV     R3,A
02C8 120000      E     LCALL   ?C?FPMUL
02CB 120000      E     LCALL   ?C?CASTF
02CE 900000      R     MOV     DPTR,#value_encoder
02D1 120000      E     LCALL   ?C?LSTXDATA
02D4         ?C0172:
                                           ; SOURCE LINE # 1032
02D4 900000      R     MOV     DPTR,#value_encoder
02D7 E0                MOVX    A,@DPTR
02D8 FC                MOV     R4,A
02D9 A3                INC     DPTR
02DA E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 79  

02DB FD                MOV     R5,A
02DC A3                INC     DPTR
02DD E0                MOVX    A,@DPTR
02DE FE                MOV     R6,A
02DF A3                INC     DPTR
02E0 E0                MOVX    A,@DPTR
02E1 FF                MOV     R7,A
02E2 E500        R     MOV     A,index
02E4 25E0              ADD     A,ACC
02E6 25E0              ADD     A,ACC
02E8 2400        E     ADD     A,#LOW g_meas
02EA F582              MOV     DPL,A
02EC E4                CLR     A
02ED 3400        E     ADDC    A,#HIGH g_meas
02EF F583              MOV     DPH,A
02F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1055
02F4         ?C0151:
02F4 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION calibration (BEGIN)
                                           ; SOURCE LINE # 1062
                                           ; SOURCE LINE # 1063
                                           ; SOURCE LINE # 1070
0000 900000      E     MOV     DPTR,#calibration_flag
0003 E0                MOVX    A,@DPTR
0004 24FE              ADD     A,#0FEH
0006 7003              JNZ     $ + 5H
0008 020000      R     LJMP    ?C0178
000B 14                DEC     A
000C 7003              JNZ     $ + 5H
000E 020000      R     LJMP    ?C0183
0011 14                DEC     A
0012 6076              JZ      ?C0176
0014 14                DEC     A
0015 7003              JNZ     $ + 5H
0017 020000      R     LJMP    ?C0181
001A 2404              ADD     A,#04H
001C 6003              JZ      $ + 5H
001E 020000      R     LJMP    ?C0187
                                           ; SOURCE LINE # 1071
0021         ?C0174:
                                           ; SOURCE LINE # 1072
0021 120000      E     LCALL   ISR_RS485_RX_Disable
                                           ; SOURCE LINE # 1075
0024 900000      E     MOV     DPTR,#c_mem+02H
0027 E0                MOVX    A,@DPTR
0028 FC                MOV     R4,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B FD                MOV     R5,A
002C A3                INC     DPTR
002D E0                MOVX    A,@DPTR
002E FE                MOV     R6,A
002F A3                INC     DPTR
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 900000      R     MOV     DPTR,#old_k_p
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1076
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 80  

0038 900000      E     MOV     DPTR,#c_mem+06H
003B E0                MOVX    A,@DPTR
003C FC                MOV     R4,A
003D A3                INC     DPTR
003E E0                MOVX    A,@DPTR
003F FD                MOV     R5,A
0040 A3                INC     DPTR
0041 E0                MOVX    A,@DPTR
0042 FE                MOV     R6,A
0043 A3                INC     DPTR
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
0046 900000      R     MOV     DPTR,#old_k_i
0049 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1077
004C 900000      E     MOV     DPTR,#c_mem+0AH
004F E0                MOVX    A,@DPTR
0050 FC                MOV     R4,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FD                MOV     R5,A
0054 A3                INC     DPTR
0055 E0                MOVX    A,@DPTR
0056 FE                MOV     R6,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FF                MOV     R7,A
005A 900000      R     MOV     DPTR,#old_k_d
005D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1080
0060 E4                CLR     A
0061 FF                MOV     R7,A
0062 FE                MOV     R6,A
0063 FD                MOV     R5,A
0064 FC                MOV     R4,A
0065 900000      E     MOV     DPTR,#g_refNew
0068 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1081
006B E4                CLR     A
006C FF                MOV     R7,A
006D FE                MOV     R6,A
006E FD                MOV     R5,A
006F FC                MOV     R4,A
0070 900000      E     MOV     DPTR,#g_refNew+04H
0073 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1084
0076 900000      E     MOV     DPTR,#g_refNew+08H
0079 E0                MOVX    A,@DPTR
007A 5403              ANL     A,#03H
007C 7005              JNZ     ?C0175
                                           ; SOURCE LINE # 1085
007E 7F03              MOV     R7,#03H
0080 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1086
0083         ?C0175:
                                           ; SOURCE LINE # 1089
0083 900000      E     MOV     DPTR,#calibration_flag
0086 7404              MOV     A,#04H
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1090
0089 22                RET     
                                           ; SOURCE LINE # 1092
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 81  

008A         ?C0176:
                                           ; SOURCE LINE # 1093
008A 900000      R     MOV     DPTR,#pause_counter
008D E0                MOVX    A,@DPTR
008E 04                INC     A
008F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1095
0090 E0                MOVX    A,@DPTR
0091 640A              XRL     A,#0AH
0093 6003              JZ      $ + 5H
0095 020000      R     LJMP    ?C0187
                                           ; SOURCE LINE # 1096
0098 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1099
0099 7F99              MOV     R7,#099H
009B 7E19              MOV     R6,#019H
009D FD                MOV     R5,A
009E FC                MOV     R4,A
009F 900000      E     MOV     DPTR,#c_mem+02H
00A2 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1100
00A5 E4                CLR     A
00A6 FF                MOV     R7,A
00A7 FE                MOV     R6,A
00A8 FD                MOV     R5,A
00A9 FC                MOV     R4,A
00AA 900000      E     MOV     DPTR,#c_mem+06H
00AD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1101
00B0 E4                CLR     A
00B1 7FCC              MOV     R7,#0CCH
00B3 7E4C              MOV     R6,#04CH
00B5 FD                MOV     R5,A
00B6 FC                MOV     R4,A
00B7 900000      E     MOV     DPTR,#c_mem+0AH
00BA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1103
00BD 900000      E     MOV     DPTR,#calibration_flag
00C0 7402              MOV     A,#02H
00C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1104
                                           ; SOURCE LINE # 1105
00C3 22                RET     
                                           ; SOURCE LINE # 1107
00C4         ?C0178:
                                           ; SOURCE LINE # 1109
00C4 900000      E     MOV     DPTR,#g_refNew
00C7 E0                MOVX    A,@DPTR
00C8 FC                MOV     R4,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FD                MOV     R5,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FE                MOV     R6,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 245B              ADD     A,#05BH
00D3 FF                MOV     R7,A
00D4 E4                CLR     A
00D5 3E                ADDC    A,R6
00D6 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 82  

00D7 E4                CLR     A
00D8 3D                ADDC    A,R5
00D9 FD                MOV     R5,A
00DA E4                CLR     A
00DB 3C                ADDC    A,R4
00DC FC                MOV     R4,A
00DD 900000      E     MOV     DPTR,#g_refNew
00E0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1110
00E3 900000      E     MOV     DPTR,#g_refNew+04H
00E6 E0                MOVX    A,@DPTR
00E7 FC                MOV     R4,A
00E8 A3                INC     DPTR
00E9 E0                MOVX    A,@DPTR
00EA FD                MOV     R5,A
00EB A3                INC     DPTR
00EC E0                MOVX    A,@DPTR
00ED FE                MOV     R6,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 C3                CLR     C
00F1 945B              SUBB    A,#05BH
00F3 FF                MOV     R7,A
00F4 EE                MOV     A,R6
00F5 9400              SUBB    A,#00H
00F7 FE                MOV     R6,A
00F8 ED                MOV     A,R5
00F9 9400              SUBB    A,#00H
00FB FD                MOV     R5,A
00FC EC                MOV     A,R4
00FD 9400              SUBB    A,#00H
00FF FC                MOV     R4,A
0100 900000      E     MOV     DPTR,#g_refNew+04H
0103 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1113
0106 D3                SETB    C
0107 900000      E     MOV     DPTR,#g_meas+0DH
010A E0                MOVX    A,@DPTR
010B 94E8              SUBB    A,#0E8H
010D 900000      E     MOV     DPTR,#g_meas+0CH
0110 E0                MOVX    A,@DPTR
0111 6480              XRL     A,#080H
0113 9483              SUBB    A,#083H
0115 5013              JNC     ?C0180
0117 900000      E     MOV     DPTR,#g_meas+0FH
011A E0                MOVX    A,@DPTR
011B 94E8              SUBB    A,#0E8H
011D 900000      E     MOV     DPTR,#g_meas+0EH
0120 E0                MOVX    A,@DPTR
0121 6480              XRL     A,#080H
0123 9483              SUBB    A,#083H
0125 5003              JNC     $ + 5H
0127 020000      R     LJMP    ?C0187
012A         ?C0180:
                                           ; SOURCE LINE # 1115
012A 900000      E     MOV     DPTR,#g_ref
012D E0                MOVX    A,@DPTR
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 A3                INC     DPTR
0131 E0                MOVX    A,@DPTR
0132 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 83  

0133 A3                INC     DPTR
0134 E0                MOVX    A,@DPTR
0135 900000      E     MOV     DPTR,#g_mem+063H
0138 CF                XCH     A,R7
0139 F0                MOVX    @DPTR,A
013A A3                INC     DPTR
013B EF                MOV     A,R7
013C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1118
013D 900000      R     MOV     DPTR,#old_k_p
0140 E0                MOVX    A,@DPTR
0141 FC                MOV     R4,A
0142 A3                INC     DPTR
0143 E0                MOVX    A,@DPTR
0144 FD                MOV     R5,A
0145 A3                INC     DPTR
0146 E0                MOVX    A,@DPTR
0147 FE                MOV     R6,A
0148 A3                INC     DPTR
0149 E0                MOVX    A,@DPTR
014A FF                MOV     R7,A
014B 900000      E     MOV     DPTR,#c_mem+02H
014E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1119
0151 900000      R     MOV     DPTR,#old_k_i
0154 E0                MOVX    A,@DPTR
0155 FC                MOV     R4,A
0156 A3                INC     DPTR
0157 E0                MOVX    A,@DPTR
0158 FD                MOV     R5,A
0159 A3                INC     DPTR
015A E0                MOVX    A,@DPTR
015B FE                MOV     R6,A
015C A3                INC     DPTR
015D E0                MOVX    A,@DPTR
015E FF                MOV     R7,A
015F 900000      E     MOV     DPTR,#c_mem+06H
0162 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1120
0165 900000      R     MOV     DPTR,#old_k_d
0168 E0                MOVX    A,@DPTR
0169 FC                MOV     R4,A
016A A3                INC     DPTR
016B E0                MOVX    A,@DPTR
016C FD                MOV     R5,A
016D A3                INC     DPTR
016E E0                MOVX    A,@DPTR
016F FE                MOV     R6,A
0170 A3                INC     DPTR
0171 E0                MOVX    A,@DPTR
0172 FF                MOV     R7,A
0173 900000      E     MOV     DPTR,#c_mem+0AH
0176 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1123
0179 E4                CLR     A
017A FF                MOV     R7,A
017B FE                MOV     R6,A
017C FD                MOV     R5,A
017D FC                MOV     R4,A
017E 900000      E     MOV     DPTR,#g_refNew
0181 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1124
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 84  

0184 E4                CLR     A
0185 FF                MOV     R7,A
0186 FE                MOV     R6,A
0187 FD                MOV     R5,A
0188 FC                MOV     R4,A
0189 900000      E     MOV     DPTR,#g_refNew+04H
018C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1127
018F 900000      E     MOV     DPTR,#calibration_flag
0192 7405              MOV     A,#05H
0194 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1128
                                           ; SOURCE LINE # 1129
0195 22                RET     
                                           ; SOURCE LINE # 1131
0196         ?C0181:
                                           ; SOURCE LINE # 1132
0196 900000      R     MOV     DPTR,#pause_counter
0199 E0                MOVX    A,@DPTR
019A 04                INC     A
019B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1134
019C E0                MOVX    A,@DPTR
019D 640A              XRL     A,#0AH
019F 7029              JNZ     ?C0187
                                           ; SOURCE LINE # 1135
01A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1137
01A2 900000      E     MOV     DPTR,#calibration_flag
01A5 7403              MOV     A,#03H
01A7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
01A8 22                RET     
                                           ; SOURCE LINE # 1141
01A9         ?C0183:
                                           ; SOURCE LINE # 1143
01A9 900000      E     MOV     DPTR,#g_refNew+08H
01AC E0                MOVX    A,@DPTR
01AD 5403              ANL     A,#03H
01AF 7004              JNZ     ?C0184
                                           ; SOURCE LINE # 1144
01B1 FF                MOV     R7,A
01B2 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1145
01B5         ?C0184:
                                           ; SOURCE LINE # 1148
01B5 7F08              MOV     R7,#08H
01B7 7E00              MOV     R6,#00H
01B9 120000      E     LCALL   _memStore
                                           ; SOURCE LINE # 1149
01BC E4                CLR     A
01BD FF                MOV     R7,A
01BE FE                MOV     R6,A
01BF 120000      E     LCALL   _memStore
                                           ; SOURCE LINE # 1151
01C2 E4                CLR     A
01C3 900000      E     MOV     DPTR,#calibration_flag
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1153
01C7 120000      E     LCALL   ISR_RS485_RX_Enable
                                           ; SOURCE LINE # 1154
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 85  

                                           ; SOURCE LINE # 1156
                                           ; SOURCE LINE # 1157
                                           ; SOURCE LINE # 1158
                                           ; SOURCE LINE # 1159
                                           ; SOURCE LINE # 1160
01CA         ?C0187:
01CA 22                RET     
             ; FUNCTION calibration (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1167
                                           ; SOURCE LINE # 1170
0000 750063      R     MOV     max_tension,#063H
0003 75009C      R     MOV     max_tension+01H,#09CH
                                           ; SOURCE LINE # 1171
0006 750039      R     MOV     max_tension_6v_mod,#039H
0009 75009E      R     MOV     max_tension_6v_mod+01H,#09EH
                                           ; SOURCE LINE # 1173
000C C3                CLR     C
000D 900000      E     MOV     DPTR,#g_mem+083H
0010 E0                MOVX    A,@DPTR
0011 9440              SUBB    A,#040H
0013 900000      E     MOV     DPTR,#g_mem+082H
0016 E0                MOVX    A,@DPTR
0017 941F              SUBB    A,#01FH
0019 507E              JNC     ?C0188
                                           ; SOURCE LINE # 1175
001B AE00        R     MOV     R6,max_tension_6v_mod
001D AF00        R     MOV     R7,max_tension_6v_mod+01H
001F E4                CLR     A
0020 FC                MOV     R4,A
0021 FD                MOV     R5,A
0022 900000      E     MOV     DPTR,#dev_tension
0025 E0                MOVX    A,@DPTR
0026 F8                MOV     R0,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F9                MOV     R1,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FA                MOV     R2,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FB                MOV     R3,A
0030 120000      E     LCALL   ?C?SLCMP
0033 4006              JC      ?C0189
                                           ; SOURCE LINE # 1176
0035 E4                CLR     A
0036 900000      E     MOV     DPTR,#dev_pwm_limit
0039 F0                MOVX    @DPTR,A
003A 22                RET     
003B         ?C0189:
                                           ; SOURCE LINE # 1178
                                           ; SOURCE LINE # 1179
003B 900000      E     MOV     DPTR,#g_mem+082H
003E E0                MOVX    A,@DPTR
003F FE                MOV     R6,A
0040 A3                INC     DPTR
0041 E0                MOVX    A,@DPTR
0042 FF                MOV     R7,A
0043 E4                CLR     A
0044 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 86  

0045 FD                MOV     R5,A
0046 900000      E     MOV     DPTR,#dev_tension
0049 E0                MOVX    A,@DPTR
004A F8                MOV     R0,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D F9                MOV     R1,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 FA                MOV     R2,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FB                MOV     R3,A
0054 C3                CLR     C
0055 120000      E     LCALL   ?C?SLCMP
0058 5007              JNC     ?C0191
                                           ; SOURCE LINE # 1180
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D 7464              MOV     A,#064H
005F F0                MOVX    @DPTR,A
0060 22                RET     
0061         ?C0191:
                                           ; SOURCE LINE # 1181
                                           ; SOURCE LINE # 1182
0061 900000      E     MOV     DPTR,#g_mem+082H
0064 E0                MOVX    A,@DPTR
0065 FE                MOV     R6,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FF                MOV     R7,A
0069 FB                MOV     R3,A
006A AA06              MOV     R2,AR6
006C E4                CLR     A
006D 900000      E     MOV     DPTR,#dev_tension
0070 E0                MOVX    A,@DPTR
0071 FC                MOV     R4,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 FD                MOV     R5,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 FE                MOV     R6,A
0078 A3                INC     DPTR
0079 E0                MOVX    A,@DPTR
007A C3                CLR     C
007B 9B                SUBB    A,R3
007C FF                MOV     R7,A
007D EE                MOV     A,R6
007E 9A                SUBB    A,R2
007F FE                MOV     R6,A
0080 ED                MOV     A,R5
0081 9400              SUBB    A,#00H
0083 FD                MOV     R5,A
0084 EC                MOV     A,R4
0085 9400              SUBB    A,#00H
0087 FC                MOV     R4,A
0088 7809              MOV     R0,#09H
008A 120000      E     LCALL   ?C?SLSHR
008D 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1183
008F EF                MOV     A,R7
0090 900000      R     MOV     DPTR,#hitech_pwm_preload_values_6v
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 87  

0093 93                MOVC    A,@A+DPTR
0094 900000      E     MOV     DPTR,#dev_pwm_limit
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1184
                                           ; SOURCE LINE # 1185
                                           ; SOURCE LINE # 1186
0098 22                RET     
0099         ?C0188:
                                           ; SOURCE LINE # 1187
                                           ; SOURCE LINE # 1189
0099 AE00        R     MOV     R6,max_tension
009B AF00        R     MOV     R7,max_tension+01H
009D E4                CLR     A
009E FC                MOV     R4,A
009F FD                MOV     R5,A
00A0 900000      E     MOV     DPTR,#dev_tension
00A3 E0                MOVX    A,@DPTR
00A4 F8                MOV     R0,A
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 F9                MOV     R1,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FA                MOV     R2,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FB                MOV     R3,A
00AE D3                SETB    C
00AF 120000      E     LCALL   ?C?SLCMP
00B2 4006              JC      ?C0194
                                           ; SOURCE LINE # 1190
00B4 E4                CLR     A
00B5 900000      E     MOV     DPTR,#dev_pwm_limit
00B8 F0                MOVX    @DPTR,A
00B9 22                RET     
00BA         ?C0194:
                                           ; SOURCE LINE # 1191
                                           ; SOURCE LINE # 1192
00BA 900000      E     MOV     DPTR,#g_mem+082H
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 FF                MOV     R7,A
00C2 E4                CLR     A
00C3 FC                MOV     R4,A
00C4 FD                MOV     R5,A
00C5 900000      E     MOV     DPTR,#dev_tension
00C8 E0                MOVX    A,@DPTR
00C9 F8                MOV     R0,A
00CA A3                INC     DPTR
00CB E0                MOVX    A,@DPTR
00CC F9                MOV     R1,A
00CD A3                INC     DPTR
00CE E0                MOVX    A,@DPTR
00CF FA                MOV     R2,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FB                MOV     R3,A
00D3 C3                CLR     C
00D4 120000      E     LCALL   ?C?SLCMP
00D7 5007              JNC     ?C0196
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 88  

                                           ; SOURCE LINE # 1193
00D9 900000      E     MOV     DPTR,#dev_pwm_limit
00DC 7464              MOV     A,#064H
00DE F0                MOVX    @DPTR,A
00DF 22                RET     
00E0         ?C0196:
                                           ; SOURCE LINE # 1194
                                           ; SOURCE LINE # 1195
00E0 900000      E     MOV     DPTR,#dev_tension
00E3 E0                MOVX    A,@DPTR
00E4 FC                MOV     R4,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 FD                MOV     R5,A
00E8 A3                INC     DPTR
00E9 E0                MOVX    A,@DPTR
00EA FE                MOV     R6,A
00EB A3                INC     DPTR
00EC E0                MOVX    A,@DPTR
00ED 24C0              ADD     A,#0C0H
00EF FF                MOV     R7,A
00F0 EE                MOV     A,R6
00F1 34E0              ADDC    A,#0E0H
00F3 FE                MOV     R6,A
00F4 ED                MOV     A,R5
00F5 34FF              ADDC    A,#0FFH
00F7 FD                MOV     R5,A
00F8 EC                MOV     A,R4
00F9 34FF              ADDC    A,#0FFH
00FB FC                MOV     R4,A
00FC 7809              MOV     R0,#09H
00FE 120000      E     LCALL   ?C?SLSHR
0101 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1196
0103 C3                CLR     C
0104 900000      E     MOV     DPTR,#g_mem+083H
0107 E0                MOVX    A,@DPTR
0108 94EC              SUBB    A,#0ECH
010A 900000      E     MOV     DPTR,#g_mem+082H
010D E0                MOVX    A,@DPTR
010E 942C              SUBB    A,#02CH
0110 500A              JNC     ?C0198
                                           ; SOURCE LINE # 1197
0112 EF                MOV     A,R7
0113 900000      R     MOV     DPTR,#hitech_pwm_preload_values
0116 93                MOVC    A,@A+DPTR
0117 900000      E     MOV     DPTR,#dev_pwm_limit
011A F0                MOVX    @DPTR,A
011B 22                RET     
011C         ?C0198:
                                           ; SOURCE LINE # 1199
011C E500        R     MOV     A,index
011E 900000      R     MOV     DPTR,#pwm_preload_values
0121 93                MOVC    A,@A+DPTR
0122 900000      E     MOV     DPTR,#dev_pwm_limit
0125 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1200
                                           ; SOURCE LINE # 1201
                                           ; SOURCE LINE # 1202
                                           ; SOURCE LINE # 1203
0126         ?C0200:
0126 22                RET     
C51 COMPILER V9.51   INTERRUPTIONS                                                         01/12/2018 13:27:02 PAGE 89  

             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5723    ----
   CONSTANT SIZE    =     97    ----
   XDATA SIZE       =    182      13
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      73
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
