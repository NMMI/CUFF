C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.2\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051
                    -_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption functions are in this file.
  39          * \date         October 01, 2017
  40          * \author       _Centro "E.Piaggio"_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          
  50          #include "globals.h"
  51          #include "utils.h"
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 2   

  53          //===================================================================     global
  54          
  55          
  56          // PWM vaules needed to obtain 8 Volts given a certain input tension
  57          // Numbers are sperimentally calculated //[index] (milliampere)
  58          CYCODE uint8 pwm_preload_values[29] = {100,    //0 (11500)
  59                                                       100,//83
  60                                                       100,//78
  61                                                        76,
  62                                                        74,
  63                                                        72,    //5 (14000)
  64                                                        70,
  65                                                        68,
  66                                                        67,
  67                                                        65,
  68                                                        64,    //10 (16500)
  69                                                        63,
  70                                                        62,
  71                                                        61,
  72                                                        60,
  73                                                        59,    //15 (19000)
  74                                                        58,
  75                                                        57,
  76                                                        56,
  77                                                        56,
  78                                                        55,    //20 (21500)
  79                                                        54,
  80                                                        54,
  81                                                        53,
  82                                                        52,
  83                                                        52,    //25 (24000)
  84                                                        52,
  85                                                        51,
  86                                                        51};   //28 (25500)
  87          
  88          CYCODE uint8 hitech_pwm_preload_values[36] = {  100,   //0 (8000)
  89                                                          76,
  90                                                          71,
  91                                                          69,
  92                                                          67,
  93                                                          65,     //5 (10500)
  94                                                          63,
  95                                                          61,
  96                                                          60,
  97                                                          58,
  98                                                          57,     //10 (13000)
  99                                                          56,
 100                                                          55,
 101                                                          54,
 102                                                          53,
 103                                                          52,     //15 (15500)
 104                                                          51,
 105                                                          50,
 106                                                          49,
 107                                                          49,
 108                                                          48,     //20 (18000)
 109                                                          47,
 110                                                          47,
 111                                                          46,
 112                                                          45,
 113                                                          45,     //25 (20500)
 114                                                          45,
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 3   

 115                                                          44,
 116                                                          44,
 117                                                          43,
 118                                                          43,     //30 (23000)
 119                                                          43,
 120                                                          43,
 121                                                          42,
 122                                                          42,
 123                                                          42};    //35 (25500)
 124          
 125          CYCODE uint8 hitech_pwm_preload_values_6v[32] = {100,   //0 (6000)
 126                                                            76,
 127                                                            71,
 128                                                            68,
 129                                                            66,
 130                                                            64,   //5 (8750)
 131                                                            62,
 132                                                            60,
 133                                                            58,
 134                                                            56,
 135                                                            54,   //10 (11500)
 136                                                            53,
 137                                                            52,
 138                                                            51,
 139                                                            50,
 140                                                            49,   //15 ()
 141                                                            47,
 142                                                            46,
 143                                                            45,
 144                                                            44,
 145                                                            43,   //20 ()
 146                                                            42,
 147                                                            41,
 148                                                            40,
 149                                                            39,
 150                                                            38,   //25 ()
 151                                                            37,
 152                                                            37,
 153                                                            37,
 154                                                            37,
 155                                                            36};  //30 (24750)
 156          
 157          //==============================================================================
 158          //                                                            WATCHDOG INTERRUPT
 159          //==============================================================================
 160          
 161          CY_ISR(ISR_WATCHDOG_Handler){
 162   1      
 163   1          // Set WDT flag
 164   1          
 165   1          watchdog_flag = TRUE;
 166   1      
 167   1      }
 168          
 169          //==============================================================================
 170          //                                                            RS485 RX INTERRUPT
 171          //==============================================================================
 172          
 173          CY_ISR(ISR_RS485_RX_ExInterrupt) {
 174   1      
 175   1          // Set RS485 flag
 176   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 4   

 177   1          interrupt_flag = TRUE;
 178   1           
 179   1      }
 180          
 181          //==============================================================================
 182          //                                                             INTERRUPT MANAGER
 183          //==============================================================================
 184          // Manage interrupt from RS485 
 185          //==============================================================================
 186          // Processing RS-485 data frame:
 187          //
 188          // - WAIT_START:    Waits for beginning characters;
 189          // - WAIT_ID:       Waits for ID;
 190          // - WAIT_LENGTH:   Data length;
 191          // - RECEIVE:       Receive all bytes;
 192          // - UNLOAD:        Wait for another device end of transmission;
 193          //
 194          //==============================================================================
 195          
 196          void interrupt_manager(){
 197   1      
 198   1          
 199   1          //===========================================     local variables definition
 200   1      
 201   1          static uint8 CYDATA state = WAIT_START;                      // state
 202   1          
 203   1          //------------------------------------------------- local data packet
 204   1          static uint8 CYDATA data_packet_index;
 205   1          static uint8 CYDATA data_packet_length;
 206   1          static uint8 data_packet_buffer[128];                     
 207   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 208   1          //-------------------------------------------------
 209   1      
 210   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 211   1          CYBIT           rx_data_type;                       // my id?
 212   1          uint8 CYDATA    package_count = 0;                     
 213   1      
 214   1          //======================================================     receive routine
 215   1          
 216   1          // Get data until buffer is not empty 
 217   1          
 218   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 219   2              // 6 stima di numero massimo di pacchetti che riesco a leggere senza bloccare l'esecuzione del fir
             -mware
 220   2              
 221   2              // Get next char
 222   2              rx_data = UART_RS485_GetChar();
 223   2              
 224   2              switch (state) {
 225   3                  //-----     wait for frame start     -------------------------------
 226   3                  case WAIT_START:
 227   3                  
 228   3                      rx_queue[0] = rx_queue[1];
 229   3                      rx_queue[1] = rx_queue[2];
 230   3                      rx_queue[2] = rx_data;
 231   3                      
 232   3                      // Check for header configuration package
 233   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 234   4                          rx_queue[0] = 0;
 235   4                          rx_queue[1] = 0;
 236   4                          rx_queue[2] = 0;
 237   4                          state       = WAIT_ID;                    
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 5   

 238   4                      }else
 239   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 240   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 241   3                              (rx_queue[2] == 10))        //ASCII - LF)
 242   3                              infoGet(INFO_ALL);
 243   3                      break;
 244   3      
 245   3                  //-----     wait for id     ----------------------------------------
 246   3                  case  WAIT_ID:
 247   3      
 248   3                      // packet is for my ID or is broadcast
 249   3                      if (rx_data == c_mem.id || rx_data == 0 || (rx_data == c_mem.hand_ID && (c_mem.cuff_activa
             -tion_flag_force == TRUE ||c_mem.cuff_activation_flag_proprio == TRUE || c_mem.cuff_activation_flag_force_proprio == TRUE
             -)))
 250   3                          rx_data_type = FALSE;
 251   3                      else                //packet is for others
 252   3                          rx_data_type = TRUE;
 253   3                      
 254   3                      data_packet_length = 0;
 255   3                      state = WAIT_LENGTH;
 256   3                      break;
 257   3      
 258   3                  //-----     wait for length     ------------------------------------
 259   3                  case  WAIT_LENGTH:
 260   3      
 261   3       
 262   3                      data_packet_length = rx_data;
 263   3                      // check validity of pack length
 264   3                      if (data_packet_length <= 1) {
 265   4                          data_packet_length = 0;
 266   4                          state = WAIT_START;
 267   4                      } else if (data_packet_length > 128) {
 268   4                          data_packet_length = 0;
 269   4                          state = WAIT_START;
 270   4                      } else {
 271   4                          data_packet_index = 0;
 272   4                          
 273   4                          if(rx_data_type == FALSE)
 274   4                              state = RECEIVE;          // packet for me or broadcast
 275   4                          else
 276   4                              state = UNLOAD;           // packet for others
 277   4                      }
 278   3                      break;
 279   3      
 280   3                  //-----     receiving     -------------------------------------------
 281   3                  case RECEIVE:
 282   3      
 283   3                      data_packet_buffer[data_packet_index] = rx_data;
 284   3                      data_packet_index++;
 285   3                      
 286   3                      // check end of transmission
 287   3                      if (data_packet_index >= data_packet_length) {
 288   4                          // verify if frame ID corresponded to the device ID
 289   4                          if (rx_data_type == FALSE) {
 290   5                              // copying data from buffer to global packet
 291   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 292   5                              g_rx.length = data_packet_length;
 293   5                              g_rx.ready  = 1;
 294   5                              commProcess();
 295   5                          }
 296   4                          
 297   4                          data_packet_index  = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 6   

 298   4                          data_packet_length = 0;
 299   4                          state              = WAIT_START;
 300   4                          package_count++;
 301   4                      
 302   4                      }
 303   3                      break;
 304   3      
 305   3                  //-----     other device is receving     ---------------------------
 306   3                  case UNLOAD:
 307   3                      if (!(--data_packet_length)) {
 308   4                          data_packet_index  = 0;
 309   4                          data_packet_length = 0;
 310   4                          RS485_CTS_Write(1);
 311   4                          RS485_CTS_Write(0);
 312   4                          state              = WAIT_START;
 313   4                          package_count++;
 314   4                      }
 315   3                      break;
 316   3              }
 317   2          }
 318   1      }
 319          
 320          //==============================================================================
 321          //                                                            FUNCTION SCHEDULER
 322          //==============================================================================
 323          // Call all the function with the right frequency
 324          //==============================================================================
 325          // Base frequency 1000 Hz
 326          //==============================================================================
 327          
 328          void function_scheduler(void) {
 329   1       
 330   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 331   1          
 332   1          // Start ADC Conversion, SOC = 1
 333   1      
 334   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 335   1          
 336   1          ADC_SOC_Write(0x01); 
 337   1          
 338   1          // Check Interrupt 
 339   1      
 340   1          if (interrupt_flag){
 341   2              interrupt_flag = FALSE;
 342   2              interrupt_manager();
 343   2          }
 344   1        
 345   1          //---------------------------------- Get Encoders
 346   1      
 347   1          encoder_reading(0, FALSE); 
 348   1          
 349   1          // Check Interrupt     
 350   1          
 351   1          if (interrupt_flag){
 352   2              interrupt_flag = FALSE;
 353   2              interrupt_manager();
 354   2          }   
 355   1          
 356   1          encoder_reading(1, FALSE);
 357   1          
 358   1          // Check Interrupt 
 359   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 7   

 360   1          if (interrupt_flag){
 361   2              interrupt_flag = FALSE;
 362   2              interrupt_manager();
 363   2          }
 364   1          
 365   1          /*encoder_reading(2, FALSE);
 366   1          
 367   1          // Check Interrupt 
 368   1          
 369   1          if (interrupt_flag){
 370   1              interrupt_flag = FALSE;
 371   1              interrupt_manager();
 372   1          }*/
 373   1      
 374   1          //---------------------------------- Control Motors
 375   1          
 376   1          motor_control(0);
 377   1      
 378   1          // Check Interrupt 
 379   1      
 380   1          if (interrupt_flag){
 381   2              interrupt_flag = FALSE;
 382   2              interrupt_manager();
 383   2          }
 384   1          
 385   1          motor_control(1);
 386   1          
 387   1          // Check Interrupt 
 388   1          
 389   1          if (interrupt_flag){
 390   2              interrupt_flag = FALSE;
 391   2              interrupt_manager();
 392   2          }
 393   1      
 394   1          //---------------------------------- Read conversion buffer - LOCK function
 395   1      
 396   1          analog_read_end();
 397   1      
 398   1          //---------------------------------- Calibration 
 399   1      
 400   1          // Divider 100, freq = 10 Hz
 401   1          /*if (!(calibration_flag == STOP)) {
 402   1              if (counter_calibration == CALIBRATION_DIV) {
 403   1                  calibration();
 404   1                  counter_calibration = 0;
 405   1              }
 406   1              counter_calibration++;
 407   1          }
 408   1          
 409   1          // Check Interrupt 
 410   1          
 411   1          if (interrupt_flag){
 412   1              interrupt_flag = FALSE;
 413   1              interrupt_manager();
 414   1          }*/
 415   1          
 416   1          if (pretensioning_flag == TRUE) {
 417   2             if (counter_calibration == CALIBRATION_DIV) {
 418   3                 pretensioning_process();
 419   3                 counter_calibration = 0;
 420   3             }
 421   2          counter_calibration++;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 8   

 422   2          } else {
 423   2              if(cuff_flag_force)
 424   2                  drive_cuff();
 425   2                  
 426   2              if (cuff_flag_proprio)
 427   2                  slide_cuff();
 428   2      
 429   2              if (cuff_flag_force_proprio)
 430   2                  force_and_slide_cuff();        
 431   2          }   
 432   1          
 433   1          if (interrupt_flag){
 434   2              interrupt_flag = FALSE;
 435   2              interrupt_manager();
 436   2          }
 437   1              
 438   1         
 439   1          //---------------------------------- Update States
 440   1          
 441   1          // Load k-1 state
 442   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 443   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 444   1      
 445   1          // Load k+1 state
 446   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 447   1      
 448   1          if (interrupt_flag){
 449   2              interrupt_flag = FALSE;
 450   2              interrupt_manager();
 451   2          }
 452   1      
 453   1          //CyDelayUs(100);
 454   1      
 455   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 456   1          MY_TIMER_WriteCounter(5000000);
 457   1      
 458   1      }
 459          
 460          
 461          //==============================================================================
 462          //                                                                MOTORS CONTROL
 463          //==============================================================================
 464          
 465          void motor_control(const uint8 idx) {
 466   1          
 467   1          uint8 CYDATA index = idx;
 468   1       
 469   1          int32 CYDATA curr_ref;
 470   1      
 471   1          int32 CYDATA pwm_input = 0;
 472   1          
 473   1          int32 CYDATA pos_error;
 474   1          int32 CYDATA curr_error;
 475   1          //int32 CYDATA defl_input[NUM_OF_MOTORS];
 476   1          
 477   1          int32 CYDATA k_p = c_mem.k_p;  
 478   1          int32 CYDATA k_i = c_mem.k_i; 
 479   1          int32 CYDATA k_d = c_mem.k_d; 
 480   1      
 481   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 482   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 483   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 9   

 484   1      
 485   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 486   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 487   1          int32 CYDATA k_d_dl = c_mem.k_d_dl; 
 488   1      
 489   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 490   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 491   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;  
 492   1      
 493   1          // Static Variables
 494   1          
 495   1          static CYBIT dirM0, dirM1;
 496   1          
 497   1          static int32 prev_curr[NUM_OF_MOTORS];
 498   1      
 499   1          static int32 pos_error_sum[NUM_OF_MOTORS];
 500   1          static int32 curr_error_sum[NUM_OF_MOTORS];
 501   1          
 502   1          // check index value
 503   1          if (index >= NUM_OF_MOTORS)
 504   1              return;
 505   1      
 506   1          switch(c_mem.control_mode) {
 507   2              case CONTROL_ANGLE:
 508   2              /*case DEFLECTION_CONTROL:
 509   2              
 510   2                  if(c_mem.control_mode == DEFLECTION_CONTROL){
 511   2                                      //for deflection control the shaft position must be summed to reference
 512   2                      defl_input[index] = (g_ref.pos[index] + g_meas.pos[2]);
 513   2                      pos_error = defl_input[index] - g_meas.pos[index];
 514   2                  }
 515   2                  else 
 516   2                      // position error*/
 517   2                  
 518   2                  pos_error = g_ref.pos[index] - g_meas.pos[index];
 519   2                 
 520   2                  if (interrupt_flag){
 521   3                      interrupt_flag = FALSE;
 522   3                      interrupt_manager();
 523   3                  }
 524   2                  
 525   2                  // error sum for integral
 526   2                  pos_error_sum[index] += pos_error;
 527   2      
 528   2                  //anti wind-up
 529   2                  if (pos_error_sum[index] > POS_INTEGRAL_SAT_LIMIT)
 530   2                      pos_error_sum[index] = POS_INTEGRAL_SAT_LIMIT;
 531   2                  else{
 532   3                      if (pos_error_sum[index] < -POS_INTEGRAL_SAT_LIMIT)
 533   3                          pos_error_sum[index] = -POS_INTEGRAL_SAT_LIMIT;
 534   3                  }
 535   2                    
 536   2                  if (interrupt_flag){
 537   3                      interrupt_flag = FALSE;
 538   3                      interrupt_manager();
 539   3                  }
 540   2                  // pwm_input init
 541   2                  pwm_input = 0;
 542   2                  // Proportional
 543   2                  if (k_p != 0) {
 544   3                          
 545   3                      if ((pos_error > 131072) || (pos_error < -131072))  //if grater than 2^17
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 10  

 546   3                          pwm_input = (int32)(k_p * (pos_error >> 8)) >> 8;
 547   3                      else
 548   3                          pwm_input = (int32)(k_p * pos_error) >> 16;
 549   3                  }
 550   2                  
 551   2                  if (interrupt_flag){
 552   3                      interrupt_flag = FALSE;
 553   3                      interrupt_manager();
 554   3                  }
 555   2                            
 556   2                  // Integral
 557   2                  if (k_i != 0) 
 558   2                      pwm_input += (int32)((k_i >> 6) * pos_error_sum[index]) >> 10;
 559   2                  
 560   2                  // Derivative
 561   2                  if (k_d != 0)
 562   2                      pwm_input += (int32)(k_d * (g_measOld.pos[index] - g_meas.pos[index])) >> 16;
 563   2               
 564   2          
 565   2                  if (interrupt_flag){
 566   3                      interrupt_flag = FALSE;
 567   3                      interrupt_manager();
 568   3                  }
 569   2                   
 570   2                  // Update measure
 571   2                  //prev_pos[index] = g_meas.pos[index];
 572   2      
 573   2                  if (index == 0){
 574   3                      if (pwm_input >= 0)
 575   3                          dirM0 = 1;
 576   3                          //direction |= 0x01;
 577   3                      else
 578   3                          dirM0 = 0;
 579   3                          //direction &= 0xFE;
 580   3                  }else{ // index == 1
 581   3                      if (pwm_input >= 0)
 582   3                          dirM1 = 1;
 583   3                         // direction |= 0x02;
 584   3                      else
 585   3                          dirM1 = 0;
 586   3                          //direction &= 0xFD;
 587   3                  }
 588   2                  
 589   2                  break;
 590   2      
 591   2              case CURR_AND_POS_CONTROL:
 592   2              /*case DEFL_CURRENT_CONTROL:
 593   2      
 594   2                  if(c_mem.control_mode == DEFL_CURRENT_CONTROL){
 595   2                      //for deflection control the shaft position must be summed to reference
 596   2                      defl_input[index] = (g_ref.pos[index] + g_meas.pos[2]);
 597   2                      pos_error = defl_input[index] - g_meas.pos[index];
 598   2                  }
 599   2                  else */
 600   2                  
 601   2                  pos_error = g_ref.pos[index] - g_meas.pos[index];
 602   2      
 603   2                  pos_error_sum[index] += pos_error;
 604   2      
 605   2                  if (interrupt_flag){
 606   3                      interrupt_flag = FALSE;
 607   3                      interrupt_manager();
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 11  

 608   3                  }
 609   2      
 610   2                  // error_sum saturation
 611   2                  if (pos_error_sum[index] > POS_INTEGRAL_SAT_LIMIT)
 612   2                      pos_error_sum[index] = POS_INTEGRAL_SAT_LIMIT;
 613   2                  else{
 614   3                      if (pos_error_sum[index] < -POS_INTEGRAL_SAT_LIMIT)
 615   3                          pos_error_sum[index] = -POS_INTEGRAL_SAT_LIMIT;
 616   3                  }
 617   2                  // ------ position PID control -----
 618   2      
 619   2                  curr_ref = 0;
 620   2      
 621   2                  if (interrupt_flag){
 622   3                      interrupt_flag = FALSE;
 623   3                      interrupt_manager();
 624   3                  }
 625   2      
 626   2                  // Proportional
 627   2                  if (k_p_dl != 0)
 628   2                      curr_ref += (int32)(k_p_dl * pos_error) >> 16;
 629   2      
 630   2                  // Integral
 631   2                  if (k_i_dl != 0)
 632   2                      curr_ref += (int32)(k_i_dl * pos_error_sum[index]) >> 16;
 633   2                  
 634   2                  // Derivative
 635   2                  if (k_d_dl != 0)
 636   2                      curr_ref += (int32)(k_d_dl * (g_measOld.pos[index] - g_meas.pos[index])) >> 16;
 637   2                              
 638   2                  if (interrupt_flag){
 639   3                      interrupt_flag = FALSE;
 640   3                      interrupt_manager();
 641   3                  }
 642   2      
 643   2                  // saturate max current
 644   2                  if (curr_ref > c_mem.current_limit)
 645   2                      curr_ref = c_mem.current_limit;
 646   2                  else {
 647   3                      if (curr_ref < -c_mem.current_limit)
 648   3                          curr_ref = -c_mem.current_limit;
 649   3                  }
 650   2      
 651   2                  if (interrupt_flag){
 652   3                      interrupt_flag = FALSE;
 653   3                      interrupt_manager();
 654   3                  }
 655   2      
 656   2                  // current error
 657   2                  curr_error = curr_ref - g_meas.curr[index];
 658   2      
 659   2                  curr_error_sum[index] += curr_error;
 660   2      
 661   2                  if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
 662   2                      curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 663   2                  else{
 664   3                      if (curr_error_sum[index] < -CURR_INTEGRAL_SAT_LIMIT)
 665   3                          curr_error_sum[index] = -CURR_INTEGRAL_SAT_LIMIT;
 666   3                  }
 667   2      
 668   2                  if (interrupt_flag){
 669   3                      interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 12  

 670   3                      interrupt_manager();
 671   3                  }
 672   2      
 673   2                  // ----- current PID control -----
 674   2      
 675   2                  pwm_input = 0;
 676   2      
 677   2                  // Proportional
 678   2                  if (k_p_c_dl != 0)
 679   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 680   2                  
 681   2                  // Integral
 682   2                  if (k_i_c_dl != 0)
 683   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum[index]) >> 16;
 684   2                  
 685   2                  // Derivative
 686   2                  if (k_d_c_dl != 0)
 687   2                      pwm_input += (int32)(k_d_c_dl * (prev_curr[index] - g_meas.curr[index])) >> 16;
 688   2                  
 689   2                  // Update current
 690   2                  prev_curr[index] = g_meas.curr[index];
 691   2      
 692   2                  if (interrupt_flag){
 693   3                      interrupt_flag = FALSE;
 694   3                      interrupt_manager();
 695   3                  }
 696   2      
 697   2                  if (index == 0){
 698   3                      if (pwm_input >= 0)
 699   3                          dirM0 = 1;
 700   3                          //direction |= 0x01;
 701   3                      else
 702   3                          dirM0 = 0;
 703   3                          //direction &= 0xFE;
 704   3                  }else{ // index == 1
 705   3                      if (pwm_input >= 0)
 706   3                          dirM1 = 1;
 707   3                         // direction |= 0x02;
 708   3                      else
 709   3                          dirM1 = 0;
 710   3                          //direction &= 0xFD;
 711   3                  }
 712   2      
 713   2                  break;
 714   2      
 715   2              case CONTROL_CURRENT:
 716   2      
 717   2                  // Current ref from pos ref
 718   2                  curr_ref = g_ref.pos[index] >> g_mem.res[index];
 719   2      
 720   2                  // saturate max current
 721   2                  if (curr_ref > c_mem.current_limit)
 722   2                      curr_ref = c_mem.current_limit;
 723   2                  
 724   2                  // Current error
 725   2                  curr_error = abs(curr_ref) - g_meas.curr[index];
 726   2      
 727   2                  // Error sum for integral
 728   2                  curr_error_sum[index] += curr_error;
 729   2      
 730   2                  //anti wind-up
 731   2                  if (curr_error_sum[index] > CURR_INTEGRAL_SAT_LIMIT)
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 13  

 732   2                      curr_error_sum[index] = CURR_INTEGRAL_SAT_LIMIT;
 733   2                  else{
 734   3                      if (curr_error_sum[index] < 0)
 735   3                          curr_error_sum[index] = 0;
 736   3                  }
 737   2      
 738   2                  // pwm_input init
 739   2                  pwm_input = 0;
 740   2      
 741   2                  // Proportional
 742   2                  if (k_p_c != 0)
 743   2                      pwm_input += (int32)(k_p * curr_error) >> 16;
 744   2      
 745   2      
 746   2                  // Integral
 747   2                  if (k_i_c != 0)
 748   2                      pwm_input += (int32)(k_i_c * (curr_error_sum[index] >> 6)) >> 10;
 749   2                  
 750   2                  // Derivative
 751   2                  if (k_d_c != 0)
 752   2                      pwm_input += (int32)(k_d_c * (prev_curr[index] - g_meas.curr[index])) >> 16;
 753   2      
 754   2                  // Saturate pwm_input
 755   2                  if (pwm_input < 0)
 756   2                      pwm_input = 0;
 757   2      
 758   2                  // Update measure
 759   2                  prev_curr[index] = g_meas.curr[index];
 760   2                  
 761   2                  if (index == 0){
 762   3                      if (pwm_input >= 0)
 763   3                          dirM0 = 1;
 764   3                          //direction |= 0x01;
 765   3                      else
 766   3                          dirM0 = 0;
 767   3                          //direction &= 0xFE;
 768   3                  }else{ // index == 1
 769   3                      if (pwm_input >= 0)
 770   3                          dirM1 = 1;
 771   3                         // direction |= 0x02;
 772   3                      else
 773   3                          dirM1 = 0;
 774   3                          //direction &= 0xFD;
 775   3                  }
 776   2                  
 777   2                  break;
 778   2      
 779   2              case CONTROL_PWM:
 780   2                  // Direct PWM value
 781   2                  pwm_input = g_ref.pos[index] >> g_mem.res[index];
 782   2      
 783   2                  if (index == 0){
 784   3                      if (pwm_input >= 0)
 785   3                          dirM0 = 1;
 786   3                          //direction |= 0x01;
 787   3                      else
 788   3                          dirM0 = 0;
 789   3                          //direction &= 0xFE;
 790   3                  }else{ // index == 1
 791   3                      if (pwm_input >= 0)
 792   3                          dirM1 = 1;
 793   3                         // direction |= 0x02;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 14  

 794   3                      else
 795   3                          dirM1 = 0;
 796   3                          //direction &= 0xFD;
 797   3                  }
 798   2      
 799   2                  break;
 800   2      
 801   2              default:
 802   2                  break;
 803   2          }
 804   1          
 805   1          if (interrupt_flag){
 806   2              interrupt_flag = FALSE;
 807   2              interrupt_manager();
 808   2          }
 809   1              
 810   1          // abs(pwm_input) must be lower or equal to PWM_MAX_VALUE
 811   1          if(pwm_input >  PWM_MAX_VALUE) 
 812   1              pwm_input =  PWM_MAX_VALUE;
 813   1          if(pwm_input < -PWM_MAX_VALUE) 
 814   1              pwm_input = -PWM_MAX_VALUE;
 815   1          
 816   1          if (interrupt_flag){
 817   2              interrupt_flag = FALSE;
 818   2              interrupt_manager();
 819   2          }   
 820   1      
 821   1          // remap pwm_input on pwm_limit based on input tension to have maximum 8 volts
 822   1          if (c_mem.control_mode != CONTROL_PWM)
 823   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 824   1      
 825   1          // drive direction and pwm duty cycle
 826   1              
 827   1          if (dirM0){
 828   2              if (dirM1)
 829   2                  MOTOR_DIR_Write(0x03);
 830   2              else
 831   2                  MOTOR_DIR_Write(0x01);
 832   2          }
 833   1          else{
 834   2              if (dirM1)
 835   2                  MOTOR_DIR_Write(0x02);
 836   2              else
 837   2                  MOTOR_DIR_Write(0x00);
 838   2          }
 839   1      
 840   1          if (interrupt_flag){
 841   2              interrupt_flag = FALSE;
 842   2              interrupt_manager();
 843   2          }
 844   1          
 845   1          if (index == 0) {
 846   2              pwm_sign[0] = SIGN(pwm_input);
 847   2              PWM_MOTORS_WriteCompare1(abs(pwm_input));
 848   2          }
 849   1          else {// index == 1
 850   2              pwm_sign[1] = SIGN(pwm_input);
 851   2              PWM_MOTORS_WriteCompare2(abs(pwm_input));
 852   2          }
 853   1          
 854   1          if (interrupt_flag){
 855   2              interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 15  

 856   2              interrupt_manager();
 857   2          }
 858   1      }
 859          
 860          //==============================================================================
 861          //                                                           ANALOG MEASUREMENTS
 862          //==============================================================================
 863          
 864          void analog_read_end() {
 865   1             
 866   1          /* =========================================================================
 867   1          /   Ideal formulation to calculate tension and current
 868   1          /
 869   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
 870   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
 871   1          /
 872   1          /   Definition:
 873   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
 874   1          /   offset = 2000 -> hardware amplifier bias in mV
 875   1          /   gain = 8.086 -> amplifier gain
 876   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
 877   1          /
 878   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
 879   1          /   and offset unit of measurment is counts, instead dev_tension and
 880   1          /   g_meas.curr[] are converted in properly unit.
 881   1          /  =========================================================================
 882   1          */
 883   1          
 884   1          // Wait for conversion end
 885   1          while(!ADC_STATUS_Read()){
 886   2              if (interrupt_flag){
 887   3                  interrupt_flag = FALSE;
 888   3                  interrupt_manager();
 889   3              }
 890   2          }
 891   1          
 892   1          // Convert tension read
 893   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
 894   1          
 895   1          if (interrupt_flag){
 896   2              interrupt_flag = FALSE;
 897   2              interrupt_manager();
 898   2          }
 899   1      
 900   1          // Until there is no valid input tension repeat this measurement
 901   1          
 902   1          if (dev_tension > 0){
 903   2              
 904   2              // Set PWM depends on tension
 905   2              pwm_limit_search();
 906   2              
 907   2              // Check Interrupt 
 908   2          
 909   2              if (interrupt_flag){
 910   3                  interrupt_flag = FALSE;
 911   3                  interrupt_manager();
 912   3              }
 913   2      
 914   2              // Filter and Set currents
 915   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign[0]);
 916   2              
 917   2              // Check Interrupt 
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 16  

 918   2          
 919   2              if (interrupt_flag){
 920   3                  interrupt_flag = FALSE;
 921   3                  interrupt_manager();
 922   3              }
 923   2              g_meas.curr[1] = filter_i2((int16) (((int32)(ADC_buf[2] - 1638) * 25771) >> 13) * pwm_sign[1]);
 924   2              
 925   2              // Check Interrupt 
 926   2          
 927   2              if (interrupt_flag){
 928   3                  interrupt_flag = FALSE;
 929   3                  interrupt_manager();
 930   3              }
 931   2          }
 932   1          else {
 933   2              g_meas.curr[0] = 0;
 934   2              g_meas.curr[1] = 0;
 935   2          }
 936   1      }
 937          
 938          //==============================================================================
 939          //                                                               ENCODER READING
 940          //==============================================================================
 941          
 942          void encoder_reading(const uint8 idx, const uint8 flag)
 943          {
 944   1          uint8 CYDATA index = idx;
 945   1          
 946   1          uint8 jj;
 947   1          
 948   1          uint32 data_encoder;
 949   1          int32 value_encoder;
 950   1          int32 aux;
 951   1      
 952   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 953   1      
 954   1          static uint8 error[NUM_OF_SENSORS];
 955   1          
 956   1          static CYBIT only_first_time = TRUE;
 957   1      
 958   1          // static int32 l_value[NUM_OF_SENSORS];   //last value for vel
 959   1          // static int32 ll_value[NUM_OF_SENSORS];  //last last value for vel
 960   1          // static int32 lll_value[NUM_OF_SENSORS];  //last last last value for vel
 961   1      
 962   1          if (index >= NUM_OF_SENSORS)
 963   1              return;
 964   1          
 965   1          if (reset_last_value_flag) {
 966   2              for (jj = NUM_OF_SENSORS; jj--;) {
 967   3                  last_value_encoder[jj] = 0;
 968   3              }
 969   2              reset_last_value_flag = 0;
 970   2          }
 971   1      
 972   1          //======================================================     reading sensors
 973   1          if (index == 0)
 974   1                  data_encoder = SHIFTREG_ENC_1_ReadData() & 0x3FFFF;
 975   1          else {
 976   2              if (index == 1)
 977   2                  data_encoder = SHIFTREG_ENC_2_ReadData() & 0x3FFFF;
 978   2              else {
 979   3                  if (index == 2)
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 17  

 980   3                      data_encoder = SHIFTREG_ENC_3_ReadData() & 0x3FFFF;
 981   3                  else // index == 3
 982   3                      data_encoder = SHIFTREG_ENC_4_ReadData() & 0x3FFFF;
 983   3              }
 984   2          }    
 985   1      
 986   1          if (check_enc_data(&data_encoder)) {
 987   2              if(flag)    // if the flag is set, save the measurement without offset to initialize cuff's zero p
             -osition
 988   2                  value_encoder = (int16) (32768 - ((data_encoder & 0x3FFC0) >> 2));
 989   2              else
 990   2                  value_encoder = (int16) (32768 - ((data_encoder & 0x3FFC0) >> 2) + g_mem.m_off[index]);  
 991   2      
 992   2              // Initialize last_value_encoder
 993   2              if (only_first_time) {
 994   3                  last_value_encoder[index] = value_encoder;
 995   3                  
 996   3                  if (index == (NUM_OF_SENSORS - 1))
 997   3                      only_first_time = 0;
 998   3              }
 999   2      
1000   2              // Take care of rotations
1001   2              aux = value_encoder - last_value_encoder[index];
1002   2      
1003   2              // ====================== 1 TURN ======================
1004   2              // -32768                    0                    32767 -32768                   0                
             -     32767
1005   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
1006   2              //              |                         |      |           |      |                         |
1007   2              //           -16384                     16383    |           |   -16384                     16383
1008   2              //                                               |           |
1009   2              //                                           24575           -24576
1010   2              //                                               |___________|
1011   2              //                                                   49152
1012   2      
1013   2              // if we are in the right interval, take care of rotation
1014   2              // and update the variable only if the difference between
1015   2              // one measure and another is less than 1/4 of turn
1016   2      
1017   2              // Considering we are sampling at 1kHz, this means that our shaft needs
1018   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
1019   2              // equal to 250 turn/s -> 15000 RPM
1020   2      
1021   2              if (aux > 49152)
1022   2                  g_meas.rot[index]--;
1023   2              else{ 
1024   3                  if (aux < -49152)
1025   3                      g_meas.rot[index]++;
1026   3                  else{
1027   4                      if (abs(aux) > 16384) { // if two measure are too far
1028   5                          error[index]++;
1029   5                          if (error[index] < 10)
1030   5                              // Discard
1031   5                              return;
1032   5                      }
1033   4                  }
1034   3              }
1035   2              
1036   2              error[index] = 0;
1037   2              
1038   2              last_value_encoder[index] = value_encoder;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 18  

1039   2      
1040   2              value_encoder += (int32)g_meas.rot[index] << 16;
1041   2      
1042   2              if (c_mem.m_mult[index] != 1.0)
1043   2                  value_encoder *= c_mem.m_mult[index];
1044   2            
1045   2              g_meas.pos[index] = value_encoder;
1046   2          }
1047   1      
1048   1          // // velocity calculation
1049   1          // switch(i) {
1050   1          //     case 0: {
1051   1          //         g_meas.vel[i] = (int16)filter_vel_1((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1052   1          //         break;
1053   1          //     }
1054   1          //     case 1: {
1055   1          //         g_meas.vel[i] = (int16)filter_vel_2((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1056   1          //         break;
1057   1          //     }
1058   1          //     case 2: {
1059   1          //         g_meas.vel[i] = (int16)filter_vel_3((3*value_encoder + l_value[i] - ll_value[i] - 3*lll_val
             -ue[i]) / 10);
1060   1          //         break;
1061   1          //     }
1062   1          // }
1063   1      
1064   1          // // update old values
1065   1          // lll_value[i] = ll_value[i];
1066   1          // ll_value[i] = l_value[i];
1067   1          // l_value[i] = value_encoder;
1068   1      }
1069          //==============================================================================
1070          //                                                              PWM_LIMIT_SEARCH
1071          //==============================================================================
1072          
1073          void pwm_limit_search() {
1074   1          
1075   1          uint8  CYDATA index;
1076   1          uint16 CYDATA max_tension = 25500;
1077   1          uint16 CYDATA max_tension_6v_mod = 14750;
1078   1      
1079   1          if(g_mem.power_tension < 8000) {
1080   2              //Mod. 6 Volts
1081   2              if(dev_tension > max_tension_6v_mod)
1082   2                  dev_pwm_limit = 0;
1083   2      
1084   2              else {
1085   3                  if(dev_tension < g_mem.power_tension)
1086   3                      dev_pwm_limit = 100;
1087   3                  else {
1088   4                      index = (uint8)((dev_tension - g_mem.power_tension) >> 9);
1089   4                      dev_pwm_limit = hitech_pwm_preload_values_6v[index];
1090   4                  }
1091   3              }
1092   2          }
1093   1          else {
1094   2              // 8 - 12 volts
1095   2              if (dev_tension > max_tension)    // Max value 
1096   2                  dev_pwm_limit = 0;
1097   2              else{ 
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 19  

1098   3                  if (dev_tension < g_mem.power_tension) // Min value
1099   3                      dev_pwm_limit = 100;
1100   3                  else {                  
1101   4                      index = (uint8)((dev_tension - 8000) >> 9);
1102   4                      if(g_mem.power_tension < 11500)
1103   4                          dev_pwm_limit = hitech_pwm_preload_values[index];
1104   4                      else
1105   4                          dev_pwm_limit = pwm_preload_values[index];
1106   4                  }
1107   3              }
1108   2          }
1109   1      }
1110          
1111          //==============================================================================
1112          //                                                         PRETENSIONING PROCESS
1113          //==============================================================================
1114          
1115          void pretensioning_process() {
1116   1          
1117   1          static int16 epsilon = 10;
1118   1          static uint8 phase = 0;
1119   1          static uint8 phase_counter = 0;
1120   1          int32 aux;
1121   1          uint8 i = 0;
1122   1          
1123   1          switch(phase) {
1124   2              case 0:     // closing
1125   2                      aux = (5 * (220 - g_meas.curr[0])) << g_mem.res[0];
1126   2                      g_refNew.pos[0] = g_refOld.pos[0] - aux;
1127   2                      
1128   2                      aux = (5 * (220 + g_meas.curr[1])) << g_mem.res[1];
1129   2                      g_refNew.pos[1] = g_refOld.pos[1] + aux;
1130   2                                      
1131   2                      if (phase_counter >= 10 && dev_tension <= 0) {
1132   3                          pretensioning_flag = FALSE;
1133   3                          g_refNew.pos[0] = 0;
1134   3                          g_refNew.pos[1] = 0;
1135   3                      }
1136   2                      
1137   2                      phase_counter = phase_counter + 1;
1138   2                                     
1139   2                      if ( (g_meas.curr[0] > 220-epsilon ) && (g_meas.curr[1] < -220+epsilon )){
1140   3                          phase = 1;
1141   3                          phase_counter = 0;
1142   3                          //g_refNew.pos[0] = g_meas.pos[0];
1143   3                          //g_refNew.pos[1] = g_meas.pos[1];
1144   3                      }
1145   2                      break;
1146   2              case 1:     // releasing
1147   2                      
1148   2                      aux = 16 << g_mem.res[0];
1149   2                      g_refNew.pos[0] = g_refOld.pos[0] + aux;
1150   2                      
1151   2                      aux = 16 << g_mem.res[1];
1152   2                      g_refNew.pos[1] = g_refOld.pos[1] - aux;
1153   2                          
1154   2                      if (phase_counter > 80){//((g_meas.curr[0] > -10) && (g_meas.curr[1] < 10)){
1155   3                          pretensioning_flag = FALSE;
1156   3                          pret_done = TRUE;
1157   3                          phase = 0;
1158   3                          reset_last_value_flag = 1;
1159   3                          for (i = 0; i< NUM_OF_SENSORS; i++) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 20  

1160   4                             pret_offset_pos[i] = g_refNew.pos[i];  // con questo comando funziona sicuramente
1161   4                             /*encoder_reading(i, TRUE);
1162   4                             g_mem.m_off[i] = -g_meas.pos[i];
1163   4                             g_meas.rot[i] = 0;*/
1164   4                              
1165   4                            // g_refNew.pos[i] = 0;//<<g_mem.res[i];
1166   4                             
1167   4                          }
1168   3                          
1169   3                          //memStore(0);
1170   3                         
1171   3      
1172   3                          
1173   3                       /*   g_refOld.pos[0] = 0;
1174   3                          g_refOld.pos[1] = 0;
1175   3                          g_ref.pos[0] = 0;
1176   3                          g_ref.pos[1] = 0;
1177   3                          
1178   3                         */
1179   3                      }
1180   2                      
1181   2                      phase_counter = phase_counter + 1;
1182   2                      break;
1183   2              default:
1184   2                      break;
1185   2          }    
1186   1      }
1187          
1188          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 21  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 165
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 167
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 177
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 179
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 212
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 218
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0027
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0027
                                           ; SOURCE LINE # 222
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 224
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 607F              JZ      ?C0015
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0022
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0025
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 226
0033         ?C0006:
                                           ; SOURCE LINE # 228
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 229
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 230
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 233
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 22  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 234
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 235
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 236
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 237
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 238
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 239
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 242
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 243
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 246
0069         ?C0010:
                                           ; SOURCE LINE # 249
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 6022              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 601E              JZ      ?C0012
0075 900000      E     MOV     DPTR,#c_mem+081H
0078 E0                MOVX    A,@DPTR
0079 B5001B            CJNE    A,rx_data,?C0011
007C 900000      E     MOV     DPTR,#c_mem+06FH
007F E0                MOVX    A,@DPTR
0080 6401              XRL     A,#01H
0082 600F              JZ      ?C0012
0084 900000      E     MOV     DPTR,#c_mem+078H
0087 E0                MOVX    A,@DPTR
0088 6401              XRL     A,#01H
008A 6007              JZ      ?C0012
008C 900000      E     MOV     DPTR,#c_mem+082H
008F E0                MOVX    A,@DPTR
0090 B40104            CJNE    A,#01H,?C0011
0093         ?C0012:
                                           ; SOURCE LINE # 250
0093 C200        R     CLR     rx_data_type
0095 8002              SJMP    ?C0014
0097         ?C0011:
                                           ; SOURCE LINE # 252
0097 D200        R     SETB    rx_data_type
0099         ?C0014:
                                           ; SOURCE LINE # 254
0099 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 23  

009A F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 255
009C 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 256
009F 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 259
00A2         ?C0015:
                                           ; SOURCE LINE # 262
00A2 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 264
00A5 E500        R     MOV     A,data_packet_length
00A7 D3                SETB    C
00A8 9401              SUBB    A,#01H
00AA 5008              JNC     ?C0016
                                           ; SOURCE LINE # 265
00AC E4                CLR     A
00AD F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 266
00AF F500        R     MOV     state,A
                                           ; SOURCE LINE # 267
00B1 020000      R     LJMP    ?C0003
00B4         ?C0016:
00B4 E500        R     MOV     A,data_packet_length
00B6 D3                SETB    C
00B7 9480              SUBB    A,#080H
00B9 4008              JC      ?C0018
                                           ; SOURCE LINE # 268
00BB E4                CLR     A
00BC F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 269
00BE F500        R     MOV     state,A
                                           ; SOURCE LINE # 270
00C0 020000      R     LJMP    ?C0003
00C3         ?C0018:
                                           ; SOURCE LINE # 271
00C3 E4                CLR     A
00C4 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 273
00C6 200006            JB      rx_data_type,?C0020
                                           ; SOURCE LINE # 274
00C9 750003      R     MOV     state,#03H
00CC 020000      R     LJMP    ?C0003
00CF         ?C0020:
                                           ; SOURCE LINE # 276
00CF 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
00D2 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 281
00D5         ?C0022:
                                           ; SOURCE LINE # 283
00D5 7400        R     MOV     A,#LOW data_packet_buffer
00D7 2500        R     ADD     A,data_packet_index
00D9 F582              MOV     DPL,A
00DB E4                CLR     A
00DC 3400        R     ADDC    A,#HIGH data_packet_buffer
00DE F583              MOV     DPH,A
00E0 E500        R     MOV     A,rx_data
00E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 284
00E3 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 287
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 24  

00E5 E500        R     MOV     A,data_packet_index
00E7 C3                CLR     C
00E8 9500        R     SUBB    A,data_packet_length
00EA 5003              JNC     $ + 5H
00EC 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 289
00EF 200025            JB      rx_data_type,?C0024
                                           ; SOURCE LINE # 291
00F2 AF00        R     MOV     R7,data_packet_length
00F4 7E00              MOV     R6,#00H
00F6 7800        E     MOV     R0,#LOW g_rx
00F8 7C00        E     MOV     R4,#HIGH g_rx
00FA 7D01              MOV     R5,#01H
00FC 7B01              MOV     R3,#01H
00FE 7A00        R     MOV     R2,#HIGH data_packet_buffer
0100 7900        R     MOV     R1,#LOW data_packet_buffer
0102 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 292
0105 900000      E     MOV     DPTR,#g_rx+080H
0108 E4                CLR     A
0109 F0                MOVX    @DPTR,A
010A A3                INC     DPTR
010B E500        R     MOV     A,data_packet_length
010D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
010E 900000      E     MOV     DPTR,#g_rx+084H
0111 7401              MOV     A,#01H
0113 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 294
0114 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 295
0117         ?C0024:
                                           ; SOURCE LINE # 297
0117 E4                CLR     A
0118 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 298
011A F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 299
011C F500        R     MOV     state,A
                                           ; SOURCE LINE # 300
011E 0500        R     INC     package_count
                                           ; SOURCE LINE # 302
                                           ; SOURCE LINE # 303
0120 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 306
0123         ?C0025:
                                           ; SOURCE LINE # 307
0123 1500        R     DEC     data_packet_length
0125 E500        R     MOV     A,data_packet_length
0127 6003              JZ      $ + 5H
0129 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 308
012C F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 309
012E F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 310
0130 7F01              MOV     R7,#01H
0132 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 311
0135 E4                CLR     A
0136 FF                MOV     R7,A
0137 120000      E     LCALL   _RS485_CTS_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 25  

                                           ; SOURCE LINE # 312
013A E4                CLR     A
013B F500        R     MOV     state,A
                                           ; SOURCE LINE # 313
013D 0500        R     INC     package_count
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 315
013F 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 316
                                           ; SOURCE LINE # 317
0142 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 318
0145         ?C0027:
0145 22                RET     
             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 334
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 336
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 340
000E 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 341
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 342
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 343
0016         ?C0028:
                                           ; SOURCE LINE # 347
0016 E4                CLR     A
0017 FD                MOV     R5,A
0018 FF                MOV     R7,A
0019 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 351
001C 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 352
001F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 353
0021 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 354
0024         ?C0029:
                                           ; SOURCE LINE # 356
0024 E4                CLR     A
0025 FD                MOV     R5,A
0026 7F01              MOV     R7,#01H
0028 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 360
002B 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 361
002E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 362
0030 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 363
0033         ?C0030:
                                           ; SOURCE LINE # 376
0033 E4                CLR     A
0034 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 26  

0035 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 380
0038 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 381
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 382
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 383
0040         ?C0031:
                                           ; SOURCE LINE # 385
0040 7F01              MOV     R7,#01H
0042 120000      R     LCALL   _motor_control
                                           ; SOURCE LINE # 389
0045 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 390
0048 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 391
004A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 392
004D         ?C0032:
                                           ; SOURCE LINE # 396
004D 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 416
0050 300026            JNB     pretensioning_flag,?C0033
                                           ; SOURCE LINE # 417
0053 900000      R     MOV     DPTR,#counter_calibration
0056 E0                MOVX    A,@DPTR
0057 7004              JNZ     ?C0196
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B 6464              XRL     A,#064H
005D         ?C0196:
005D 700A              JNZ     ?C0034
                                           ; SOURCE LINE # 418
005F 120000      R     LCALL   pretensioning_process
                                           ; SOURCE LINE # 419
0062 E4                CLR     A
0063 900000      R     MOV     DPTR,#counter_calibration
0066 F0                MOVX    @DPTR,A
0067 A3                INC     DPTR
0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 420
0069         ?C0034:
                                           ; SOURCE LINE # 421
0069 900000      R     MOV     DPTR,#counter_calibration+01H
006C E0                MOVX    A,@DPTR
006D 04                INC     A
006E F0                MOVX    @DPTR,A
006F 7006              JNZ     ?C0197
0071 900000      R     MOV     DPTR,#counter_calibration
0074 E0                MOVX    A,@DPTR
0075 04                INC     A
0076 F0                MOVX    @DPTR,A
0077         ?C0197:
                                           ; SOURCE LINE # 422
0077 8012              SJMP    ?C0035
0079         ?C0033:
                                           ; SOURCE LINE # 423
0079 300003            JNB     cuff_flag_force,?C0036
                                           ; SOURCE LINE # 424
007C 120000      E     LCALL   drive_cuff
007F         ?C0036:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 27  

                                           ; SOURCE LINE # 426
007F 300003            JNB     cuff_flag_proprio,?C0037
                                           ; SOURCE LINE # 427
0082 120000      E     LCALL   slide_cuff
0085         ?C0037:
                                           ; SOURCE LINE # 429
0085 300003            JNB     cuff_flag_force_proprio,?C0035
                                           ; SOURCE LINE # 430
0088 120000      E     LCALL   force_and_slide_cuff
                                           ; SOURCE LINE # 431
008B         ?C0035:
                                           ; SOURCE LINE # 433
008B 300005            JNB     interrupt_flag,?C0039
                                           ; SOURCE LINE # 434
008E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 435
0090 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 436
0093         ?C0039:
                                           ; SOURCE LINE # 442
0093 7800        E     MOV     R0,#LOW g_measOld
0095 7C00        E     MOV     R4,#HIGH g_measOld
0097 7D01              MOV     R5,#01H
0099 7B01              MOV     R3,#01H
009B 7A00        E     MOV     R2,#HIGH g_meas
009D 7900        E     MOV     R1,#LOW g_meas
009F 7E00              MOV     R6,#00H
00A1 7F1F              MOV     R7,#01FH
00A3 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 443
00A6 7800        E     MOV     R0,#LOW g_refOld
00A8 7C00        E     MOV     R4,#HIGH g_refOld
00AA 7D01              MOV     R5,#01H
00AC 7B01              MOV     R3,#01H
00AE 7A00        E     MOV     R2,#HIGH g_ref
00B0 7900        E     MOV     R1,#LOW g_ref
00B2 7E00              MOV     R6,#00H
00B4 7F09              MOV     R7,#09H
00B6 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 446
00B9 7800        E     MOV     R0,#LOW g_ref
00BB 7C00        E     MOV     R4,#HIGH g_ref
00BD 7D01              MOV     R5,#01H
00BF 7B01              MOV     R3,#01H
00C1 7A00        E     MOV     R2,#HIGH g_refNew
00C3 7900        E     MOV     R1,#LOW g_refNew
00C5 7E00              MOV     R6,#00H
00C7 7F09              MOV     R7,#09H
00C9 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 448
00CC 300005            JNB     interrupt_flag,?C0040
                                           ; SOURCE LINE # 449
00CF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 450
00D1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 451
00D4         ?C0040:
                                           ; SOURCE LINE # 455
00D4 120000      E     LCALL   MY_TIMER_ReadCounter
00D7 900000      E     MOV     DPTR,#timer_value
00DA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 456
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 28  

00DD 7F40              MOV     R7,#040H
00DF 7E4B              MOV     R6,#04BH
00E1 7D4C              MOV     R5,#04CH
00E3 7C00              MOV     R4,#00H
00E5 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 458
00E8 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION _motor_control (BEGIN)
                                           ; SOURCE LINE # 465
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 467
0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 471
0002 E4                CLR     A
0003 F500        R     MOV     pwm_input+03H,A
0005 F500        R     MOV     pwm_input+02H,A
0007 F500        R     MOV     pwm_input+01H,A
0009 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 477
000B 900000      E     MOV     DPTR,#c_mem+02H
000E E0                MOVX    A,@DPTR
000F FC                MOV     R4,A
0010 A3                INC     DPTR
0011 E0                MOVX    A,@DPTR
0012 FD                MOV     R5,A
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FE                MOV     R6,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F500        R     MOV     k_p+03H,A
001A 8E00        R     MOV     k_p+02H,R6
001C 8D00        R     MOV     k_p+01H,R5
001E 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 478
0020 A3                INC     DPTR
0021 E0                MOVX    A,@DPTR
0022 FC                MOV     R4,A
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 FD                MOV     R5,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FE                MOV     R6,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B F500        R     MOV     k_i+03H,A
002D 8E00        R     MOV     k_i+02H,R6
002F 8D00        R     MOV     k_i+01H,R5
0031 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 479
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FC                MOV     R4,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 FD                MOV     R5,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 29  

003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E F500        R     MOV     k_d+03H,A
0040 8E00        R     MOV     k_d+02H,R6
0042 8D00        R     MOV     k_d+01H,R5
0044 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 481
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FC                MOV     R4,A
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B FD                MOV     R5,A
004C A3                INC     DPTR
004D E0                MOVX    A,@DPTR
004E FE                MOV     R6,A
004F A3                INC     DPTR
0050 E0                MOVX    A,@DPTR
0051 F500        R     MOV     k_p_c+03H,A
0053 8E00        R     MOV     k_p_c+02H,R6
0055 8D00        R     MOV     k_p_c+01H,R5
0057 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 482
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FC                MOV     R4,A
005C A3                INC     DPTR
005D E0                MOVX    A,@DPTR
005E FD                MOV     R5,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FE                MOV     R6,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 F500        R     MOV     k_i_c+03H,A
0066 8E00        R     MOV     k_i_c+02H,R6
0068 8D00        R     MOV     k_i_c+01H,R5
006A 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 483
006C A3                INC     DPTR
006D E0                MOVX    A,@DPTR
006E FC                MOV     R4,A
006F A3                INC     DPTR
0070 E0                MOVX    A,@DPTR
0071 FD                MOV     R5,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 FE                MOV     R6,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 F500        R     MOV     k_d_c+03H,A
0079 8E00        R     MOV     k_d_c+02H,R6
007B 8D00        R     MOV     k_d_c+01H,R5
007D 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 485
007F A3                INC     DPTR
0080 E0                MOVX    A,@DPTR
0081 FC                MOV     R4,A
0082 A3                INC     DPTR
0083 E0                MOVX    A,@DPTR
0084 FD                MOV     R5,A
0085 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 30  

0086 E0                MOVX    A,@DPTR
0087 FE                MOV     R6,A
0088 A3                INC     DPTR
0089 E0                MOVX    A,@DPTR
008A F500        R     MOV     k_p_dl+03H,A
008C 8E00        R     MOV     k_p_dl+02H,R6
008E 8D00        R     MOV     k_p_dl+01H,R5
0090 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 486
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 FC                MOV     R4,A
0095 A3                INC     DPTR
0096 E0                MOVX    A,@DPTR
0097 FD                MOV     R5,A
0098 A3                INC     DPTR
0099 E0                MOVX    A,@DPTR
009A FE                MOV     R6,A
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D F500        R     MOV     k_i_dl+03H,A
009F 8E00        R     MOV     k_i_dl+02H,R6
00A1 8D00        R     MOV     k_i_dl+01H,R5
00A3 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 487
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 FC                MOV     R4,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FD                MOV     R5,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FE                MOV     R6,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 F500        R     MOV     k_d_dl+03H,A
00B2 8E00        R     MOV     k_d_dl+02H,R6
00B4 8D00        R     MOV     k_d_dl+01H,R5
00B6 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 489
00B8 A3                INC     DPTR
00B9 E0                MOVX    A,@DPTR
00BA FC                MOV     R4,A
00BB A3                INC     DPTR
00BC E0                MOVX    A,@DPTR
00BD FD                MOV     R5,A
00BE A3                INC     DPTR
00BF E0                MOVX    A,@DPTR
00C0 FE                MOV     R6,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 F500        R     MOV     k_p_c_dl+03H,A
00C5 8E00        R     MOV     k_p_c_dl+02H,R6
00C7 8D00        R     MOV     k_p_c_dl+01H,R5
00C9 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 490
00CB A3                INC     DPTR
00CC E0                MOVX    A,@DPTR
00CD FC                MOV     R4,A
00CE A3                INC     DPTR
00CF E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 31  

00D0 FD                MOV     R5,A
00D1 A3                INC     DPTR
00D2 E0                MOVX    A,@DPTR
00D3 FE                MOV     R6,A
00D4 A3                INC     DPTR
00D5 E0                MOVX    A,@DPTR
00D6 F500        R     MOV     k_i_c_dl+03H,A
00D8 8E00        R     MOV     k_i_c_dl+02H,R6
00DA 8D00        R     MOV     k_i_c_dl+01H,R5
00DC 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 491
00DE A3                INC     DPTR
00DF E0                MOVX    A,@DPTR
00E0 FC                MOV     R4,A
00E1 A3                INC     DPTR
00E2 E0                MOVX    A,@DPTR
00E3 FD                MOV     R5,A
00E4 A3                INC     DPTR
00E5 E0                MOVX    A,@DPTR
00E6 FE                MOV     R6,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 F500        R     MOV     k_d_c_dl+03H,A
00EB 8E00        R     MOV     k_d_c_dl+02H,R6
00ED 8D00        R     MOV     k_d_c_dl+01H,R5
00EF 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 503
00F1 E500        R     MOV     A,index
00F3 C3                CLR     C
00F4 9402              SUBB    A,#02H
00F6 4003              JC      $ + 5H
00F8 020000      R     LJMP    ?C0043
00FB         ?C0042:
                                           ; SOURCE LINE # 506
00FB 900000      E     MOV     DPTR,#c_mem+036H
00FE E0                MOVX    A,@DPTR
00FF 14                DEC     A
0100 7003              JNZ     $ + 5H
0102 020000      R     LJMP    ?C0108
0105 14                DEC     A
0106 7003              JNZ     $ + 5H
0108 020000      R     LJMP    ?C0093
010B 14                DEC     A
010C 7003              JNZ     $ + 5H
010E 020000      R     LJMP    ?C0065
0111 2403              ADD     A,#03H
0113 6003              JZ      $ + 5H
0115 020000      R     LJMP    ?C0044
                                           ; SOURCE LINE # 507
0118         ?C0045:
                                           ; SOURCE LINE # 518
0118 E500        R     MOV     A,index
011A 25E0              ADD     A,ACC
011C 25E0              ADD     A,ACC
011E 2400        E     ADD     A,#LOW g_meas
0120 F582              MOV     DPL,A
0122 E4                CLR     A
0123 3400        E     ADDC    A,#HIGH g_meas
0125 F583              MOV     DPH,A
0127 E0                MOVX    A,@DPTR
0128 F8                MOV     R0,A
0129 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 32  

012A E0                MOVX    A,@DPTR
012B F9                MOV     R1,A
012C A3                INC     DPTR
012D E0                MOVX    A,@DPTR
012E FA                MOV     R2,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FB                MOV     R3,A
0132 E500        R     MOV     A,index
0134 25E0              ADD     A,ACC
0136 25E0              ADD     A,ACC
0138 2400        E     ADD     A,#LOW g_ref
013A F582              MOV     DPL,A
013C E4                CLR     A
013D 3400        E     ADDC    A,#HIGH g_ref
013F F583              MOV     DPH,A
0141 E0                MOVX    A,@DPTR
0142 FC                MOV     R4,A
0143 A3                INC     DPTR
0144 E0                MOVX    A,@DPTR
0145 FD                MOV     R5,A
0146 A3                INC     DPTR
0147 E0                MOVX    A,@DPTR
0148 FE                MOV     R6,A
0149 A3                INC     DPTR
014A E0                MOVX    A,@DPTR
014B C3                CLR     C
014C 9B                SUBB    A,R3
014D F500        R     MOV     pos_error+03H,A
014F EE                MOV     A,R6
0150 9A                SUBB    A,R2
0151 F500        R     MOV     pos_error+02H,A
0153 ED                MOV     A,R5
0154 99                SUBB    A,R1
0155 F500        R     MOV     pos_error+01H,A
0157 EC                MOV     A,R4
0158 98                SUBB    A,R0
0159 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 520
015B 300005            JNB     interrupt_flag,?C0046
                                           ; SOURCE LINE # 521
015E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 522
0160 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 523
0163         ?C0046:
                                           ; SOURCE LINE # 526
0163 E500        R     MOV     A,index
0165 25E0              ADD     A,ACC
0167 25E0              ADD     A,ACC
0169 2400        R     ADD     A,#LOW pos_error_sum
016B F582              MOV     DPL,A
016D E4                CLR     A
016E 3400        R     ADDC    A,#HIGH pos_error_sum
0170 F583              MOV     DPH,A
0172 C083              PUSH    DPH
0174 C082              PUSH    DPL
0176 E0                MOVX    A,@DPTR
0177 FC                MOV     R4,A
0178 A3                INC     DPTR
0179 E0                MOVX    A,@DPTR
017A FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 33  

017B A3                INC     DPTR
017C E0                MOVX    A,@DPTR
017D FE                MOV     R6,A
017E A3                INC     DPTR
017F E0                MOVX    A,@DPTR
0180 2500        R     ADD     A,pos_error+03H
0182 FF                MOV     R7,A
0183 EE                MOV     A,R6
0184 3500        R     ADDC    A,pos_error+02H
0186 FE                MOV     R6,A
0187 ED                MOV     A,R5
0188 3500        R     ADDC    A,pos_error+01H
018A FD                MOV     R5,A
018B EC                MOV     A,R4
018C 3500        R     ADDC    A,pos_error
018E FC                MOV     R4,A
018F D082              POP     DPL
0191 D083              POP     DPH
0193 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 529
0196 E500        R     MOV     A,index
0198 25E0              ADD     A,ACC
019A 25E0              ADD     A,ACC
019C 2400        R     ADD     A,#LOW pos_error_sum
019E F582              MOV     DPL,A
01A0 E4                CLR     A
01A1 3400        R     ADDC    A,#HIGH pos_error_sum
01A3 F583              MOV     DPH,A
01A5 E0                MOVX    A,@DPTR
01A6 FC                MOV     R4,A
01A7 A3                INC     DPTR
01A8 E0                MOVX    A,@DPTR
01A9 FD                MOV     R5,A
01AA A3                INC     DPTR
01AB E0                MOVX    A,@DPTR
01AC FE                MOV     R6,A
01AD A3                INC     DPTR
01AE E0                MOVX    A,@DPTR
01AF FF                MOV     R7,A
01B0 7BA0              MOV     R3,#0A0H
01B2 7A86              MOV     R2,#086H
01B4 7901              MOV     R1,#01H
01B6 7800              MOV     R0,#00H
01B8 C3                CLR     C
01B9 120000      E     LCALL   ?C?SLCMP
01BC 501C              JNC     ?C0047
                                           ; SOURCE LINE # 530
01BE 7FA0              MOV     R7,#0A0H
01C0 7E86              MOV     R6,#086H
01C2 7D01              MOV     R5,#01H
01C4 7C00              MOV     R4,#00H
01C6 E500        R     MOV     A,index
01C8 25E0              ADD     A,ACC
01CA 25E0              ADD     A,ACC
01CC 2400        R     ADD     A,#LOW pos_error_sum
01CE F582              MOV     DPL,A
01D0 E4                CLR     A
01D1 3400        R     ADDC    A,#HIGH pos_error_sum
01D3 F583              MOV     DPH,A
01D5 120000      E     LCALL   ?C?LSTXDATA
01D8 8042              SJMP    ?C0048
01DA         ?C0047:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 34  

                                           ; SOURCE LINE # 531
                                           ; SOURCE LINE # 532
01DA E500        R     MOV     A,index
01DC 25E0              ADD     A,ACC
01DE 25E0              ADD     A,ACC
01E0 2400        R     ADD     A,#LOW pos_error_sum
01E2 F582              MOV     DPL,A
01E4 E4                CLR     A
01E5 3400        R     ADDC    A,#HIGH pos_error_sum
01E7 F583              MOV     DPH,A
01E9 E0                MOVX    A,@DPTR
01EA FC                MOV     R4,A
01EB A3                INC     DPTR
01EC E0                MOVX    A,@DPTR
01ED FD                MOV     R5,A
01EE A3                INC     DPTR
01EF E0                MOVX    A,@DPTR
01F0 FE                MOV     R6,A
01F1 A3                INC     DPTR
01F2 E0                MOVX    A,@DPTR
01F3 FF                MOV     R7,A
01F4 7B60              MOV     R3,#060H
01F6 7A79              MOV     R2,#079H
01F8 79FE              MOV     R1,#0FEH
01FA 78FF              MOV     R0,#0FFH
01FC D3                SETB    C
01FD 120000      E     LCALL   ?C?SLCMP
0200 401A              JC      ?C0048
                                           ; SOURCE LINE # 533
0202 7F60              MOV     R7,#060H
0204 7E79              MOV     R6,#079H
0206 7DFE              MOV     R5,#0FEH
0208 7CFF              MOV     R4,#0FFH
020A E500        R     MOV     A,index
020C 25E0              ADD     A,ACC
020E 25E0              ADD     A,ACC
0210 2400        R     ADD     A,#LOW pos_error_sum
0212 F582              MOV     DPL,A
0214 E4                CLR     A
0215 3400        R     ADDC    A,#HIGH pos_error_sum
0217 F583              MOV     DPH,A
0219 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 534
021C         ?C0048:
                                           ; SOURCE LINE # 536
021C 300005            JNB     interrupt_flag,?C0050
                                           ; SOURCE LINE # 537
021F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 538
0221 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 539
0224         ?C0050:
                                           ; SOURCE LINE # 541
0224 E4                CLR     A
0225 F500        R     MOV     pwm_input+03H,A
0227 F500        R     MOV     pwm_input+02H,A
0229 F500        R     MOV     pwm_input+01H,A
022B F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 543
022D FF                MOV     R7,A
022E FE                MOV     R6,A
022F FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 35  

0230 FC                MOV     R4,A
0231 AB00        R     MOV     R3,k_p+03H
0233 AA00        R     MOV     R2,k_p+02H
0235 A900        R     MOV     R1,k_p+01H
0237 A800        R     MOV     R0,k_p
0239 C3                CLR     C
023A 120000      E     LCALL   ?C?SLCMP
023D 606A              JZ      ?C0051
                                           ; SOURCE LINE # 545
023F E4                CLR     A
0240 FF                MOV     R7,A
0241 FE                MOV     R6,A
0242 7D02              MOV     R5,#02H
0244 FC                MOV     R4,A
0245 AB00        R     MOV     R3,pos_error+03H
0247 AA00        R     MOV     R2,pos_error+02H
0249 A900        R     MOV     R1,pos_error+01H
024B A800        R     MOV     R0,pos_error
024D D3                SETB    C
024E 120000      E     LCALL   ?C?SLCMP
0251 500F              JNC     ?C0053
0253 E4                CLR     A
0254 FF                MOV     R7,A
0255 FE                MOV     R6,A
0256 7DFE              MOV     R5,#0FEH
0258 7CFF              MOV     R4,#0FFH
025A A800        R     MOV     R0,pos_error
025C C3                CLR     C
025D 120000      E     LCALL   ?C?SLCMP
0260 5027              JNC     ?C0052
0262         ?C0053:
                                           ; SOURCE LINE # 546
0262 AF00        R     MOV     R7,pos_error+03H
0264 AE00        R     MOV     R6,pos_error+02H
0266 AD00        R     MOV     R5,pos_error+01H
0268 AC00        R     MOV     R4,pos_error
026A 7808              MOV     R0,#08H
026C 120000      E     LCALL   ?C?SLSHR
026F AB00        R     MOV     R3,k_p+03H
0271 AA00        R     MOV     R2,k_p+02H
0273 A900        R     MOV     R1,k_p+01H
0275 A800        R     MOV     R0,k_p
0277 120000      E     LCALL   ?C?LMUL
027A 7808              MOV     R0,#08H
027C 120000      E     LCALL   ?C?SLSHR
027F 8F00        R     MOV     pwm_input+03H,R7
0281 8E00        R     MOV     pwm_input+02H,R6
0283 8D00        R     MOV     pwm_input+01H,R5
0285 8C00        R     MOV     pwm_input,R4
0287 8020              SJMP    ?C0051
0289         ?C0052:
                                           ; SOURCE LINE # 548
0289 AF00        R     MOV     R7,pos_error+03H
028B AE00        R     MOV     R6,pos_error+02H
028D AD00        R     MOV     R5,pos_error+01H
028F AC00        R     MOV     R4,pos_error
0291 AB00        R     MOV     R3,k_p+03H
0293 AA00        R     MOV     R2,k_p+02H
0295 A900        R     MOV     R1,k_p+01H
0297 A800        R     MOV     R0,k_p
0299 120000      E     LCALL   ?C?LMUL
029C 7810              MOV     R0,#010H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 36  

029E 120000      E     LCALL   ?C?SLSHR
02A1 8F00        R     MOV     pwm_input+03H,R7
02A3 8E00        R     MOV     pwm_input+02H,R6
02A5 8D00        R     MOV     pwm_input+01H,R5
02A7 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 549
02A9         ?C0051:
                                           ; SOURCE LINE # 551
02A9 300005            JNB     interrupt_flag,?C0055
                                           ; SOURCE LINE # 552
02AC C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 553
02AE 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 554
02B1         ?C0055:
                                           ; SOURCE LINE # 557
02B1 E4                CLR     A
02B2 FF                MOV     R7,A
02B3 FE                MOV     R6,A
02B4 FD                MOV     R5,A
02B5 FC                MOV     R4,A
02B6 AB00        R     MOV     R3,k_i+03H
02B8 AA00        R     MOV     R2,k_i+02H
02BA A900        R     MOV     R1,k_i+01H
02BC A800        R     MOV     R0,k_i
02BE C3                CLR     C
02BF 120000      E     LCALL   ?C?SLCMP
02C2 6043              JZ      ?C0056
                                           ; SOURCE LINE # 558
02C4 AF00        R     MOV     R7,k_i+03H
02C6 AE00        R     MOV     R6,k_i+02H
02C8 AD00        R     MOV     R5,k_i+01H
02CA AC00        R     MOV     R4,k_i
02CC 7806              MOV     R0,#06H
02CE 120000      E     LCALL   ?C?SLSHR
02D1 E500        R     MOV     A,index
02D3 25E0              ADD     A,ACC
02D5 25E0              ADD     A,ACC
02D7 2400        R     ADD     A,#LOW pos_error_sum
02D9 F582              MOV     DPL,A
02DB E4                CLR     A
02DC 3400        R     ADDC    A,#HIGH pos_error_sum
02DE F583              MOV     DPH,A
02E0 E0                MOVX    A,@DPTR
02E1 F8                MOV     R0,A
02E2 A3                INC     DPTR
02E3 E0                MOVX    A,@DPTR
02E4 F9                MOV     R1,A
02E5 A3                INC     DPTR
02E6 E0                MOVX    A,@DPTR
02E7 FA                MOV     R2,A
02E8 A3                INC     DPTR
02E9 E0                MOVX    A,@DPTR
02EA FB                MOV     R3,A
02EB 120000      E     LCALL   ?C?LMUL
02EE 780A              MOV     R0,#0AH
02F0 120000      E     LCALL   ?C?SLSHR
02F3 E500        R     MOV     A,pwm_input+03H
02F5 2F                ADD     A,R7
02F6 F500        R     MOV     pwm_input+03H,A
02F8 E500        R     MOV     A,pwm_input+02H
02FA 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 37  

02FB F500        R     MOV     pwm_input+02H,A
02FD E500        R     MOV     A,pwm_input+01H
02FF 3D                ADDC    A,R5
0300 F500        R     MOV     pwm_input+01H,A
0302 E500        R     MOV     A,pwm_input
0304 3C                ADDC    A,R4
0305 F500        R     MOV     pwm_input,A
0307         ?C0056:
                                           ; SOURCE LINE # 561
0307 E4                CLR     A
0308 FF                MOV     R7,A
0309 FE                MOV     R6,A
030A FD                MOV     R5,A
030B FC                MOV     R4,A
030C AB00        R     MOV     R3,k_d+03H
030E AA00        R     MOV     R2,k_d+02H
0310 A900        R     MOV     R1,k_d+01H
0312 A800        R     MOV     R0,k_d
0314 C3                CLR     C
0315 120000      E     LCALL   ?C?SLCMP
0318 6063              JZ      ?C0057
                                           ; SOURCE LINE # 562
031A E500        R     MOV     A,index
031C 25E0              ADD     A,ACC
031E 25E0              ADD     A,ACC
0320 2400        E     ADD     A,#LOW g_meas
0322 F582              MOV     DPL,A
0324 E4                CLR     A
0325 3400        E     ADDC    A,#HIGH g_meas
0327 F583              MOV     DPH,A
0329 E0                MOVX    A,@DPTR
032A F8                MOV     R0,A
032B A3                INC     DPTR
032C E0                MOVX    A,@DPTR
032D F9                MOV     R1,A
032E A3                INC     DPTR
032F E0                MOVX    A,@DPTR
0330 FA                MOV     R2,A
0331 A3                INC     DPTR
0332 E0                MOVX    A,@DPTR
0333 FB                MOV     R3,A
0334 E500        R     MOV     A,index
0336 25E0              ADD     A,ACC
0338 25E0              ADD     A,ACC
033A 2400        E     ADD     A,#LOW g_measOld
033C F582              MOV     DPL,A
033E E4                CLR     A
033F 3400        E     ADDC    A,#HIGH g_measOld
0341 F583              MOV     DPH,A
0343 E0                MOVX    A,@DPTR
0344 FC                MOV     R4,A
0345 A3                INC     DPTR
0346 E0                MOVX    A,@DPTR
0347 FD                MOV     R5,A
0348 A3                INC     DPTR
0349 E0                MOVX    A,@DPTR
034A FE                MOV     R6,A
034B A3                INC     DPTR
034C E0                MOVX    A,@DPTR
034D C3                CLR     C
034E 9B                SUBB    A,R3
034F FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 38  

0350 EE                MOV     A,R6
0351 9A                SUBB    A,R2
0352 FE                MOV     R6,A
0353 ED                MOV     A,R5
0354 99                SUBB    A,R1
0355 FD                MOV     R5,A
0356 EC                MOV     A,R4
0357 98                SUBB    A,R0
0358 FC                MOV     R4,A
0359 AB00        R     MOV     R3,k_d+03H
035B AA00        R     MOV     R2,k_d+02H
035D A900        R     MOV     R1,k_d+01H
035F A800        R     MOV     R0,k_d
0361 120000      E     LCALL   ?C?LMUL
0364 7810              MOV     R0,#010H
0366 120000      E     LCALL   ?C?SLSHR
0369 E500        R     MOV     A,pwm_input+03H
036B 2F                ADD     A,R7
036C F500        R     MOV     pwm_input+03H,A
036E E500        R     MOV     A,pwm_input+02H
0370 3E                ADDC    A,R6
0371 F500        R     MOV     pwm_input+02H,A
0373 E500        R     MOV     A,pwm_input+01H
0375 3D                ADDC    A,R5
0376 F500        R     MOV     pwm_input+01H,A
0378 E500        R     MOV     A,pwm_input
037A 3C                ADDC    A,R4
037B F500        R     MOV     pwm_input,A
037D         ?C0057:
                                           ; SOURCE LINE # 565
037D 300005            JNB     interrupt_flag,?C0058
                                           ; SOURCE LINE # 566
0380 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 567
0382 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 568
0385         ?C0058:
                                           ; SOURCE LINE # 573
0385 E500        R     MOV     A,index
0387 701C              JNZ     ?C0059
                                           ; SOURCE LINE # 574
0389 FF                MOV     R7,A
038A FE                MOV     R6,A
038B FD                MOV     R5,A
038C FC                MOV     R4,A
038D AB00        R     MOV     R3,pwm_input+03H
038F AA00        R     MOV     R2,pwm_input+02H
0391 A900        R     MOV     R1,pwm_input+01H
0393 A800        R     MOV     R0,pwm_input
0395 C3                CLR     C
0396 120000      E     LCALL   ?C?SLCMP
0399 4005              JC      ?C0060
                                           ; SOURCE LINE # 575
039B D200        R     SETB    dirM0
039D 020000      R     LJMP    ?C0044
03A0         ?C0060:
                                           ; SOURCE LINE # 578
03A0 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 580
03A2 020000      R     LJMP    ?C0044
03A5         ?C0059:
                                           ; SOURCE LINE # 581
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 39  

03A5 E4                CLR     A
03A6 FF                MOV     R7,A
03A7 FE                MOV     R6,A
03A8 FD                MOV     R5,A
03A9 FC                MOV     R4,A
03AA AB00        R     MOV     R3,pwm_input+03H
03AC AA00        R     MOV     R2,pwm_input+02H
03AE A900        R     MOV     R1,pwm_input+01H
03B0 A800        R     MOV     R0,pwm_input
03B2 C3                CLR     C
03B3 120000      E     LCALL   ?C?SLCMP
03B6 4005              JC      ?C0063
                                           ; SOURCE LINE # 582
03B8 D200        R     SETB    dirM1
03BA 020000      R     LJMP    ?C0044
03BD         ?C0063:
                                           ; SOURCE LINE # 585
03BD C200        R     CLR     dirM1
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 589
03BF 020000      R     LJMP    ?C0044
                                           ; SOURCE LINE # 591
03C2         ?C0065:
                                           ; SOURCE LINE # 601
03C2 E500        R     MOV     A,index
03C4 25E0              ADD     A,ACC
03C6 25E0              ADD     A,ACC
03C8 2400        E     ADD     A,#LOW g_meas
03CA F582              MOV     DPL,A
03CC E4                CLR     A
03CD 3400        E     ADDC    A,#HIGH g_meas
03CF F583              MOV     DPH,A
03D1 E0                MOVX    A,@DPTR
03D2 F8                MOV     R0,A
03D3 A3                INC     DPTR
03D4 E0                MOVX    A,@DPTR
03D5 F9                MOV     R1,A
03D6 A3                INC     DPTR
03D7 E0                MOVX    A,@DPTR
03D8 FA                MOV     R2,A
03D9 A3                INC     DPTR
03DA E0                MOVX    A,@DPTR
03DB FB                MOV     R3,A
03DC E500        R     MOV     A,index
03DE 25E0              ADD     A,ACC
03E0 25E0              ADD     A,ACC
03E2 2400        E     ADD     A,#LOW g_ref
03E4 F582              MOV     DPL,A
03E6 E4                CLR     A
03E7 3400        E     ADDC    A,#HIGH g_ref
03E9 F583              MOV     DPH,A
03EB E0                MOVX    A,@DPTR
03EC FC                MOV     R4,A
03ED A3                INC     DPTR
03EE E0                MOVX    A,@DPTR
03EF FD                MOV     R5,A
03F0 A3                INC     DPTR
03F1 E0                MOVX    A,@DPTR
03F2 FE                MOV     R6,A
03F3 A3                INC     DPTR
03F4 E0                MOVX    A,@DPTR
03F5 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 40  

03F6 9B                SUBB    A,R3
03F7 F500        R     MOV     pos_error+03H,A
03F9 EE                MOV     A,R6
03FA 9A                SUBB    A,R2
03FB F500        R     MOV     pos_error+02H,A
03FD ED                MOV     A,R5
03FE 99                SUBB    A,R1
03FF F500        R     MOV     pos_error+01H,A
0401 EC                MOV     A,R4
0402 98                SUBB    A,R0
0403 F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 603
0405 E500        R     MOV     A,index
0407 25E0              ADD     A,ACC
0409 25E0              ADD     A,ACC
040B 2400        R     ADD     A,#LOW pos_error_sum
040D F582              MOV     DPL,A
040F E4                CLR     A
0410 3400        R     ADDC    A,#HIGH pos_error_sum
0412 F583              MOV     DPH,A
0414 C083              PUSH    DPH
0416 C082              PUSH    DPL
0418 E0                MOVX    A,@DPTR
0419 FC                MOV     R4,A
041A A3                INC     DPTR
041B E0                MOVX    A,@DPTR
041C FD                MOV     R5,A
041D A3                INC     DPTR
041E E0                MOVX    A,@DPTR
041F FE                MOV     R6,A
0420 A3                INC     DPTR
0421 E0                MOVX    A,@DPTR
0422 2500        R     ADD     A,pos_error+03H
0424 FF                MOV     R7,A
0425 EE                MOV     A,R6
0426 3500        R     ADDC    A,pos_error+02H
0428 FE                MOV     R6,A
0429 ED                MOV     A,R5
042A 3500        R     ADDC    A,pos_error+01H
042C FD                MOV     R5,A
042D EC                MOV     A,R4
042E 3500        R     ADDC    A,pos_error
0430 FC                MOV     R4,A
0431 D082              POP     DPL
0433 D083              POP     DPH
0435 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 605
0438 300005            JNB     interrupt_flag,?C0066
                                           ; SOURCE LINE # 606
043B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 607
043D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 608
0440         ?C0066:
                                           ; SOURCE LINE # 611
0440 E500        R     MOV     A,index
0442 25E0              ADD     A,ACC
0444 25E0              ADD     A,ACC
0446 2400        R     ADD     A,#LOW pos_error_sum
0448 F582              MOV     DPL,A
044A E4                CLR     A
044B 3400        R     ADDC    A,#HIGH pos_error_sum
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 41  

044D F583              MOV     DPH,A
044F E0                MOVX    A,@DPTR
0450 FC                MOV     R4,A
0451 A3                INC     DPTR
0452 E0                MOVX    A,@DPTR
0453 FD                MOV     R5,A
0454 A3                INC     DPTR
0455 E0                MOVX    A,@DPTR
0456 FE                MOV     R6,A
0457 A3                INC     DPTR
0458 E0                MOVX    A,@DPTR
0459 FF                MOV     R7,A
045A 7BA0              MOV     R3,#0A0H
045C 7A86              MOV     R2,#086H
045E 7901              MOV     R1,#01H
0460 7800              MOV     R0,#00H
0462 C3                CLR     C
0463 120000      E     LCALL   ?C?SLCMP
0466 501C              JNC     ?C0067
                                           ; SOURCE LINE # 612
0468 7FA0              MOV     R7,#0A0H
046A 7E86              MOV     R6,#086H
046C 7D01              MOV     R5,#01H
046E 7C00              MOV     R4,#00H
0470 E500        R     MOV     A,index
0472 25E0              ADD     A,ACC
0474 25E0              ADD     A,ACC
0476 2400        R     ADD     A,#LOW pos_error_sum
0478 F582              MOV     DPL,A
047A E4                CLR     A
047B 3400        R     ADDC    A,#HIGH pos_error_sum
047D F583              MOV     DPH,A
047F 120000      E     LCALL   ?C?LSTXDATA
0482 8042              SJMP    ?C0068
0484         ?C0067:
                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 614
0484 E500        R     MOV     A,index
0486 25E0              ADD     A,ACC
0488 25E0              ADD     A,ACC
048A 2400        R     ADD     A,#LOW pos_error_sum
048C F582              MOV     DPL,A
048E E4                CLR     A
048F 3400        R     ADDC    A,#HIGH pos_error_sum
0491 F583              MOV     DPH,A
0493 E0                MOVX    A,@DPTR
0494 FC                MOV     R4,A
0495 A3                INC     DPTR
0496 E0                MOVX    A,@DPTR
0497 FD                MOV     R5,A
0498 A3                INC     DPTR
0499 E0                MOVX    A,@DPTR
049A FE                MOV     R6,A
049B A3                INC     DPTR
049C E0                MOVX    A,@DPTR
049D FF                MOV     R7,A
049E 7B60              MOV     R3,#060H
04A0 7A79              MOV     R2,#079H
04A2 79FE              MOV     R1,#0FEH
04A4 78FF              MOV     R0,#0FFH
04A6 D3                SETB    C
04A7 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 42  

04AA 401A              JC      ?C0068
                                           ; SOURCE LINE # 615
04AC 7F60              MOV     R7,#060H
04AE 7E79              MOV     R6,#079H
04B0 7DFE              MOV     R5,#0FEH
04B2 7CFF              MOV     R4,#0FFH
04B4 E500        R     MOV     A,index
04B6 25E0              ADD     A,ACC
04B8 25E0              ADD     A,ACC
04BA 2400        R     ADD     A,#LOW pos_error_sum
04BC F582              MOV     DPL,A
04BE E4                CLR     A
04BF 3400        R     ADDC    A,#HIGH pos_error_sum
04C1 F583              MOV     DPH,A
04C3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 616
04C6         ?C0068:
                                           ; SOURCE LINE # 619
04C6 E4                CLR     A
04C7 F500        R     MOV     curr_ref+03H,A
04C9 F500        R     MOV     curr_ref+02H,A
04CB F500        R     MOV     curr_ref+01H,A
04CD F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 621
04CF 300005            JNB     interrupt_flag,?C0070
                                           ; SOURCE LINE # 622
04D2 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 623
04D4 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 624
04D7         ?C0070:
                                           ; SOURCE LINE # 627
04D7 E4                CLR     A
04D8 FF                MOV     R7,A
04D9 FE                MOV     R6,A
04DA FD                MOV     R5,A
04DB FC                MOV     R4,A
04DC AB00        R     MOV     R3,k_p_dl+03H
04DE AA00        R     MOV     R2,k_p_dl+02H
04E0 A900        R     MOV     R1,k_p_dl+01H
04E2 A800        R     MOV     R0,k_p_dl
04E4 C3                CLR     C
04E5 120000      E     LCALL   ?C?SLCMP
04E8 6026              JZ      ?C0071
                                           ; SOURCE LINE # 628
04EA AF00        R     MOV     R7,pos_error+03H
04EC AE00        R     MOV     R6,pos_error+02H
04EE AD00        R     MOV     R5,pos_error+01H
04F0 AC00        R     MOV     R4,pos_error
04F2 A800        R     MOV     R0,k_p_dl
04F4 120000      E     LCALL   ?C?LMUL
04F7 7810              MOV     R0,#010H
04F9 120000      E     LCALL   ?C?SLSHR
04FC E500        R     MOV     A,curr_ref+03H
04FE 2F                ADD     A,R7
04FF F500        R     MOV     curr_ref+03H,A
0501 E500        R     MOV     A,curr_ref+02H
0503 3E                ADDC    A,R6
0504 F500        R     MOV     curr_ref+02H,A
0506 E500        R     MOV     A,curr_ref+01H
0508 3D                ADDC    A,R5
0509 F500        R     MOV     curr_ref+01H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 43  

050B E500        R     MOV     A,curr_ref
050D 3C                ADDC    A,R4
050E F500        R     MOV     curr_ref,A
0510         ?C0071:
                                           ; SOURCE LINE # 631
0510 E4                CLR     A
0511 FF                MOV     R7,A
0512 FE                MOV     R6,A
0513 FD                MOV     R5,A
0514 FC                MOV     R4,A
0515 AB00        R     MOV     R3,k_i_dl+03H
0517 AA00        R     MOV     R2,k_i_dl+02H
0519 A900        R     MOV     R1,k_i_dl+01H
051B A800        R     MOV     R0,k_i_dl
051D C3                CLR     C
051E 120000      E     LCALL   ?C?SLCMP
0521 6038              JZ      ?C0072
                                           ; SOURCE LINE # 632
0523 E500        R     MOV     A,index
0525 25E0              ADD     A,ACC
0527 25E0              ADD     A,ACC
0529 2400        R     ADD     A,#LOW pos_error_sum
052B F582              MOV     DPL,A
052D E4                CLR     A
052E 3400        R     ADDC    A,#HIGH pos_error_sum
0530 F583              MOV     DPH,A
0532 E0                MOVX    A,@DPTR
0533 FC                MOV     R4,A
0534 A3                INC     DPTR
0535 E0                MOVX    A,@DPTR
0536 FD                MOV     R5,A
0537 A3                INC     DPTR
0538 E0                MOVX    A,@DPTR
0539 FE                MOV     R6,A
053A A3                INC     DPTR
053B E0                MOVX    A,@DPTR
053C FF                MOV     R7,A
053D A800        R     MOV     R0,k_i_dl
053F 120000      E     LCALL   ?C?LMUL
0542 7810              MOV     R0,#010H
0544 120000      E     LCALL   ?C?SLSHR
0547 E500        R     MOV     A,curr_ref+03H
0549 2F                ADD     A,R7
054A F500        R     MOV     curr_ref+03H,A
054C E500        R     MOV     A,curr_ref+02H
054E 3E                ADDC    A,R6
054F F500        R     MOV     curr_ref+02H,A
0551 E500        R     MOV     A,curr_ref+01H
0553 3D                ADDC    A,R5
0554 F500        R     MOV     curr_ref+01H,A
0556 E500        R     MOV     A,curr_ref
0558 3C                ADDC    A,R4
0559 F500        R     MOV     curr_ref,A
055B         ?C0072:
                                           ; SOURCE LINE # 635
055B E4                CLR     A
055C FF                MOV     R7,A
055D FE                MOV     R6,A
055E FD                MOV     R5,A
055F FC                MOV     R4,A
0560 AB00        R     MOV     R3,k_d_dl+03H
0562 AA00        R     MOV     R2,k_d_dl+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 44  

0564 A900        R     MOV     R1,k_d_dl+01H
0566 A800        R     MOV     R0,k_d_dl
0568 C3                CLR     C
0569 120000      E     LCALL   ?C?SLCMP
056C 6063              JZ      ?C0073
                                           ; SOURCE LINE # 636
056E E500        R     MOV     A,index
0570 25E0              ADD     A,ACC
0572 25E0              ADD     A,ACC
0574 2400        E     ADD     A,#LOW g_meas
0576 F582              MOV     DPL,A
0578 E4                CLR     A
0579 3400        E     ADDC    A,#HIGH g_meas
057B F583              MOV     DPH,A
057D E0                MOVX    A,@DPTR
057E F8                MOV     R0,A
057F A3                INC     DPTR
0580 E0                MOVX    A,@DPTR
0581 F9                MOV     R1,A
0582 A3                INC     DPTR
0583 E0                MOVX    A,@DPTR
0584 FA                MOV     R2,A
0585 A3                INC     DPTR
0586 E0                MOVX    A,@DPTR
0587 FB                MOV     R3,A
0588 E500        R     MOV     A,index
058A 25E0              ADD     A,ACC
058C 25E0              ADD     A,ACC
058E 2400        E     ADD     A,#LOW g_measOld
0590 F582              MOV     DPL,A
0592 E4                CLR     A
0593 3400        E     ADDC    A,#HIGH g_measOld
0595 F583              MOV     DPH,A
0597 E0                MOVX    A,@DPTR
0598 FC                MOV     R4,A
0599 A3                INC     DPTR
059A E0                MOVX    A,@DPTR
059B FD                MOV     R5,A
059C A3                INC     DPTR
059D E0                MOVX    A,@DPTR
059E FE                MOV     R6,A
059F A3                INC     DPTR
05A0 E0                MOVX    A,@DPTR
05A1 C3                CLR     C
05A2 9B                SUBB    A,R3
05A3 FF                MOV     R7,A
05A4 EE                MOV     A,R6
05A5 9A                SUBB    A,R2
05A6 FE                MOV     R6,A
05A7 ED                MOV     A,R5
05A8 99                SUBB    A,R1
05A9 FD                MOV     R5,A
05AA EC                MOV     A,R4
05AB 98                SUBB    A,R0
05AC FC                MOV     R4,A
05AD AB00        R     MOV     R3,k_d_dl+03H
05AF AA00        R     MOV     R2,k_d_dl+02H
05B1 A900        R     MOV     R1,k_d_dl+01H
05B3 A800        R     MOV     R0,k_d_dl
05B5 120000      E     LCALL   ?C?LMUL
05B8 7810              MOV     R0,#010H
05BA 120000      E     LCALL   ?C?SLSHR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 45  

05BD E500        R     MOV     A,curr_ref+03H
05BF 2F                ADD     A,R7
05C0 F500        R     MOV     curr_ref+03H,A
05C2 E500        R     MOV     A,curr_ref+02H
05C4 3E                ADDC    A,R6
05C5 F500        R     MOV     curr_ref+02H,A
05C7 E500        R     MOV     A,curr_ref+01H
05C9 3D                ADDC    A,R5
05CA F500        R     MOV     curr_ref+01H,A
05CC E500        R     MOV     A,curr_ref
05CE 3C                ADDC    A,R4
05CF F500        R     MOV     curr_ref,A
05D1         ?C0073:
                                           ; SOURCE LINE # 638
05D1 300005            JNB     interrupt_flag,?C0074
                                           ; SOURCE LINE # 639
05D4 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 640
05D6 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 641
05D9         ?C0074:
                                           ; SOURCE LINE # 644
05D9 900000      E     MOV     DPTR,#c_mem+032H
05DC E0                MOVX    A,@DPTR
05DD FE                MOV     R6,A
05DE A3                INC     DPTR
05DF E0                MOVX    A,@DPTR
05E0 FF                MOV     R7,A
05E1 EE                MOV     A,R6
05E2 33                RLC     A
05E3 95E0              SUBB    A,ACC
05E5 FD                MOV     R5,A
05E6 FC                MOV     R4,A
05E7 AB00        R     MOV     R3,curr_ref+03H
05E9 AA00        R     MOV     R2,curr_ref+02H
05EB A900        R     MOV     R1,curr_ref+01H
05ED A800        R     MOV     R0,curr_ref
05EF D3                SETB    C
05F0 120000      E     LCALL   ?C?SLCMP
05F3 4016              JC      ?C0075
                                           ; SOURCE LINE # 645
05F5 900000      E     MOV     DPTR,#c_mem+032H
05F8 E0                MOVX    A,@DPTR
05F9 FE                MOV     R6,A
05FA A3                INC     DPTR
05FB E0                MOVX    A,@DPTR
05FC FF                MOV     R7,A
05FD EE                MOV     A,R6
05FE 33                RLC     A
05FF 95E0              SUBB    A,ACC
0601 8F00        R     MOV     curr_ref+03H,R7
0603 8E00        R     MOV     curr_ref+02H,R6
0605 F500        R     MOV     curr_ref+01H,A
0607 F500        R     MOV     curr_ref,A
0609 803C              SJMP    ?C0076
060B         ?C0075:
                                           ; SOURCE LINE # 646
                                           ; SOURCE LINE # 647
060B 900000      E     MOV     DPTR,#c_mem+032H
060E E0                MOVX    A,@DPTR
060F FE                MOV     R6,A
0610 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 46  

0611 E0                MOVX    A,@DPTR
0612 FF                MOV     R7,A
0613 C3                CLR     C
0614 E4                CLR     A
0615 9F                SUBB    A,R7
0616 FF                MOV     R7,A
0617 E4                CLR     A
0618 9E                SUBB    A,R6
0619 FE                MOV     R6,A
061A 33                RLC     A
061B 95E0              SUBB    A,ACC
061D FD                MOV     R5,A
061E FC                MOV     R4,A
061F AB00        R     MOV     R3,curr_ref+03H
0621 AA00        R     MOV     R2,curr_ref+02H
0623 A900        R     MOV     R1,curr_ref+01H
0625 A800        R     MOV     R0,curr_ref
0627 C3                CLR     C
0628 120000      E     LCALL   ?C?SLCMP
062B 501A              JNC     ?C0076
                                           ; SOURCE LINE # 648
062D 900000      E     MOV     DPTR,#c_mem+032H
0630 E0                MOVX    A,@DPTR
0631 FE                MOV     R6,A
0632 A3                INC     DPTR
0633 E0                MOVX    A,@DPTR
0634 FF                MOV     R7,A
0635 C3                CLR     C
0636 E4                CLR     A
0637 9F                SUBB    A,R7
0638 FF                MOV     R7,A
0639 E4                CLR     A
063A 9E                SUBB    A,R6
063B FE                MOV     R6,A
063C 33                RLC     A
063D 95E0              SUBB    A,ACC
063F 8F00        R     MOV     curr_ref+03H,R7
0641 8E00        R     MOV     curr_ref+02H,R6
0643 F500        R     MOV     curr_ref+01H,A
0645 F500        R     MOV     curr_ref,A
                                           ; SOURCE LINE # 649
0647         ?C0076:
                                           ; SOURCE LINE # 651
0647 300005            JNB     interrupt_flag,?C0078
                                           ; SOURCE LINE # 652
064A C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 653
064C 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 654
064F         ?C0078:
                                           ; SOURCE LINE # 657
064F E500        R     MOV     A,index
0651 25E0              ADD     A,ACC
0653 2400        E     ADD     A,#LOW g_meas+0CH
0655 F582              MOV     DPL,A
0657 E4                CLR     A
0658 3400        E     ADDC    A,#HIGH g_meas+0CH
065A F583              MOV     DPH,A
065C E0                MOVX    A,@DPTR
065D FE                MOV     R6,A
065E A3                INC     DPTR
065F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 47  

0660 FF                MOV     R7,A
0661 FB                MOV     R3,A
0662 AA06              MOV     R2,AR6
0664 EA                MOV     A,R2
0665 33                RLC     A
0666 95E0              SUBB    A,ACC
0668 F9                MOV     R1,A
0669 F8                MOV     R0,A
066A C3                CLR     C
066B E500        R     MOV     A,curr_ref+03H
066D 9B                SUBB    A,R3
066E F500        R     MOV     curr_error+03H,A
0670 E500        R     MOV     A,curr_ref+02H
0672 9A                SUBB    A,R2
0673 F500        R     MOV     curr_error+02H,A
0675 E500        R     MOV     A,curr_ref+01H
0677 99                SUBB    A,R1
0678 F500        R     MOV     curr_error+01H,A
067A E500        R     MOV     A,curr_ref
067C 98                SUBB    A,R0
067D F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 659
067F E500        R     MOV     A,index
0681 25E0              ADD     A,ACC
0683 25E0              ADD     A,ACC
0685 2400        R     ADD     A,#LOW curr_error_sum
0687 F582              MOV     DPL,A
0689 E4                CLR     A
068A 3400        R     ADDC    A,#HIGH curr_error_sum
068C F583              MOV     DPH,A
068E C083              PUSH    DPH
0690 C082              PUSH    DPL
0692 E0                MOVX    A,@DPTR
0693 FC                MOV     R4,A
0694 A3                INC     DPTR
0695 E0                MOVX    A,@DPTR
0696 FD                MOV     R5,A
0697 A3                INC     DPTR
0698 E0                MOVX    A,@DPTR
0699 FE                MOV     R6,A
069A A3                INC     DPTR
069B E0                MOVX    A,@DPTR
069C 2500        R     ADD     A,curr_error+03H
069E FF                MOV     R7,A
069F EE                MOV     A,R6
06A0 3500        R     ADDC    A,curr_error+02H
06A2 FE                MOV     R6,A
06A3 ED                MOV     A,R5
06A4 3500        R     ADDC    A,curr_error+01H
06A6 FD                MOV     R5,A
06A7 EC                MOV     A,R4
06A8 3500        R     ADDC    A,curr_error
06AA FC                MOV     R4,A
06AB D082              POP     DPL
06AD D083              POP     DPH
06AF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 661
06B2 E500        R     MOV     A,index
06B4 25E0              ADD     A,ACC
06B6 25E0              ADD     A,ACC
06B8 2400        R     ADD     A,#LOW curr_error_sum
06BA F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 48  

06BC E4                CLR     A
06BD 3400        R     ADDC    A,#HIGH curr_error_sum
06BF F583              MOV     DPH,A
06C1 E0                MOVX    A,@DPTR
06C2 FC                MOV     R4,A
06C3 A3                INC     DPTR
06C4 E0                MOVX    A,@DPTR
06C5 FD                MOV     R5,A
06C6 A3                INC     DPTR
06C7 E0                MOVX    A,@DPTR
06C8 FE                MOV     R6,A
06C9 A3                INC     DPTR
06CA E0                MOVX    A,@DPTR
06CB FF                MOV     R7,A
06CC 7BA0              MOV     R3,#0A0H
06CE 7A86              MOV     R2,#086H
06D0 7901              MOV     R1,#01H
06D2 7800              MOV     R0,#00H
06D4 C3                CLR     C
06D5 120000      E     LCALL   ?C?SLCMP
06D8 501C              JNC     ?C0079
                                           ; SOURCE LINE # 662
06DA 7FA0              MOV     R7,#0A0H
06DC 7E86              MOV     R6,#086H
06DE 7D01              MOV     R5,#01H
06E0 7C00              MOV     R4,#00H
06E2 E500        R     MOV     A,index
06E4 25E0              ADD     A,ACC
06E6 25E0              ADD     A,ACC
06E8 2400        R     ADD     A,#LOW curr_error_sum
06EA F582              MOV     DPL,A
06EC E4                CLR     A
06ED 3400        R     ADDC    A,#HIGH curr_error_sum
06EF F583              MOV     DPH,A
06F1 120000      E     LCALL   ?C?LSTXDATA
06F4 8042              SJMP    ?C0080
06F6         ?C0079:
                                           ; SOURCE LINE # 663
                                           ; SOURCE LINE # 664
06F6 E500        R     MOV     A,index
06F8 25E0              ADD     A,ACC
06FA 25E0              ADD     A,ACC
06FC 2400        R     ADD     A,#LOW curr_error_sum
06FE F582              MOV     DPL,A
0700 E4                CLR     A
0701 3400        R     ADDC    A,#HIGH curr_error_sum
0703 F583              MOV     DPH,A
0705 E0                MOVX    A,@DPTR
0706 FC                MOV     R4,A
0707 A3                INC     DPTR
0708 E0                MOVX    A,@DPTR
0709 FD                MOV     R5,A
070A A3                INC     DPTR
070B E0                MOVX    A,@DPTR
070C FE                MOV     R6,A
070D A3                INC     DPTR
070E E0                MOVX    A,@DPTR
070F FF                MOV     R7,A
0710 7B60              MOV     R3,#060H
0712 7A79              MOV     R2,#079H
0714 79FE              MOV     R1,#0FEH
0716 78FF              MOV     R0,#0FFH
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 49  

0718 D3                SETB    C
0719 120000      E     LCALL   ?C?SLCMP
071C 401A              JC      ?C0080
                                           ; SOURCE LINE # 665
071E 7F60              MOV     R7,#060H
0720 7E79              MOV     R6,#079H
0722 7DFE              MOV     R5,#0FEH
0724 7CFF              MOV     R4,#0FFH
0726 E500        R     MOV     A,index
0728 25E0              ADD     A,ACC
072A 25E0              ADD     A,ACC
072C 2400        R     ADD     A,#LOW curr_error_sum
072E F582              MOV     DPL,A
0730 E4                CLR     A
0731 3400        R     ADDC    A,#HIGH curr_error_sum
0733 F583              MOV     DPH,A
0735 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 666
0738         ?C0080:
                                           ; SOURCE LINE # 668
0738 300005            JNB     interrupt_flag,?C0082
                                           ; SOURCE LINE # 669
073B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 670
073D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 671
0740         ?C0082:
                                           ; SOURCE LINE # 675
0740 E4                CLR     A
0741 F500        R     MOV     pwm_input+03H,A
0743 F500        R     MOV     pwm_input+02H,A
0745 F500        R     MOV     pwm_input+01H,A
0747 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 678
0749 FF                MOV     R7,A
074A FE                MOV     R6,A
074B FD                MOV     R5,A
074C FC                MOV     R4,A
074D AB00        R     MOV     R3,k_p_c_dl+03H
074F AA00        R     MOV     R2,k_p_c_dl+02H
0751 A900        R     MOV     R1,k_p_c_dl+01H
0753 A800        R     MOV     R0,k_p_c_dl
0755 C3                CLR     C
0756 120000      E     LCALL   ?C?SLCMP
0759 6026              JZ      ?C0083
                                           ; SOURCE LINE # 679
075B AF00        R     MOV     R7,curr_error+03H
075D AE00        R     MOV     R6,curr_error+02H
075F AD00        R     MOV     R5,curr_error+01H
0761 AC00        R     MOV     R4,curr_error
0763 A800        R     MOV     R0,k_p_c_dl
0765 120000      E     LCALL   ?C?LMUL
0768 7810              MOV     R0,#010H
076A 120000      E     LCALL   ?C?SLSHR
076D E500        R     MOV     A,pwm_input+03H
076F 2F                ADD     A,R7
0770 F500        R     MOV     pwm_input+03H,A
0772 E500        R     MOV     A,pwm_input+02H
0774 3E                ADDC    A,R6
0775 F500        R     MOV     pwm_input+02H,A
0777 E500        R     MOV     A,pwm_input+01H
0779 3D                ADDC    A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 50  

077A F500        R     MOV     pwm_input+01H,A
077C E500        R     MOV     A,pwm_input
077E 3C                ADDC    A,R4
077F F500        R     MOV     pwm_input,A
0781         ?C0083:
                                           ; SOURCE LINE # 682
0781 E4                CLR     A
0782 FF                MOV     R7,A
0783 FE                MOV     R6,A
0784 FD                MOV     R5,A
0785 FC                MOV     R4,A
0786 AB00        R     MOV     R3,k_i_c_dl+03H
0788 AA00        R     MOV     R2,k_i_c_dl+02H
078A A900        R     MOV     R1,k_i_c_dl+01H
078C A800        R     MOV     R0,k_i_c_dl
078E C3                CLR     C
078F 120000      E     LCALL   ?C?SLCMP
0792 6038              JZ      ?C0084
                                           ; SOURCE LINE # 683
0794 E500        R     MOV     A,index
0796 25E0              ADD     A,ACC
0798 25E0              ADD     A,ACC
079A 2400        R     ADD     A,#LOW curr_error_sum
079C F582              MOV     DPL,A
079E E4                CLR     A
079F 3400        R     ADDC    A,#HIGH curr_error_sum
07A1 F583              MOV     DPH,A
07A3 E0                MOVX    A,@DPTR
07A4 FC                MOV     R4,A
07A5 A3                INC     DPTR
07A6 E0                MOVX    A,@DPTR
07A7 FD                MOV     R5,A
07A8 A3                INC     DPTR
07A9 E0                MOVX    A,@DPTR
07AA FE                MOV     R6,A
07AB A3                INC     DPTR
07AC E0                MOVX    A,@DPTR
07AD FF                MOV     R7,A
07AE A800        R     MOV     R0,k_i_c_dl
07B0 120000      E     LCALL   ?C?LMUL
07B3 7810              MOV     R0,#010H
07B5 120000      E     LCALL   ?C?SLSHR
07B8 E500        R     MOV     A,pwm_input+03H
07BA 2F                ADD     A,R7
07BB F500        R     MOV     pwm_input+03H,A
07BD E500        R     MOV     A,pwm_input+02H
07BF 3E                ADDC    A,R6
07C0 F500        R     MOV     pwm_input+02H,A
07C2 E500        R     MOV     A,pwm_input+01H
07C4 3D                ADDC    A,R5
07C5 F500        R     MOV     pwm_input+01H,A
07C7 E500        R     MOV     A,pwm_input
07C9 3C                ADDC    A,R4
07CA F500        R     MOV     pwm_input,A
07CC         ?C0084:
                                           ; SOURCE LINE # 686
07CC E4                CLR     A
07CD FF                MOV     R7,A
07CE FE                MOV     R6,A
07CF FD                MOV     R5,A
07D0 FC                MOV     R4,A
07D1 AB00        R     MOV     R3,k_d_c_dl+03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 51  

07D3 AA00        R     MOV     R2,k_d_c_dl+02H
07D5 A900        R     MOV     R1,k_d_c_dl+01H
07D7 A800        R     MOV     R0,k_d_c_dl
07D9 C3                CLR     C
07DA 120000      E     LCALL   ?C?SLCMP
07DD 6064              JZ      ?C0085
                                           ; SOURCE LINE # 687
07DF E500        R     MOV     A,index
07E1 25E0              ADD     A,ACC
07E3 2400        E     ADD     A,#LOW g_meas+0CH
07E5 F582              MOV     DPL,A
07E7 E4                CLR     A
07E8 3400        E     ADDC    A,#HIGH g_meas+0CH
07EA F583              MOV     DPH,A
07EC E0                MOVX    A,@DPTR
07ED FE                MOV     R6,A
07EE A3                INC     DPTR
07EF E0                MOVX    A,@DPTR
07F0 FF                MOV     R7,A
07F1 FB                MOV     R3,A
07F2 AA06              MOV     R2,AR6
07F4 EA                MOV     A,R2
07F5 33                RLC     A
07F6 95E0              SUBB    A,ACC
07F8 F9                MOV     R1,A
07F9 F8                MOV     R0,A
07FA E500        R     MOV     A,index
07FC 25E0              ADD     A,ACC
07FE 25E0              ADD     A,ACC
0800 2400        R     ADD     A,#LOW prev_curr
0802 F582              MOV     DPL,A
0804 E4                CLR     A
0805 3400        R     ADDC    A,#HIGH prev_curr
0807 F583              MOV     DPH,A
0809 E0                MOVX    A,@DPTR
080A FC                MOV     R4,A
080B A3                INC     DPTR
080C E0                MOVX    A,@DPTR
080D FD                MOV     R5,A
080E A3                INC     DPTR
080F E0                MOVX    A,@DPTR
0810 FE                MOV     R6,A
0811 A3                INC     DPTR
0812 E0                MOVX    A,@DPTR
0813 C3                CLR     C
0814 9B                SUBB    A,R3
0815 FF                MOV     R7,A
0816 EE                MOV     A,R6
0817 9A                SUBB    A,R2
0818 FE                MOV     R6,A
0819 ED                MOV     A,R5
081A 99                SUBB    A,R1
081B FD                MOV     R5,A
081C EC                MOV     A,R4
081D 98                SUBB    A,R0
081E FC                MOV     R4,A
081F AB00        R     MOV     R3,k_d_c_dl+03H
0821 AA00        R     MOV     R2,k_d_c_dl+02H
0823 A900        R     MOV     R1,k_d_c_dl+01H
0825 A800        R     MOV     R0,k_d_c_dl
0827 120000      E     LCALL   ?C?LMUL
082A 7810              MOV     R0,#010H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 52  

082C 120000      E     LCALL   ?C?SLSHR
082F E500        R     MOV     A,pwm_input+03H
0831 2F                ADD     A,R7
0832 F500        R     MOV     pwm_input+03H,A
0834 E500        R     MOV     A,pwm_input+02H
0836 3E                ADDC    A,R6
0837 F500        R     MOV     pwm_input+02H,A
0839 E500        R     MOV     A,pwm_input+01H
083B 3D                ADDC    A,R5
083C F500        R     MOV     pwm_input+01H,A
083E E500        R     MOV     A,pwm_input
0840 3C                ADDC    A,R4
0841 F500        R     MOV     pwm_input,A
0843         ?C0085:
                                           ; SOURCE LINE # 690
0843 E500        R     MOV     A,index
0845 25E0              ADD     A,ACC
0847 2400        E     ADD     A,#LOW g_meas+0CH
0849 F582              MOV     DPL,A
084B E4                CLR     A
084C 3400        E     ADDC    A,#HIGH g_meas+0CH
084E F583              MOV     DPH,A
0850 E0                MOVX    A,@DPTR
0851 FE                MOV     R6,A
0852 A3                INC     DPTR
0853 E0                MOVX    A,@DPTR
0854 FF                MOV     R7,A
0855 EE                MOV     A,R6
0856 33                RLC     A
0857 95E0              SUBB    A,ACC
0859 FD                MOV     R5,A
085A FC                MOV     R4,A
085B E500        R     MOV     A,index
085D 25E0              ADD     A,ACC
085F 25E0              ADD     A,ACC
0861 2400        R     ADD     A,#LOW prev_curr
0863 F582              MOV     DPL,A
0865 E4                CLR     A
0866 3400        R     ADDC    A,#HIGH prev_curr
0868 F583              MOV     DPH,A
086A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 692
086D 300005            JNB     interrupt_flag,?C0086
                                           ; SOURCE LINE # 693
0870 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 694
0872 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 695
0875         ?C0086:
                                           ; SOURCE LINE # 697
0875 E500        R     MOV     A,index
0877 701C              JNZ     ?C0087
                                           ; SOURCE LINE # 698
0879 FF                MOV     R7,A
087A FE                MOV     R6,A
087B FD                MOV     R5,A
087C FC                MOV     R4,A
087D AB00        R     MOV     R3,pwm_input+03H
087F AA00        R     MOV     R2,pwm_input+02H
0881 A900        R     MOV     R1,pwm_input+01H
0883 A800        R     MOV     R0,pwm_input
0885 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 53  

0886 120000      E     LCALL   ?C?SLCMP
0889 4005              JC      ?C0088
                                           ; SOURCE LINE # 699
088B D200        R     SETB    dirM0
088D 020000      R     LJMP    ?C0044
0890         ?C0088:
                                           ; SOURCE LINE # 702
0890 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 704
0892 020000      R     LJMP    ?C0044
0895         ?C0087:
                                           ; SOURCE LINE # 705
0895 E4                CLR     A
0896 FF                MOV     R7,A
0897 FE                MOV     R6,A
0898 FD                MOV     R5,A
0899 FC                MOV     R4,A
089A AB00        R     MOV     R3,pwm_input+03H
089C AA00        R     MOV     R2,pwm_input+02H
089E A900        R     MOV     R1,pwm_input+01H
08A0 A800        R     MOV     R0,pwm_input
08A2 C3                CLR     C
08A3 120000      E     LCALL   ?C?SLCMP
08A6 4005              JC      ?C0091
                                           ; SOURCE LINE # 706
08A8 D200        R     SETB    dirM1
08AA 020000      R     LJMP    ?C0044
08AD         ?C0091:
                                           ; SOURCE LINE # 709
08AD C200        R     CLR     dirM1
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 713
08AF 020000      R     LJMP    ?C0044
                                           ; SOURCE LINE # 715
08B2         ?C0093:
                                           ; SOURCE LINE # 718
08B2 E500        R     MOV     A,index
08B4 25E0              ADD     A,ACC
08B6 25E0              ADD     A,ACC
08B8 2400        E     ADD     A,#LOW g_ref
08BA F582              MOV     DPL,A
08BC E4                CLR     A
08BD 3400        E     ADDC    A,#HIGH g_ref
08BF F583              MOV     DPH,A
08C1 E0                MOVX    A,@DPTR
08C2 FC                MOV     R4,A
08C3 A3                INC     DPTR
08C4 E0                MOVX    A,@DPTR
08C5 FD                MOV     R5,A
08C6 A3                INC     DPTR
08C7 E0                MOVX    A,@DPTR
08C8 FE                MOV     R6,A
08C9 A3                INC     DPTR
08CA E0                MOVX    A,@DPTR
08CB FF                MOV     R7,A
08CC 7400        E     MOV     A,#LOW g_mem+037H
08CE 2500        R     ADD     A,index
08D0 F582              MOV     DPL,A
08D2 E4                CLR     A
08D3 3400        E     ADDC    A,#HIGH g_mem+037H
08D5 F583              MOV     DPH,A
08D7 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 54  

08D8 F9                MOV     R1,A
08D9 F8                MOV     R0,A
08DA 120000      E     LCALL   ?C?SLSHR
08DD 8F00        R     MOV     curr_ref+03H,R7
08DF 8E00        R     MOV     curr_ref+02H,R6
08E1 8D00        R     MOV     curr_ref+01H,R5
08E3 8C00        R     MOV     curr_ref,R4
                                           ; SOURCE LINE # 721
08E5 900000      E     MOV     DPTR,#c_mem+032H
08E8 E0                MOVX    A,@DPTR
08E9 FE                MOV     R6,A
08EA A3                INC     DPTR
08EB E0                MOVX    A,@DPTR
08EC FF                MOV     R7,A
08ED EE                MOV     A,R6
08EE 33                RLC     A
08EF 95E0              SUBB    A,ACC
08F1 FD                MOV     R5,A
08F2 FC                MOV     R4,A
08F3 AB00        R     MOV     R3,curr_ref+03H
08F5 AA00        R     MOV     R2,curr_ref+02H
08F7 A900        R     MOV     R1,curr_ref+01H
08F9 A800        R     MOV     R0,curr_ref
08FB D3                SETB    C
08FC 120000      E     LCALL   ?C?SLCMP
08FF 4014              JC      ?C0094
                                           ; SOURCE LINE # 722
0901 900000      E     MOV     DPTR,#c_mem+032H
0904 E0                MOVX    A,@DPTR
0905 FE                MOV     R6,A
0906 A3                INC     DPTR
0907 E0                MOVX    A,@DPTR
0908 FF                MOV     R7,A
0909 EE                MOV     A,R6
090A 33                RLC     A
090B 95E0              SUBB    A,ACC
090D 8F00        R     MOV     curr_ref+03H,R7
090F 8E00        R     MOV     curr_ref+02H,R6
0911 F500        R     MOV     curr_ref+01H,A
0913 F500        R     MOV     curr_ref,A
0915         ?C0094:
                                           ; SOURCE LINE # 725
0915 AE00        R     MOV     R6,curr_ref+02H
0917 AF00        R     MOV     R7,curr_ref+03H
0919 120000      E     LCALL   _abs
091C E500        R     MOV     A,index
091E 25E0              ADD     A,ACC
0920 2400        E     ADD     A,#LOW g_meas+0CH
0922 F582              MOV     DPL,A
0924 E4                CLR     A
0925 3400        E     ADDC    A,#HIGH g_meas+0CH
0927 F583              MOV     DPH,A
0929 E0                MOVX    A,@DPTR
092A FC                MOV     R4,A
092B A3                INC     DPTR
092C E0                MOVX    A,@DPTR
092D FD                MOV     R5,A
092E C3                CLR     C
092F EF                MOV     A,R7
0930 9D                SUBB    A,R5
0931 FF                MOV     R7,A
0932 EE                MOV     A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 55  

0933 9C                SUBB    A,R4
0934 FE                MOV     R6,A
0935 33                RLC     A
0936 95E0              SUBB    A,ACC
0938 8F00        R     MOV     curr_error+03H,R7
093A 8E00        R     MOV     curr_error+02H,R6
093C F500        R     MOV     curr_error+01H,A
093E F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 728
0940 E500        R     MOV     A,index
0942 25E0              ADD     A,ACC
0944 25E0              ADD     A,ACC
0946 2400        R     ADD     A,#LOW curr_error_sum
0948 F582              MOV     DPL,A
094A E4                CLR     A
094B 3400        R     ADDC    A,#HIGH curr_error_sum
094D F583              MOV     DPH,A
094F C083              PUSH    DPH
0951 C082              PUSH    DPL
0953 E0                MOVX    A,@DPTR
0954 FC                MOV     R4,A
0955 A3                INC     DPTR
0956 E0                MOVX    A,@DPTR
0957 FD                MOV     R5,A
0958 A3                INC     DPTR
0959 E0                MOVX    A,@DPTR
095A FE                MOV     R6,A
095B A3                INC     DPTR
095C E0                MOVX    A,@DPTR
095D 2500        R     ADD     A,curr_error+03H
095F FF                MOV     R7,A
0960 EE                MOV     A,R6
0961 3500        R     ADDC    A,curr_error+02H
0963 FE                MOV     R6,A
0964 ED                MOV     A,R5
0965 3500        R     ADDC    A,curr_error+01H
0967 FD                MOV     R5,A
0968 EC                MOV     A,R4
0969 3500        R     ADDC    A,curr_error
096B FC                MOV     R4,A
096C D082              POP     DPL
096E D083              POP     DPH
0970 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 731
0973 E500        R     MOV     A,index
0975 25E0              ADD     A,ACC
0977 25E0              ADD     A,ACC
0979 2400        R     ADD     A,#LOW curr_error_sum
097B F582              MOV     DPL,A
097D E4                CLR     A
097E 3400        R     ADDC    A,#HIGH curr_error_sum
0980 F583              MOV     DPH,A
0982 E0                MOVX    A,@DPTR
0983 FC                MOV     R4,A
0984 A3                INC     DPTR
0985 E0                MOVX    A,@DPTR
0986 FD                MOV     R5,A
0987 A3                INC     DPTR
0988 E0                MOVX    A,@DPTR
0989 FE                MOV     R6,A
098A A3                INC     DPTR
098B E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 56  

098C FF                MOV     R7,A
098D 7BA0              MOV     R3,#0A0H
098F 7A86              MOV     R2,#086H
0991 7901              MOV     R1,#01H
0993 7800              MOV     R0,#00H
0995 C3                CLR     C
0996 120000      E     LCALL   ?C?SLCMP
0999 501C              JNC     ?C0095
                                           ; SOURCE LINE # 732
099B 7FA0              MOV     R7,#0A0H
099D 7E86              MOV     R6,#086H
099F 7D01              MOV     R5,#01H
09A1 7C00              MOV     R4,#00H
09A3 E500        R     MOV     A,index
09A5 25E0              ADD     A,ACC
09A7 25E0              ADD     A,ACC
09A9 2400        R     ADD     A,#LOW curr_error_sum
09AB F582              MOV     DPL,A
09AD E4                CLR     A
09AE 3400        R     ADDC    A,#HIGH curr_error_sum
09B0 F583              MOV     DPH,A
09B2 120000      E     LCALL   ?C?LSTXDATA
09B5 803C              SJMP    ?C0096
09B7         ?C0095:
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
09B7 E500        R     MOV     A,index
09B9 25E0              ADD     A,ACC
09BB 25E0              ADD     A,ACC
09BD 2400        R     ADD     A,#LOW curr_error_sum
09BF F582              MOV     DPL,A
09C1 E4                CLR     A
09C2 3400        R     ADDC    A,#HIGH curr_error_sum
09C4 F583              MOV     DPH,A
09C6 E0                MOVX    A,@DPTR
09C7 FC                MOV     R4,A
09C8 A3                INC     DPTR
09C9 E0                MOVX    A,@DPTR
09CA FD                MOV     R5,A
09CB A3                INC     DPTR
09CC E0                MOVX    A,@DPTR
09CD FE                MOV     R6,A
09CE A3                INC     DPTR
09CF E0                MOVX    A,@DPTR
09D0 FF                MOV     R7,A
09D1 E4                CLR     A
09D2 FB                MOV     R3,A
09D3 FA                MOV     R2,A
09D4 F9                MOV     R1,A
09D5 F8                MOV     R0,A
09D6 D3                SETB    C
09D7 120000      E     LCALL   ?C?SLCMP
09DA 4017              JC      ?C0096
                                           ; SOURCE LINE # 735
09DC E4                CLR     A
09DD FF                MOV     R7,A
09DE FE                MOV     R6,A
09DF FD                MOV     R5,A
09E0 FC                MOV     R4,A
09E1 E500        R     MOV     A,index
09E3 25E0              ADD     A,ACC
09E5 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 57  

09E7 2400        R     ADD     A,#LOW curr_error_sum
09E9 F582              MOV     DPL,A
09EB E4                CLR     A
09EC 3400        R     ADDC    A,#HIGH curr_error_sum
09EE F583              MOV     DPH,A
09F0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 736
09F3         ?C0096:
                                           ; SOURCE LINE # 739
09F3 E4                CLR     A
09F4 F500        R     MOV     pwm_input+03H,A
09F6 F500        R     MOV     pwm_input+02H,A
09F8 F500        R     MOV     pwm_input+01H,A
09FA F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 742
09FC FF                MOV     R7,A
09FD FE                MOV     R6,A
09FE FD                MOV     R5,A
09FF FC                MOV     R4,A
0A00 AB00        R     MOV     R3,k_p_c+03H
0A02 AA00        R     MOV     R2,k_p_c+02H
0A04 A900        R     MOV     R1,k_p_c+01H
0A06 A800        R     MOV     R0,k_p_c
0A08 C3                CLR     C
0A09 120000      E     LCALL   ?C?SLCMP
0A0C 602C              JZ      ?C0098
                                           ; SOURCE LINE # 743
0A0E AF00        R     MOV     R7,curr_error+03H
0A10 AE00        R     MOV     R6,curr_error+02H
0A12 AD00        R     MOV     R5,curr_error+01H
0A14 AC00        R     MOV     R4,curr_error
0A16 AB00        R     MOV     R3,k_p+03H
0A18 AA00        R     MOV     R2,k_p+02H
0A1A A900        R     MOV     R1,k_p+01H
0A1C A800        R     MOV     R0,k_p
0A1E 120000      E     LCALL   ?C?LMUL
0A21 7810              MOV     R0,#010H
0A23 120000      E     LCALL   ?C?SLSHR
0A26 E500        R     MOV     A,pwm_input+03H
0A28 2F                ADD     A,R7
0A29 F500        R     MOV     pwm_input+03H,A
0A2B E500        R     MOV     A,pwm_input+02H
0A2D 3E                ADDC    A,R6
0A2E F500        R     MOV     pwm_input+02H,A
0A30 E500        R     MOV     A,pwm_input+01H
0A32 3D                ADDC    A,R5
0A33 F500        R     MOV     pwm_input+01H,A
0A35 E500        R     MOV     A,pwm_input
0A37 3C                ADDC    A,R4
0A38 F500        R     MOV     pwm_input,A
0A3A         ?C0098:
                                           ; SOURCE LINE # 747
0A3A E4                CLR     A
0A3B FF                MOV     R7,A
0A3C FE                MOV     R6,A
0A3D FD                MOV     R5,A
0A3E FC                MOV     R4,A
0A3F AB00        R     MOV     R3,k_i_c+03H
0A41 AA00        R     MOV     R2,k_i_c+02H
0A43 A900        R     MOV     R1,k_i_c+01H
0A45 A800        R     MOV     R0,k_i_c
0A47 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 58  

0A48 120000      E     LCALL   ?C?SLCMP
0A4B 603D              JZ      ?C0099
                                           ; SOURCE LINE # 748
0A4D E500        R     MOV     A,index
0A4F 25E0              ADD     A,ACC
0A51 25E0              ADD     A,ACC
0A53 2400        R     ADD     A,#LOW curr_error_sum
0A55 F582              MOV     DPL,A
0A57 E4                CLR     A
0A58 3400        R     ADDC    A,#HIGH curr_error_sum
0A5A F583              MOV     DPH,A
0A5C E0                MOVX    A,@DPTR
0A5D FC                MOV     R4,A
0A5E A3                INC     DPTR
0A5F E0                MOVX    A,@DPTR
0A60 FD                MOV     R5,A
0A61 A3                INC     DPTR
0A62 E0                MOVX    A,@DPTR
0A63 FE                MOV     R6,A
0A64 A3                INC     DPTR
0A65 E0                MOVX    A,@DPTR
0A66 FF                MOV     R7,A
0A67 7806              MOV     R0,#06H
0A69 120000      E     LCALL   ?C?SLSHR
0A6C A800        R     MOV     R0,k_i_c
0A6E 120000      E     LCALL   ?C?LMUL
0A71 780A              MOV     R0,#0AH
0A73 120000      E     LCALL   ?C?SLSHR
0A76 E500        R     MOV     A,pwm_input+03H
0A78 2F                ADD     A,R7
0A79 F500        R     MOV     pwm_input+03H,A
0A7B E500        R     MOV     A,pwm_input+02H
0A7D 3E                ADDC    A,R6
0A7E F500        R     MOV     pwm_input+02H,A
0A80 E500        R     MOV     A,pwm_input+01H
0A82 3D                ADDC    A,R5
0A83 F500        R     MOV     pwm_input+01H,A
0A85 E500        R     MOV     A,pwm_input
0A87 3C                ADDC    A,R4
0A88 F500        R     MOV     pwm_input,A
0A8A         ?C0099:
                                           ; SOURCE LINE # 751
0A8A E4                CLR     A
0A8B FF                MOV     R7,A
0A8C FE                MOV     R6,A
0A8D FD                MOV     R5,A
0A8E FC                MOV     R4,A
0A8F AB00        R     MOV     R3,k_d_c+03H
0A91 AA00        R     MOV     R2,k_d_c+02H
0A93 A900        R     MOV     R1,k_d_c+01H
0A95 A800        R     MOV     R0,k_d_c
0A97 C3                CLR     C
0A98 120000      E     LCALL   ?C?SLCMP
0A9B 6064              JZ      ?C0100
                                           ; SOURCE LINE # 752
0A9D E500        R     MOV     A,index
0A9F 25E0              ADD     A,ACC
0AA1 2400        E     ADD     A,#LOW g_meas+0CH
0AA3 F582              MOV     DPL,A
0AA5 E4                CLR     A
0AA6 3400        E     ADDC    A,#HIGH g_meas+0CH
0AA8 F583              MOV     DPH,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 59  

0AAA E0                MOVX    A,@DPTR
0AAB FE                MOV     R6,A
0AAC A3                INC     DPTR
0AAD E0                MOVX    A,@DPTR
0AAE FF                MOV     R7,A
0AAF FB                MOV     R3,A
0AB0 AA06              MOV     R2,AR6
0AB2 EA                MOV     A,R2
0AB3 33                RLC     A
0AB4 95E0              SUBB    A,ACC
0AB6 F9                MOV     R1,A
0AB7 F8                MOV     R0,A
0AB8 E500        R     MOV     A,index
0ABA 25E0              ADD     A,ACC
0ABC 25E0              ADD     A,ACC
0ABE 2400        R     ADD     A,#LOW prev_curr
0AC0 F582              MOV     DPL,A
0AC2 E4                CLR     A
0AC3 3400        R     ADDC    A,#HIGH prev_curr
0AC5 F583              MOV     DPH,A
0AC7 E0                MOVX    A,@DPTR
0AC8 FC                MOV     R4,A
0AC9 A3                INC     DPTR
0ACA E0                MOVX    A,@DPTR
0ACB FD                MOV     R5,A
0ACC A3                INC     DPTR
0ACD E0                MOVX    A,@DPTR
0ACE FE                MOV     R6,A
0ACF A3                INC     DPTR
0AD0 E0                MOVX    A,@DPTR
0AD1 C3                CLR     C
0AD2 9B                SUBB    A,R3
0AD3 FF                MOV     R7,A
0AD4 EE                MOV     A,R6
0AD5 9A                SUBB    A,R2
0AD6 FE                MOV     R6,A
0AD7 ED                MOV     A,R5
0AD8 99                SUBB    A,R1
0AD9 FD                MOV     R5,A
0ADA EC                MOV     A,R4
0ADB 98                SUBB    A,R0
0ADC FC                MOV     R4,A
0ADD AB00        R     MOV     R3,k_d_c+03H
0ADF AA00        R     MOV     R2,k_d_c+02H
0AE1 A900        R     MOV     R1,k_d_c+01H
0AE3 A800        R     MOV     R0,k_d_c
0AE5 120000      E     LCALL   ?C?LMUL
0AE8 7810              MOV     R0,#010H
0AEA 120000      E     LCALL   ?C?SLSHR
0AED E500        R     MOV     A,pwm_input+03H
0AEF 2F                ADD     A,R7
0AF0 F500        R     MOV     pwm_input+03H,A
0AF2 E500        R     MOV     A,pwm_input+02H
0AF4 3E                ADDC    A,R6
0AF5 F500        R     MOV     pwm_input+02H,A
0AF7 E500        R     MOV     A,pwm_input+01H
0AF9 3D                ADDC    A,R5
0AFA F500        R     MOV     pwm_input+01H,A
0AFC E500        R     MOV     A,pwm_input
0AFE 3C                ADDC    A,R4
0AFF F500        R     MOV     pwm_input,A
0B01         ?C0100:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 60  

                                           ; SOURCE LINE # 755
0B01 E4                CLR     A
0B02 FF                MOV     R7,A
0B03 FE                MOV     R6,A
0B04 FD                MOV     R5,A
0B05 FC                MOV     R4,A
0B06 AB00        R     MOV     R3,pwm_input+03H
0B08 AA00        R     MOV     R2,pwm_input+02H
0B0A A900        R     MOV     R1,pwm_input+01H
0B0C A800        R     MOV     R0,pwm_input
0B0E C3                CLR     C
0B0F 120000      E     LCALL   ?C?SLCMP
0B12 5009              JNC     ?C0101
                                           ; SOURCE LINE # 756
0B14 E4                CLR     A
0B15 F500        R     MOV     pwm_input+03H,A
0B17 F500        R     MOV     pwm_input+02H,A
0B19 F500        R     MOV     pwm_input+01H,A
0B1B F500        R     MOV     pwm_input,A
0B1D         ?C0101:
                                           ; SOURCE LINE # 759
0B1D E500        R     MOV     A,index
0B1F 25E0              ADD     A,ACC
0B21 2400        E     ADD     A,#LOW g_meas+0CH
0B23 F582              MOV     DPL,A
0B25 E4                CLR     A
0B26 3400        E     ADDC    A,#HIGH g_meas+0CH
0B28 F583              MOV     DPH,A
0B2A E0                MOVX    A,@DPTR
0B2B FE                MOV     R6,A
0B2C A3                INC     DPTR
0B2D E0                MOVX    A,@DPTR
0B2E FF                MOV     R7,A
0B2F EE                MOV     A,R6
0B30 33                RLC     A
0B31 95E0              SUBB    A,ACC
0B33 FD                MOV     R5,A
0B34 FC                MOV     R4,A
0B35 E500        R     MOV     A,index
0B37 25E0              ADD     A,ACC
0B39 25E0              ADD     A,ACC
0B3B 2400        R     ADD     A,#LOW prev_curr
0B3D F582              MOV     DPL,A
0B3F E4                CLR     A
0B40 3400        R     ADDC    A,#HIGH prev_curr
0B42 F583              MOV     DPH,A
0B44 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 761
0B47 E500        R     MOV     A,index
0B49 701C              JNZ     ?C0102
                                           ; SOURCE LINE # 762
0B4B FF                MOV     R7,A
0B4C FE                MOV     R6,A
0B4D FD                MOV     R5,A
0B4E FC                MOV     R4,A
0B4F AB00        R     MOV     R3,pwm_input+03H
0B51 AA00        R     MOV     R2,pwm_input+02H
0B53 A900        R     MOV     R1,pwm_input+01H
0B55 A800        R     MOV     R0,pwm_input
0B57 C3                CLR     C
0B58 120000      E     LCALL   ?C?SLCMP
0B5B 4005              JC      ?C0103
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 61  

                                           ; SOURCE LINE # 763
0B5D D200        R     SETB    dirM0
0B5F 020000      R     LJMP    ?C0044
0B62         ?C0103:
                                           ; SOURCE LINE # 766
0B62 C200        R     CLR     dirM0
                                           ; SOURCE LINE # 768
0B64 020000      R     LJMP    ?C0044
0B67         ?C0102:
                                           ; SOURCE LINE # 769
0B67 E4                CLR     A
0B68 FF                MOV     R7,A
0B69 FE                MOV     R6,A
0B6A FD                MOV     R5,A
0B6B FC                MOV     R4,A
0B6C AB00        R     MOV     R3,pwm_input+03H
0B6E AA00        R     MOV     R2,pwm_input+02H
0B70 A900        R     MOV     R1,pwm_input+01H
0B72 A800        R     MOV     R0,pwm_input
0B74 C3                CLR     C
0B75 120000      E     LCALL   ?C?SLCMP
0B78 4004              JC      ?C0106
                                           ; SOURCE LINE # 770
0B7A D200        R     SETB    dirM1
0B7C 806E              SJMP    ?C0044
0B7E         ?C0106:
                                           ; SOURCE LINE # 773
0B7E C200        R     CLR     dirM1
                                           ; SOURCE LINE # 775
                                           ; SOURCE LINE # 777
0B80 806A              SJMP    ?C0044
                                           ; SOURCE LINE # 779
0B82         ?C0108:
                                           ; SOURCE LINE # 781
0B82 E500        R     MOV     A,index
0B84 25E0              ADD     A,ACC
0B86 25E0              ADD     A,ACC
0B88 2400        E     ADD     A,#LOW g_ref
0B8A F582              MOV     DPL,A
0B8C E4                CLR     A
0B8D 3400        E     ADDC    A,#HIGH g_ref
0B8F F583              MOV     DPH,A
0B91 E0                MOVX    A,@DPTR
0B92 FC                MOV     R4,A
0B93 A3                INC     DPTR
0B94 E0                MOVX    A,@DPTR
0B95 FD                MOV     R5,A
0B96 A3                INC     DPTR
0B97 E0                MOVX    A,@DPTR
0B98 FE                MOV     R6,A
0B99 A3                INC     DPTR
0B9A E0                MOVX    A,@DPTR
0B9B FF                MOV     R7,A
0B9C 7400        E     MOV     A,#LOW g_mem+037H
0B9E 2500        R     ADD     A,index
0BA0 F582              MOV     DPL,A
0BA2 E4                CLR     A
0BA3 3400        E     ADDC    A,#HIGH g_mem+037H
0BA5 F583              MOV     DPH,A
0BA7 E0                MOVX    A,@DPTR
0BA8 F9                MOV     R1,A
0BA9 F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 62  

0BAA 120000      E     LCALL   ?C?SLSHR
0BAD 8F00        R     MOV     pwm_input+03H,R7
0BAF 8E00        R     MOV     pwm_input+02H,R6
0BB1 8D00        R     MOV     pwm_input+01H,R5
0BB3 8C00        R     MOV     pwm_input,R4
                                           ; SOURCE LINE # 783
0BB5 E500        R     MOV     A,index
0BB7 701A              JNZ     ?C0109
                                           ; SOURCE LINE # 784
0BB9 FF                MOV     R7,A
0BBA FE                MOV     R6,A
0BBB FD                MOV     R5,A
0BBC FC                MOV     R4,A
0BBD AB00        R     MOV     R3,pwm_input+03H
0BBF AA00        R     MOV     R2,pwm_input+02H
0BC1 A900        R     MOV     R1,pwm_input+01H
0BC3 A800        R     MOV     R0,pwm_input
0BC5 C3                CLR     C
0BC6 120000      E     LCALL   ?C?SLCMP
0BC9 4004              JC      ?C0110
                                           ; SOURCE LINE # 785
0BCB D200        R     SETB    dirM0
0BCD 801D              SJMP    ?C0044
0BCF         ?C0110:
                                           ; SOURCE LINE # 788
0BCF C200        R     CLR     dirM0
                                           ; SOURCE LINE # 790
0BD1 8019              SJMP    ?C0044
0BD3         ?C0109:
                                           ; SOURCE LINE # 791
0BD3 E4                CLR     A
0BD4 FF                MOV     R7,A
0BD5 FE                MOV     R6,A
0BD6 FD                MOV     R5,A
0BD7 FC                MOV     R4,A
0BD8 AB00        R     MOV     R3,pwm_input+03H
0BDA AA00        R     MOV     R2,pwm_input+02H
0BDC A900        R     MOV     R1,pwm_input+01H
0BDE A800        R     MOV     R0,pwm_input
0BE0 C3                CLR     C
0BE1 120000      E     LCALL   ?C?SLCMP
0BE4 4004              JC      ?C0113
                                           ; SOURCE LINE # 792
0BE6 D200        R     SETB    dirM1
0BE8 8002              SJMP    ?C0044
0BEA         ?C0113:
                                           ; SOURCE LINE # 795
0BEA C200        R     CLR     dirM1
                                           ; SOURCE LINE # 797
                                           ; SOURCE LINE # 799
                                           ; SOURCE LINE # 801
                                           ; SOURCE LINE # 802
                                           ; SOURCE LINE # 803
0BEC         ?C0044:
                                           ; SOURCE LINE # 805
0BEC 300005            JNB     interrupt_flag,?C0116
                                           ; SOURCE LINE # 806
0BEF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 807
0BF1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 808
0BF4         ?C0116:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 63  

                                           ; SOURCE LINE # 811
0BF4 E4                CLR     A
0BF5 7F64              MOV     R7,#064H
0BF7 FE                MOV     R6,A
0BF8 FD                MOV     R5,A
0BF9 FC                MOV     R4,A
0BFA AB00        R     MOV     R3,pwm_input+03H
0BFC AA00        R     MOV     R2,pwm_input+02H
0BFE A900        R     MOV     R1,pwm_input+01H
0C00 A800        R     MOV     R0,pwm_input
0C02 D3                SETB    C
0C03 120000      E     LCALL   ?C?SLCMP
0C06 400A              JC      ?C0117
                                           ; SOURCE LINE # 812
0C08 E4                CLR     A
0C09 750064      R     MOV     pwm_input+03H,#064H
0C0C F500        R     MOV     pwm_input+02H,A
0C0E F500        R     MOV     pwm_input+01H,A
0C10 F500        R     MOV     pwm_input,A
0C12         ?C0117:
                                           ; SOURCE LINE # 813
0C12 74FF              MOV     A,#0FFH
0C14 7F9C              MOV     R7,#09CH
0C16 FE                MOV     R6,A
0C17 FD                MOV     R5,A
0C18 FC                MOV     R4,A
0C19 AB00        R     MOV     R3,pwm_input+03H
0C1B AA00        R     MOV     R2,pwm_input+02H
0C1D A900        R     MOV     R1,pwm_input+01H
0C1F A800        R     MOV     R0,pwm_input
0C21 C3                CLR     C
0C22 120000      E     LCALL   ?C?SLCMP
0C25 500B              JNC     ?C0118
                                           ; SOURCE LINE # 814
0C27 74FF              MOV     A,#0FFH
0C29 75009C      R     MOV     pwm_input+03H,#09CH
0C2C F500        R     MOV     pwm_input+02H,A
0C2E F500        R     MOV     pwm_input+01H,A
0C30 F500        R     MOV     pwm_input,A
0C32         ?C0118:
                                           ; SOURCE LINE # 816
0C32 300005            JNB     interrupt_flag,?C0119
                                           ; SOURCE LINE # 817
0C35 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 818
0C37 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 819
0C3A         ?C0119:
                                           ; SOURCE LINE # 822
0C3A 900000      E     MOV     DPTR,#c_mem+036H
0C3D E0                MOVX    A,@DPTR
0C3E 6401              XRL     A,#01H
0C40 6037              JZ      ?C0120
                                           ; SOURCE LINE # 823
0C42 AF00        R     MOV     R7,pwm_input+03H
0C44 AE00        R     MOV     R6,pwm_input+02H
0C46 AD00        R     MOV     R5,pwm_input+01H
0C48 AC00        R     MOV     R4,pwm_input
0C4A 780A              MOV     R0,#0AH
0C4C 120000      E     LCALL   ?C?LSHL
0C4F E4                CLR     A
0C50 7B64              MOV     R3,#064H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 64  

0C52 FA                MOV     R2,A
0C53 F9                MOV     R1,A
0C54 F8                MOV     R0,A
0C55 120000      E     LCALL   ?C?SLDIV
0C58 A804              MOV     R0,AR4
0C5A A905              MOV     R1,AR5
0C5C AA06              MOV     R2,AR6
0C5E AB07              MOV     R3,AR7
0C60 900000      E     MOV     DPTR,#dev_pwm_limit
0C63 E0                MOVX    A,@DPTR
0C64 FF                MOV     R7,A
0C65 E4                CLR     A
0C66 FC                MOV     R4,A
0C67 FD                MOV     R5,A
0C68 FE                MOV     R6,A
0C69 120000      E     LCALL   ?C?LMUL
0C6C 780A              MOV     R0,#0AH
0C6E 120000      E     LCALL   ?C?SLSHR
0C71 8F00        R     MOV     pwm_input+03H,R7
0C73 8E00        R     MOV     pwm_input+02H,R6
0C75 8D00        R     MOV     pwm_input+01H,R5
0C77 8C00        R     MOV     pwm_input,R4
0C79         ?C0120:
                                           ; SOURCE LINE # 827
0C79 300011            JNB     dirM0,?C0121
                                           ; SOURCE LINE # 828
0C7C 300007            JNB     dirM1,?C0122
                                           ; SOURCE LINE # 829
0C7F 7F03              MOV     R7,#03H
0C81 120000      E     LCALL   _MOTOR_DIR_Write
0C84 8016              SJMP    ?C0124
0C86         ?C0122:
                                           ; SOURCE LINE # 831
0C86 7F01              MOV     R7,#01H
0C88 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 832
0C8B 800F              SJMP    ?C0124
0C8D         ?C0121:
                                           ; SOURCE LINE # 833
                                           ; SOURCE LINE # 834
0C8D 300007            JNB     dirM1,?C0125
                                           ; SOURCE LINE # 835
0C90 7F02              MOV     R7,#02H
0C92 120000      E     LCALL   _MOTOR_DIR_Write
0C95 8005              SJMP    ?C0124
0C97         ?C0125:
                                           ; SOURCE LINE # 837
0C97 E4                CLR     A
0C98 FF                MOV     R7,A
0C99 120000      E     LCALL   _MOTOR_DIR_Write
                                           ; SOURCE LINE # 838
0C9C         ?C0124:
                                           ; SOURCE LINE # 840
0C9C 300005            JNB     interrupt_flag,?C0127
                                           ; SOURCE LINE # 841
0C9F C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 842
0CA1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 843
0CA4         ?C0127:
                                           ; SOURCE LINE # 845
0CA4 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 65  

0CA6 7046              JNZ     ?C0128
                                           ; SOURCE LINE # 846
0CA8 FF                MOV     R7,A
0CA9 FE                MOV     R6,A
0CAA FD                MOV     R5,A
0CAB FC                MOV     R4,A
0CAC AB00        R     MOV     R3,pwm_input+03H
0CAE AA00        R     MOV     R2,pwm_input+02H
0CB0 A900        R     MOV     R1,pwm_input+01H
0CB2 A800        R     MOV     R0,pwm_input
0CB4 D3                SETB    C
0CB5 120000      E     LCALL   ?C?SLCMP
0CB8 4006              JC      ?C0129
0CBA 7E00              MOV     R6,#00H
0CBC 7F01              MOV     R7,#01H
0CBE 801D              SJMP    ?C0130
0CC0         ?C0129:
0CC0 E4                CLR     A
0CC1 FF                MOV     R7,A
0CC2 FE                MOV     R6,A
0CC3 FD                MOV     R5,A
0CC4 FC                MOV     R4,A
0CC5 AB00        R     MOV     R3,pwm_input+03H
0CC7 AA00        R     MOV     R2,pwm_input+02H
0CC9 A900        R     MOV     R1,pwm_input+01H
0CCB A800        R     MOV     R0,pwm_input
0CCD C3                CLR     C
0CCE 120000      E     LCALL   ?C?SLCMP
0CD1 5006              JNC     ?C0131
0CD3 7EFF              MOV     R6,#0FFH
0CD5 7FFF              MOV     R7,#0FFH
0CD7 8004              SJMP    ?C0132
0CD9         ?C0131:
0CD9 7E00              MOV     R6,#00H
0CDB 7F00              MOV     R7,#00H
0CDD         ?C0132:
0CDD         ?C0130:
0CDD 900000      E     MOV     DPTR,#pwm_sign
0CE0 EF                MOV     A,R7
0CE1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 847
0CE2 AE00        R     MOV     R6,pwm_input+02H
0CE4 AF00        R     MOV     R7,pwm_input+03H
0CE6 120000      E     LCALL   _abs
0CE9 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 848
0CEC 8045              SJMP    ?C0133
0CEE         ?C0128:
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
0CEE E4                CLR     A
0CEF FF                MOV     R7,A
0CF0 FE                MOV     R6,A
0CF1 FD                MOV     R5,A
0CF2 FC                MOV     R4,A
0CF3 AB00        R     MOV     R3,pwm_input+03H
0CF5 AA00        R     MOV     R2,pwm_input+02H
0CF7 A900        R     MOV     R1,pwm_input+01H
0CF9 A800        R     MOV     R0,pwm_input
0CFB D3                SETB    C
0CFC 120000      E     LCALL   ?C?SLCMP
0CFF 4006              JC      ?C0134
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 66  

0D01 7E00              MOV     R6,#00H
0D03 7F01              MOV     R7,#01H
0D05 801D              SJMP    ?C0135
0D07         ?C0134:
0D07 E4                CLR     A
0D08 FF                MOV     R7,A
0D09 FE                MOV     R6,A
0D0A FD                MOV     R5,A
0D0B FC                MOV     R4,A
0D0C AB00        R     MOV     R3,pwm_input+03H
0D0E AA00        R     MOV     R2,pwm_input+02H
0D10 A900        R     MOV     R1,pwm_input+01H
0D12 A800        R     MOV     R0,pwm_input
0D14 C3                CLR     C
0D15 120000      E     LCALL   ?C?SLCMP
0D18 5006              JNC     ?C0136
0D1A 7EFF              MOV     R6,#0FFH
0D1C 7FFF              MOV     R7,#0FFH
0D1E 8004              SJMP    ?C0137
0D20         ?C0136:
0D20 7E00              MOV     R6,#00H
0D22 7F00              MOV     R7,#00H
0D24         ?C0137:
0D24         ?C0135:
0D24 900000      E     MOV     DPTR,#pwm_sign+01H
0D27 EF                MOV     A,R7
0D28 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 851
0D29 AE00        R     MOV     R6,pwm_input+02H
0D2B AF00        R     MOV     R7,pwm_input+03H
0D2D 120000      E     LCALL   _abs
0D30 120000      E     LCALL   _PWM_MOTORS_WriteCompare2
                                           ; SOURCE LINE # 852
0D33         ?C0133:
                                           ; SOURCE LINE # 854
0D33 300005            JNB     interrupt_flag,?C0043
                                           ; SOURCE LINE # 855
0D36 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 856
0D38 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 857
                                           ; SOURCE LINE # 858
0D3B         ?C0043:
0D3B 22                RET     
             ; FUNCTION _motor_control (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 864
0000         ?C0139:
                                           ; SOURCE LINE # 885
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0140
                                           ; SOURCE LINE # 886
0006 3000F7            JNB     interrupt_flag,?C0139
                                           ; SOURCE LINE # 887
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 888
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 889
                                           ; SOURCE LINE # 890
000E 80F0              SJMP    ?C0139
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 67  

0010         ?C0140:
                                           ; SOURCE LINE # 893
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 895
0038 300005            JNB     interrupt_flag,?C0142
                                           ; SOURCE LINE # 896
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 897
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 898
0040         ?C0142:
                                           ; SOURCE LINE # 902
0040 E4                CLR     A
0041 FF                MOV     R7,A
0042 FE                MOV     R6,A
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      E     MOV     DPTR,#dev_tension
0048 E0                MOVX    A,@DPTR
0049 F8                MOV     R0,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C F9                MOV     R1,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FA                MOV     R2,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FB                MOV     R3,A
0053 D3                SETB    C
0054 120000      E     LCALL   ?C?SLCMP
0057 5003              JNC     $ + 5H
0059 020000      R     LJMP    ?C0143
                                           ; SOURCE LINE # 905
005C 120000      R     LCALL   pwm_limit_search
                                           ; SOURCE LINE # 909
005F 300005            JNB     interrupt_flag,?C0144
                                           ; SOURCE LINE # 910
0062 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 911
0064 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 68  

                                           ; SOURCE LINE # 912
0067         ?C0144:
                                           ; SOURCE LINE # 915
0067 900000      E     MOV     DPTR,#ADC_buf+03H
006A E0                MOVX    A,@DPTR
006B 249A              ADD     A,#09AH
006D FF                MOV     R7,A
006E 900000      E     MOV     DPTR,#ADC_buf+02H
0071 E0                MOVX    A,@DPTR
0072 34F9              ADDC    A,#0F9H
0074 FE                MOV     R6,A
0075 33                RLC     A
0076 95E0              SUBB    A,ACC
0078 FD                MOV     R5,A
0079 FC                MOV     R4,A
007A E4                CLR     A
007B 7BAB              MOV     R3,#0ABH
007D 7A64              MOV     R2,#064H
007F F9                MOV     R1,A
0080 F8                MOV     R0,A
0081 120000      E     LCALL   ?C?LMUL
0084 780D              MOV     R0,#0DH
0086 120000      E     LCALL   ?C?SLSHR
0089 900000      E     MOV     DPTR,#pwm_sign
008C E0                MOVX    A,@DPTR
008D FD                MOV     R5,A
008E 33                RLC     A
008F 95E0              SUBB    A,ACC
0091 FC                MOV     R4,A
0092 120000      E     LCALL   ?C?IMUL
0095 EE                MOV     A,R6
0096 33                RLC     A
0097 95E0              SUBB    A,ACC
0099 FD                MOV     R5,A
009A FC                MOV     R4,A
009B 120000      E     LCALL   _filter_i1
009E 900000      E     MOV     DPTR,#g_meas+0CH
00A1 EE                MOV     A,R6
00A2 F0                MOVX    @DPTR,A
00A3 A3                INC     DPTR
00A4 EF                MOV     A,R7
00A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 919
00A6 300005            JNB     interrupt_flag,?C0145
                                           ; SOURCE LINE # 920
00A9 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 921
00AB 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 922
00AE         ?C0145:
                                           ; SOURCE LINE # 923
00AE 900000      E     MOV     DPTR,#ADC_buf+05H
00B1 E0                MOVX    A,@DPTR
00B2 249A              ADD     A,#09AH
00B4 FF                MOV     R7,A
00B5 900000      E     MOV     DPTR,#ADC_buf+04H
00B8 E0                MOVX    A,@DPTR
00B9 34F9              ADDC    A,#0F9H
00BB FE                MOV     R6,A
00BC 33                RLC     A
00BD 95E0              SUBB    A,ACC
00BF FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 69  

00C0 FC                MOV     R4,A
00C1 E4                CLR     A
00C2 7BAB              MOV     R3,#0ABH
00C4 7A64              MOV     R2,#064H
00C6 F9                MOV     R1,A
00C7 F8                MOV     R0,A
00C8 120000      E     LCALL   ?C?LMUL
00CB 780D              MOV     R0,#0DH
00CD 120000      E     LCALL   ?C?SLSHR
00D0 900000      E     MOV     DPTR,#pwm_sign+01H
00D3 E0                MOVX    A,@DPTR
00D4 FD                MOV     R5,A
00D5 33                RLC     A
00D6 95E0              SUBB    A,ACC
00D8 FC                MOV     R4,A
00D9 120000      E     LCALL   ?C?IMUL
00DC EE                MOV     A,R6
00DD 33                RLC     A
00DE 95E0              SUBB    A,ACC
00E0 FD                MOV     R5,A
00E1 FC                MOV     R4,A
00E2 120000      E     LCALL   _filter_i2
00E5 900000      E     MOV     DPTR,#g_meas+0EH
00E8 EE                MOV     A,R6
00E9 F0                MOVX    @DPTR,A
00EA A3                INC     DPTR
00EB EF                MOV     A,R7
00EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 927
00ED 300011            JNB     interrupt_flag,?C0148
                                           ; SOURCE LINE # 928
00F0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 929
00F2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 930
                                           ; SOURCE LINE # 931
00F5 22                RET     
00F6         ?C0143:
                                           ; SOURCE LINE # 932
                                           ; SOURCE LINE # 933
00F6 E4                CLR     A
00F7 900000      E     MOV     DPTR,#g_meas+0CH
00FA F0                MOVX    @DPTR,A
00FB A3                INC     DPTR
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 934
00FD A3                INC     DPTR
00FE F0                MOVX    @DPTR,A
00FF A3                INC     DPTR
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 935
                                           ; SOURCE LINE # 936
0101         ?C0148:
0101 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 942
0000 900000      R     MOV     DPTR,#flag
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
;---- Variable 'idx' assigned to Register 'R7' ----
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 70  

                                           ; SOURCE LINE # 943
                                           ; SOURCE LINE # 944
0005 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 962
0007 E500        R     MOV     A,index
0009 C3                CLR     C
000A 9403              SUBB    A,#03H
000C 4003              JC      $ + 5H
000E 020000      R     LJMP    ?C0150
0011         ?C0149:
                                           ; SOURCE LINE # 965
0011 300022            JNB     reset_last_value_flag,?C0151
                                           ; SOURCE LINE # 966
;---- Variable 'jj' assigned to Register 'R3' ----
0014 7B03              MOV     R3,#03H
0016         ?C0152:
0016 AF03              MOV     R7,AR3
0018 1B                DEC     R3
0019 EF                MOV     A,R7
001A 6018              JZ      ?C0153
                                           ; SOURCE LINE # 967
001C E4                CLR     A
001D FF                MOV     R7,A
001E FE                MOV     R6,A
001F FD                MOV     R5,A
0020 FC                MOV     R4,A
0021 EB                MOV     A,R3
0022 25E0              ADD     A,ACC
0024 25E0              ADD     A,ACC
0026 2400        R     ADD     A,#LOW last_value_encoder
0028 F582              MOV     DPL,A
002A E4                CLR     A
002B 3400        R     ADDC    A,#HIGH last_value_encoder
002D F583              MOV     DPH,A
002F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 968
0032 80E2              SJMP    ?C0152
0034         ?C0153:
                                           ; SOURCE LINE # 969
0034 C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 970
0036         ?C0151:
                                           ; SOURCE LINE # 973
0036 E500        R     MOV     A,index
0038 7013              JNZ     ?C0154
                                           ; SOURCE LINE # 974
003A 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
003D EF                MOV     A,R7
003E EE                MOV     A,R6
003F ED                MOV     A,R5
0040 5403              ANL     A,#03H
0042 FD                MOV     R5,A
0043 E4                CLR     A
0044 FC                MOV     R4,A
0045 900000      R     MOV     DPTR,#data_encoder
0048 120000      E     LCALL   ?C?LSTXDATA
004B 8041              SJMP    ?C0155
004D         ?C0154:
                                           ; SOURCE LINE # 975
                                           ; SOURCE LINE # 976
004D E500        R     MOV     A,index
004F B40113            CJNE    A,#01H,?C0156
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 71  

                                           ; SOURCE LINE # 977
0052 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0055 EF                MOV     A,R7
0056 EE                MOV     A,R6
0057 ED                MOV     A,R5
0058 5403              ANL     A,#03H
005A FD                MOV     R5,A
005B E4                CLR     A
005C FC                MOV     R4,A
005D 900000      R     MOV     DPTR,#data_encoder
0060 120000      E     LCALL   ?C?LSTXDATA
0063 8029              SJMP    ?C0155
0065         ?C0156:
                                           ; SOURCE LINE # 978
                                           ; SOURCE LINE # 979
0065 E500        R     MOV     A,index
0067 B40213            CJNE    A,#02H,?C0158
                                           ; SOURCE LINE # 980
006A 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
006D EF                MOV     A,R7
006E EE                MOV     A,R6
006F ED                MOV     A,R5
0070 5403              ANL     A,#03H
0072 FD                MOV     R5,A
0073 E4                CLR     A
0074 FC                MOV     R4,A
0075 900000      R     MOV     DPTR,#data_encoder
0078 120000      E     LCALL   ?C?LSTXDATA
007B 8011              SJMP    ?C0155
007D         ?C0158:
                                           ; SOURCE LINE # 982
007D 120000      E     LCALL   SHIFTREG_ENC_4_ReadData
0080 EF                MOV     A,R7
0081 EE                MOV     A,R6
0082 ED                MOV     A,R5
0083 5403              ANL     A,#03H
0085 FD                MOV     R5,A
0086 E4                CLR     A
0087 FC                MOV     R4,A
0088 900000      R     MOV     DPTR,#data_encoder
008B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 983
                                           ; SOURCE LINE # 984
008E         ?C0155:
                                           ; SOURCE LINE # 986
008E 7B01              MOV     R3,#01H
0090 7A00        R     MOV     R2,#HIGH data_encoder
0092 7900        R     MOV     R1,#LOW data_encoder
0094 120000      E     LCALL   _check_enc_data
0097 4003              JC      $ + 5H
0099 020000      R     LJMP    ?C0150
                                           ; SOURCE LINE # 987
009C 900000      R     MOV     DPTR,#flag
009F E0                MOVX    A,@DPTR
00A0 602D              JZ      ?C0161
                                           ; SOURCE LINE # 988
00A2 A3                INC     DPTR
00A3 E0                MOVX    A,@DPTR
00A4 FC                MOV     R4,A
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 72  

00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FE                MOV     R6,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD 54C0              ANL     A,#0C0H
00AF FF                MOV     R7,A
00B0 EE                MOV     A,R6
00B1 ED                MOV     A,R5
00B2 5403              ANL     A,#03H
00B4 FD                MOV     R5,A
00B5 E4                CLR     A
00B6 FC                MOV     R4,A
00B7 7802              MOV     R0,#02H
00B9 120000      E     LCALL   ?C?ULSHR
00BC C3                CLR     C
00BD E4                CLR     A
00BE 9F                SUBB    A,R7
00BF FF                MOV     R7,A
00C0 7480              MOV     A,#080H
00C2 9E                SUBB    A,R6
00C3 FE                MOV     R6,A
00C4 33                RLC     A
00C5 95E0              SUBB    A,ACC
00C7 FD                MOV     R5,A
00C8 FC                MOV     R4,A
00C9 A3                INC     DPTR
00CA 120000      E     LCALL   ?C?LSTXDATA
00CD 804B              SJMP    ?C0162
00CF         ?C0161:
                                           ; SOURCE LINE # 990
00CF 900000      R     MOV     DPTR,#data_encoder
00D2 E0                MOVX    A,@DPTR
00D3 FC                MOV     R4,A
00D4 A3                INC     DPTR
00D5 E0                MOVX    A,@DPTR
00D6 FD                MOV     R5,A
00D7 A3                INC     DPTR
00D8 E0                MOVX    A,@DPTR
00D9 FE                MOV     R6,A
00DA A3                INC     DPTR
00DB E0                MOVX    A,@DPTR
00DC 54C0              ANL     A,#0C0H
00DE FF                MOV     R7,A
00DF EE                MOV     A,R6
00E0 ED                MOV     A,R5
00E1 5403              ANL     A,#03H
00E3 FD                MOV     R5,A
00E4 E4                CLR     A
00E5 FC                MOV     R4,A
00E6 7802              MOV     R0,#02H
00E8 120000      E     LCALL   ?C?ULSHR
00EB C3                CLR     C
00EC E4                CLR     A
00ED 9F                SUBB    A,R7
00EE FB                MOV     R3,A
00EF 7480              MOV     A,#080H
00F1 9E                SUBB    A,R6
00F2 FA                MOV     R2,A
00F3 E500        R     MOV     A,index
00F5 25E0              ADD     A,ACC
00F7 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 73  

00F9 2400        E     ADD     A,#LOW g_mem+03AH
00FB F582              MOV     DPL,A
00FD E4                CLR     A
00FE 3400        E     ADDC    A,#HIGH g_mem+03AH
0100 F583              MOV     DPH,A
0102 E0                MOVX    A,@DPTR
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 A3                INC     DPTR
0106 E0                MOVX    A,@DPTR
0107 FE                MOV     R6,A
0108 A3                INC     DPTR
0109 E0                MOVX    A,@DPTR
010A 2B                ADD     A,R3
010B FF                MOV     R7,A
010C EA                MOV     A,R2
010D 3E                ADDC    A,R6
010E FE                MOV     R6,A
010F 33                RLC     A
0110 95E0              SUBB    A,ACC
0112 FD                MOV     R5,A
0113 FC                MOV     R4,A
0114 900000      R     MOV     DPTR,#value_encoder
0117 120000      E     LCALL   ?C?LSTXDATA
011A         ?C0162:
                                           ; SOURCE LINE # 993
011A 300027            JNB     only_first_time,?C0163
                                           ; SOURCE LINE # 994
011D 900000      R     MOV     DPTR,#value_encoder
0120 E0                MOVX    A,@DPTR
0121 FC                MOV     R4,A
0122 A3                INC     DPTR
0123 E0                MOVX    A,@DPTR
0124 FD                MOV     R5,A
0125 A3                INC     DPTR
0126 E0                MOVX    A,@DPTR
0127 FE                MOV     R6,A
0128 A3                INC     DPTR
0129 E0                MOVX    A,@DPTR
012A FF                MOV     R7,A
012B E500        R     MOV     A,index
012D 25E0              ADD     A,ACC
012F 25E0              ADD     A,ACC
0131 2400        R     ADD     A,#LOW last_value_encoder
0133 F582              MOV     DPL,A
0135 E4                CLR     A
0136 3400        R     ADDC    A,#HIGH last_value_encoder
0138 F583              MOV     DPH,A
013A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 996
013D E500        R     MOV     A,index
013F B40202            CJNE    A,#02H,?C0163
                                           ; SOURCE LINE # 997
0142 C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 998
0144         ?C0163:
                                           ; SOURCE LINE # 1001
0144 E500        R     MOV     A,index
0146 25E0              ADD     A,ACC
0148 25E0              ADD     A,ACC
014A 2400        R     ADD     A,#LOW last_value_encoder
014C F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 74  

014E E4                CLR     A
014F 3400        R     ADDC    A,#HIGH last_value_encoder
0151 F583              MOV     DPH,A
0153 E0                MOVX    A,@DPTR
0154 F8                MOV     R0,A
0155 A3                INC     DPTR
0156 E0                MOVX    A,@DPTR
0157 F9                MOV     R1,A
0158 A3                INC     DPTR
0159 E0                MOVX    A,@DPTR
015A FA                MOV     R2,A
015B A3                INC     DPTR
015C E0                MOVX    A,@DPTR
015D FB                MOV     R3,A
015E 900000      R     MOV     DPTR,#value_encoder
0161 E0                MOVX    A,@DPTR
0162 FC                MOV     R4,A
0163 A3                INC     DPTR
0164 E0                MOVX    A,@DPTR
0165 FD                MOV     R5,A
0166 A3                INC     DPTR
0167 E0                MOVX    A,@DPTR
0168 FE                MOV     R6,A
0169 A3                INC     DPTR
016A E0                MOVX    A,@DPTR
016B C3                CLR     C
016C 9B                SUBB    A,R3
016D FF                MOV     R7,A
016E EE                MOV     A,R6
016F 9A                SUBB    A,R2
0170 FE                MOV     R6,A
0171 ED                MOV     A,R5
0172 99                SUBB    A,R1
0173 FD                MOV     R5,A
0174 EC                MOV     A,R4
0175 98                SUBB    A,R0
0176 FC                MOV     R4,A
0177 A3                INC     DPTR
0178 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1021
017B E4                CLR     A
017C FF                MOV     R7,A
017D 7EC0              MOV     R6,#0C0H
017F FD                MOV     R5,A
0180 FC                MOV     R4,A
0181 900000      R     MOV     DPTR,#aux
0184 E0                MOVX    A,@DPTR
0185 F8                MOV     R0,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 F9                MOV     R1,A
0189 A3                INC     DPTR
018A E0                MOVX    A,@DPTR
018B FA                MOV     R2,A
018C A3                INC     DPTR
018D E0                MOVX    A,@DPTR
018E FB                MOV     R3,A
018F D3                SETB    C
0190 120000      E     LCALL   ?C?SLCMP
0193 4010              JC      ?C0165
                                           ; SOURCE LINE # 1022
0195 7400        E     MOV     A,#LOW g_meas+010H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 75  

0197 2500        R     ADD     A,index
0199 F582              MOV     DPL,A
019B E4                CLR     A
019C 3400        E     ADDC    A,#HIGH g_meas+010H
019E F583              MOV     DPH,A
01A0 E0                MOVX    A,@DPTR
01A1 14                DEC     A
01A2 F0                MOVX    @DPTR,A
01A3 8068              SJMP    ?C0166
01A5         ?C0165:
                                           ; SOURCE LINE # 1023
                                           ; SOURCE LINE # 1024
01A5 7F00              MOV     R7,#00H
01A7 7E40              MOV     R6,#040H
01A9 7DFF              MOV     R5,#0FFH
01AB 7CFF              MOV     R4,#0FFH
01AD 900000      R     MOV     DPTR,#aux
01B0 E0                MOVX    A,@DPTR
01B1 F8                MOV     R0,A
01B2 A3                INC     DPTR
01B3 E0                MOVX    A,@DPTR
01B4 F9                MOV     R1,A
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FA                MOV     R2,A
01B8 A3                INC     DPTR
01B9 E0                MOVX    A,@DPTR
01BA FB                MOV     R3,A
01BB C3                CLR     C
01BC 120000      E     LCALL   ?C?SLCMP
01BF 5010              JNC     ?C0167
                                           ; SOURCE LINE # 1025
01C1 7400        E     MOV     A,#LOW g_meas+010H
01C3 2500        R     ADD     A,index
01C5 F582              MOV     DPL,A
01C7 E4                CLR     A
01C8 3400        E     ADDC    A,#HIGH g_meas+010H
01CA F583              MOV     DPH,A
01CC E0                MOVX    A,@DPTR
01CD 04                INC     A
01CE F0                MOVX    @DPTR,A
01CF 803C              SJMP    ?C0166
01D1         ?C0167:
                                           ; SOURCE LINE # 1026
                                           ; SOURCE LINE # 1027
01D1 900000      R     MOV     DPTR,#aux
01D4 E0                MOVX    A,@DPTR
01D5 A3                INC     DPTR
01D6 E0                MOVX    A,@DPTR
01D7 A3                INC     DPTR
01D8 E0                MOVX    A,@DPTR
01D9 FE                MOV     R6,A
01DA A3                INC     DPTR
01DB E0                MOVX    A,@DPTR
01DC FF                MOV     R7,A
01DD 120000      E     LCALL   _abs
01E0 D3                SETB    C
01E1 EF                MOV     A,R7
01E2 9400              SUBB    A,#00H
01E4 EE                MOV     A,R6
01E5 6480              XRL     A,#080H
01E7 94C0              SUBB    A,#0C0H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 76  

01E9 4022              JC      ?C0166
                                           ; SOURCE LINE # 1028
01EB 7400        R     MOV     A,#LOW error
01ED 2500        R     ADD     A,index
01EF F582              MOV     DPL,A
01F1 E4                CLR     A
01F2 3400        R     ADDC    A,#HIGH error
01F4 F583              MOV     DPH,A
01F6 E0                MOVX    A,@DPTR
01F7 04                INC     A
01F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
01F9 7400        R     MOV     A,#LOW error
01FB 2500        R     ADD     A,index
01FD F582              MOV     DPL,A
01FF E4                CLR     A
0200 3400        R     ADDC    A,#HIGH error
0202 F583              MOV     DPH,A
0204 E0                MOVX    A,@DPTR
0205 C3                CLR     C
0206 940A              SUBB    A,#0AH
0208 5003              JNC     $ + 5H
020A 020000      R     LJMP    ?C0150
020D         ?C0170:
                                           ; SOURCE LINE # 1032
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1034
020D         ?C0166:
                                           ; SOURCE LINE # 1036
020D 7400        R     MOV     A,#LOW error
020F 2500        R     ADD     A,index
0211 F582              MOV     DPL,A
0213 E4                CLR     A
0214 3400        R     ADDC    A,#HIGH error
0216 F583              MOV     DPH,A
0218 E4                CLR     A
0219 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1038
021A 900000      R     MOV     DPTR,#value_encoder
021D E0                MOVX    A,@DPTR
021E FC                MOV     R4,A
021F A3                INC     DPTR
0220 E0                MOVX    A,@DPTR
0221 FD                MOV     R5,A
0222 A3                INC     DPTR
0223 E0                MOVX    A,@DPTR
0224 FE                MOV     R6,A
0225 A3                INC     DPTR
0226 E0                MOVX    A,@DPTR
0227 FF                MOV     R7,A
0228 E500        R     MOV     A,index
022A 25E0              ADD     A,ACC
022C 25E0              ADD     A,ACC
022E 2400        R     ADD     A,#LOW last_value_encoder
0230 F582              MOV     DPL,A
0232 E4                CLR     A
0233 3400        R     ADDC    A,#HIGH last_value_encoder
0235 F583              MOV     DPH,A
0237 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1040
023A 900000      R     MOV     DPTR,#value_encoder
023D E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 77  

023E F8                MOV     R0,A
023F A3                INC     DPTR
0240 E0                MOVX    A,@DPTR
0241 F9                MOV     R1,A
0242 A3                INC     DPTR
0243 E0                MOVX    A,@DPTR
0244 FA                MOV     R2,A
0245 A3                INC     DPTR
0246 E0                MOVX    A,@DPTR
0247 FB                MOV     R3,A
0248 C000              PUSH    AR0
024A 7400        E     MOV     A,#LOW g_meas+010H
024C 2500        R     ADD     A,index
024E F582              MOV     DPL,A
0250 E4                CLR     A
0251 3400        E     ADDC    A,#HIGH g_meas+010H
0253 F583              MOV     DPH,A
0255 E0                MOVX    A,@DPTR
0256 FF                MOV     R7,A
0257 33                RLC     A
0258 95E0              SUBB    A,ACC
025A FE                MOV     R6,A
025B FD                MOV     R5,A
025C FC                MOV     R4,A
025D 7810              MOV     R0,#010H
025F 120000      E     LCALL   ?C?LSHL
0262 D000              POP     AR0
0264 EB                MOV     A,R3
0265 2F                ADD     A,R7
0266 FF                MOV     R7,A
0267 EA                MOV     A,R2
0268 3E                ADDC    A,R6
0269 FE                MOV     R6,A
026A E9                MOV     A,R1
026B 3D                ADDC    A,R5
026C FD                MOV     R5,A
026D E8                MOV     A,R0
026E 3C                ADDC    A,R4
026F FC                MOV     R4,A
0270 900000      R     MOV     DPTR,#value_encoder
0273 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1042
0276 E500        R     MOV     A,index
0278 25E0              ADD     A,ACC
027A 25E0              ADD     A,ACC
027C 2400        E     ADD     A,#LOW c_mem+046H
027E F582              MOV     DPL,A
0280 E4                CLR     A
0281 3400        E     ADDC    A,#HIGH c_mem+046H
0283 F583              MOV     DPH,A
0285 E0                MOVX    A,@DPTR
0286 FC                MOV     R4,A
0287 A3                INC     DPTR
0288 E0                MOVX    A,@DPTR
0289 FD                MOV     R5,A
028A A3                INC     DPTR
028B E0                MOVX    A,@DPTR
028C FE                MOV     R6,A
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F FF                MOV     R7,A
0290 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 78  

0291 FB                MOV     R3,A
0292 FA                MOV     R2,A
0293 7980              MOV     R1,#080H
0295 783F              MOV     R0,#03FH
0297 120000      E     LCALL   ?C?FPCMP3
029A 6038              JZ      ?C0171
                                           ; SOURCE LINE # 1043
029C 900000      R     MOV     DPTR,#value_encoder
029F E0                MOVX    A,@DPTR
02A0 FC                MOV     R4,A
02A1 A3                INC     DPTR
02A2 E0                MOVX    A,@DPTR
02A3 FD                MOV     R5,A
02A4 A3                INC     DPTR
02A5 E0                MOVX    A,@DPTR
02A6 FE                MOV     R6,A
02A7 A3                INC     DPTR
02A8 E0                MOVX    A,@DPTR
02A9 FF                MOV     R7,A
02AA EC                MOV     A,R4
02AB 120000      E     LCALL   ?C?FCASTL
02AE E500        R     MOV     A,index
02B0 25E0              ADD     A,ACC
02B2 25E0              ADD     A,ACC
02B4 2400        E     ADD     A,#LOW c_mem+046H
02B6 F582              MOV     DPL,A
02B8 E4                CLR     A
02B9 3400        E     ADDC    A,#HIGH c_mem+046H
02BB F583              MOV     DPH,A
02BD E0                MOVX    A,@DPTR
02BE F8                MOV     R0,A
02BF A3                INC     DPTR
02C0 E0                MOVX    A,@DPTR
02C1 F9                MOV     R1,A
02C2 A3                INC     DPTR
02C3 E0                MOVX    A,@DPTR
02C4 FA                MOV     R2,A
02C5 A3                INC     DPTR
02C6 E0                MOVX    A,@DPTR
02C7 FB                MOV     R3,A
02C8 120000      E     LCALL   ?C?FPMUL
02CB 120000      E     LCALL   ?C?CASTF
02CE 900000      R     MOV     DPTR,#value_encoder
02D1 120000      E     LCALL   ?C?LSTXDATA
02D4         ?C0171:
                                           ; SOURCE LINE # 1045
02D4 900000      R     MOV     DPTR,#value_encoder
02D7 E0                MOVX    A,@DPTR
02D8 FC                MOV     R4,A
02D9 A3                INC     DPTR
02DA E0                MOVX    A,@DPTR
02DB FD                MOV     R5,A
02DC A3                INC     DPTR
02DD E0                MOVX    A,@DPTR
02DE FE                MOV     R6,A
02DF A3                INC     DPTR
02E0 E0                MOVX    A,@DPTR
02E1 FF                MOV     R7,A
02E2 E500        R     MOV     A,index
02E4 25E0              ADD     A,ACC
02E6 25E0              ADD     A,ACC
02E8 2400        E     ADD     A,#LOW g_meas
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 79  

02EA F582              MOV     DPL,A
02EC E4                CLR     A
02ED 3400        E     ADDC    A,#HIGH g_meas
02EF F583              MOV     DPH,A
02F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1046
                                           ; SOURCE LINE # 1068
02F4         ?C0150:
02F4 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1073
                                           ; SOURCE LINE # 1076
0000 750063      R     MOV     max_tension,#063H
0003 75009C      R     MOV     max_tension+01H,#09CH
                                           ; SOURCE LINE # 1077
0006 750039      R     MOV     max_tension_6v_mod,#039H
0009 75009E      R     MOV     max_tension_6v_mod+01H,#09EH
                                           ; SOURCE LINE # 1079
000C C3                CLR     C
000D 900000      E     MOV     DPTR,#g_mem+084H
0010 E0                MOVX    A,@DPTR
0011 9440              SUBB    A,#040H
0013 900000      E     MOV     DPTR,#g_mem+083H
0016 E0                MOVX    A,@DPTR
0017 941F              SUBB    A,#01FH
0019 507E              JNC     ?C0172
                                           ; SOURCE LINE # 1081
001B AE00        R     MOV     R6,max_tension_6v_mod
001D AF00        R     MOV     R7,max_tension_6v_mod+01H
001F E4                CLR     A
0020 FC                MOV     R4,A
0021 FD                MOV     R5,A
0022 900000      E     MOV     DPTR,#dev_tension
0025 E0                MOVX    A,@DPTR
0026 F8                MOV     R0,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F9                MOV     R1,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FA                MOV     R2,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FB                MOV     R3,A
0030 120000      E     LCALL   ?C?SLCMP
0033 4006              JC      ?C0173
                                           ; SOURCE LINE # 1082
0035 E4                CLR     A
0036 900000      E     MOV     DPTR,#dev_pwm_limit
0039 F0                MOVX    @DPTR,A
003A 22                RET     
003B         ?C0173:
                                           ; SOURCE LINE # 1084
                                           ; SOURCE LINE # 1085
003B 900000      E     MOV     DPTR,#g_mem+083H
003E E0                MOVX    A,@DPTR
003F FE                MOV     R6,A
0040 A3                INC     DPTR
0041 E0                MOVX    A,@DPTR
0042 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 80  

0043 E4                CLR     A
0044 FC                MOV     R4,A
0045 FD                MOV     R5,A
0046 900000      E     MOV     DPTR,#dev_tension
0049 E0                MOVX    A,@DPTR
004A F8                MOV     R0,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D F9                MOV     R1,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 FA                MOV     R2,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FB                MOV     R3,A
0054 C3                CLR     C
0055 120000      E     LCALL   ?C?SLCMP
0058 5007              JNC     ?C0175
                                           ; SOURCE LINE # 1086
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D 7464              MOV     A,#064H
005F F0                MOVX    @DPTR,A
0060 22                RET     
0061         ?C0175:
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1088
0061 900000      E     MOV     DPTR,#g_mem+083H
0064 E0                MOVX    A,@DPTR
0065 FE                MOV     R6,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FF                MOV     R7,A
0069 FB                MOV     R3,A
006A AA06              MOV     R2,AR6
006C E4                CLR     A
006D 900000      E     MOV     DPTR,#dev_tension
0070 E0                MOVX    A,@DPTR
0071 FC                MOV     R4,A
0072 A3                INC     DPTR
0073 E0                MOVX    A,@DPTR
0074 FD                MOV     R5,A
0075 A3                INC     DPTR
0076 E0                MOVX    A,@DPTR
0077 FE                MOV     R6,A
0078 A3                INC     DPTR
0079 E0                MOVX    A,@DPTR
007A C3                CLR     C
007B 9B                SUBB    A,R3
007C FF                MOV     R7,A
007D EE                MOV     A,R6
007E 9A                SUBB    A,R2
007F FE                MOV     R6,A
0080 ED                MOV     A,R5
0081 9400              SUBB    A,#00H
0083 FD                MOV     R5,A
0084 EC                MOV     A,R4
0085 9400              SUBB    A,#00H
0087 FC                MOV     R4,A
0088 7809              MOV     R0,#09H
008A 120000      E     LCALL   ?C?SLSHR
008D 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1089
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 81  

008F EF                MOV     A,R7
0090 900000      R     MOV     DPTR,#hitech_pwm_preload_values_6v
0093 93                MOVC    A,@A+DPTR
0094 900000      E     MOV     DPTR,#dev_pwm_limit
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1090
                                           ; SOURCE LINE # 1091
                                           ; SOURCE LINE # 1092
0098 22                RET     
0099         ?C0172:
                                           ; SOURCE LINE # 1093
                                           ; SOURCE LINE # 1095
0099 AE00        R     MOV     R6,max_tension
009B AF00        R     MOV     R7,max_tension+01H
009D E4                CLR     A
009E FC                MOV     R4,A
009F FD                MOV     R5,A
00A0 900000      E     MOV     DPTR,#dev_tension
00A3 E0                MOVX    A,@DPTR
00A4 F8                MOV     R0,A
00A5 A3                INC     DPTR
00A6 E0                MOVX    A,@DPTR
00A7 F9                MOV     R1,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA FA                MOV     R2,A
00AB A3                INC     DPTR
00AC E0                MOVX    A,@DPTR
00AD FB                MOV     R3,A
00AE D3                SETB    C
00AF 120000      E     LCALL   ?C?SLCMP
00B2 4006              JC      ?C0178
                                           ; SOURCE LINE # 1096
00B4 E4                CLR     A
00B5 900000      E     MOV     DPTR,#dev_pwm_limit
00B8 F0                MOVX    @DPTR,A
00B9 22                RET     
00BA         ?C0178:
                                           ; SOURCE LINE # 1097
                                           ; SOURCE LINE # 1098
00BA 900000      E     MOV     DPTR,#g_mem+083H
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 FF                MOV     R7,A
00C2 E4                CLR     A
00C3 FC                MOV     R4,A
00C4 FD                MOV     R5,A
00C5 900000      E     MOV     DPTR,#dev_tension
00C8 E0                MOVX    A,@DPTR
00C9 F8                MOV     R0,A
00CA A3                INC     DPTR
00CB E0                MOVX    A,@DPTR
00CC F9                MOV     R1,A
00CD A3                INC     DPTR
00CE E0                MOVX    A,@DPTR
00CF FA                MOV     R2,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FB                MOV     R3,A
00D3 C3                CLR     C
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 82  

00D4 120000      E     LCALL   ?C?SLCMP
00D7 5007              JNC     ?C0180
                                           ; SOURCE LINE # 1099
00D9 900000      E     MOV     DPTR,#dev_pwm_limit
00DC 7464              MOV     A,#064H
00DE F0                MOVX    @DPTR,A
00DF 22                RET     
00E0         ?C0180:
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1101
00E0 900000      E     MOV     DPTR,#dev_tension
00E3 E0                MOVX    A,@DPTR
00E4 FC                MOV     R4,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 FD                MOV     R5,A
00E8 A3                INC     DPTR
00E9 E0                MOVX    A,@DPTR
00EA FE                MOV     R6,A
00EB A3                INC     DPTR
00EC E0                MOVX    A,@DPTR
00ED 24C0              ADD     A,#0C0H
00EF FF                MOV     R7,A
00F0 EE                MOV     A,R6
00F1 34E0              ADDC    A,#0E0H
00F3 FE                MOV     R6,A
00F4 ED                MOV     A,R5
00F5 34FF              ADDC    A,#0FFH
00F7 FD                MOV     R5,A
00F8 EC                MOV     A,R4
00F9 34FF              ADDC    A,#0FFH
00FB FC                MOV     R4,A
00FC 7809              MOV     R0,#09H
00FE 120000      E     LCALL   ?C?SLSHR
0101 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1102
0103 C3                CLR     C
0104 900000      E     MOV     DPTR,#g_mem+084H
0107 E0                MOVX    A,@DPTR
0108 94EC              SUBB    A,#0ECH
010A 900000      E     MOV     DPTR,#g_mem+083H
010D E0                MOVX    A,@DPTR
010E 942C              SUBB    A,#02CH
0110 500A              JNC     ?C0182
                                           ; SOURCE LINE # 1103
0112 EF                MOV     A,R7
0113 900000      R     MOV     DPTR,#hitech_pwm_preload_values
0116 93                MOVC    A,@A+DPTR
0117 900000      E     MOV     DPTR,#dev_pwm_limit
011A F0                MOVX    @DPTR,A
011B 22                RET     
011C         ?C0182:
                                           ; SOURCE LINE # 1105
011C E500        R     MOV     A,index
011E 900000      R     MOV     DPTR,#pwm_preload_values
0121 93                MOVC    A,@A+DPTR
0122 900000      E     MOV     DPTR,#dev_pwm_limit
0125 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1106
                                           ; SOURCE LINE # 1107
                                           ; SOURCE LINE # 1108
                                           ; SOURCE LINE # 1109
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 83  

0126         ?C0184:
0126 22                RET     
             ; FUNCTION pwm_limit_search (END)

             ; FUNCTION pretensioning_process (BEGIN)
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1121
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1123
0005 900000      R     MOV     DPTR,#phase
0008 E0                MOVX    A,@DPTR
0009 14                DEC     A
000A 7003              JNZ     $ + 5H
000C 020000      R     LJMP    ?C0189
000F 04                INC     A
0010 6003              JZ      $ + 5H
0012 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1124
0015         ?C0186:
                                           ; SOURCE LINE # 1125
0015 900000      E     MOV     DPTR,#g_meas+0CH
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D C3                CLR     C
001E 74DC              MOV     A,#0DCH
0020 9F                SUBB    A,R7
0021 FF                MOV     R7,A
0022 E4                CLR     A
0023 9E                SUBB    A,R6
0024 FE                MOV     R6,A
0025 7C00              MOV     R4,#00H
0027 7D05              MOV     R5,#05H
0029 120000      E     LCALL   ?C?IMUL
002C 900000      E     MOV     DPTR,#g_mem+037H
002F E0                MOVX    A,@DPTR
0030 FD                MOV     R5,A
0031 EF                MOV     A,R7
0032 A805              MOV     R0,AR5
0034 08                INC     R0
0035 8005              SJMP    ?C0199
0037         ?C0198:
0037 C3                CLR     C
0038 33                RLC     A
0039 CE                XCH     A,R6
003A 33                RLC     A
003B CE                XCH     A,R6
003C         ?C0199:
003C D8F9              DJNZ    R0,?C0198
003E FF                MOV     R7,A
003F EE                MOV     A,R6
0040 33                RLC     A
0041 95E0              SUBB    A,ACC
0043 FD                MOV     R5,A
0044 FC                MOV     R4,A
0045 900000      R     MOV     DPTR,#aux
0048 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1126
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 84  

004B 900000      R     MOV     DPTR,#aux
004E E0                MOVX    A,@DPTR
004F F8                MOV     R0,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 F9                MOV     R1,A
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 FA                MOV     R2,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FB                MOV     R3,A
0059 900000      E     MOV     DPTR,#g_refOld
005C E0                MOVX    A,@DPTR
005D FC                MOV     R4,A
005E A3                INC     DPTR
005F E0                MOVX    A,@DPTR
0060 FD                MOV     R5,A
0061 A3                INC     DPTR
0062 E0                MOVX    A,@DPTR
0063 FE                MOV     R6,A
0064 A3                INC     DPTR
0065 E0                MOVX    A,@DPTR
0066 C3                CLR     C
0067 9B                SUBB    A,R3
0068 FF                MOV     R7,A
0069 EE                MOV     A,R6
006A 9A                SUBB    A,R2
006B FE                MOV     R6,A
006C ED                MOV     A,R5
006D 99                SUBB    A,R1
006E FD                MOV     R5,A
006F EC                MOV     A,R4
0070 98                SUBB    A,R0
0071 FC                MOV     R4,A
0072 900000      E     MOV     DPTR,#g_refNew
0075 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1128
0078 900000      E     MOV     DPTR,#g_meas+0FH
007B E0                MOVX    A,@DPTR
007C 24DC              ADD     A,#0DCH
007E FF                MOV     R7,A
007F 900000      E     MOV     DPTR,#g_meas+0EH
0082 E0                MOVX    A,@DPTR
0083 3400              ADDC    A,#00H
0085 FE                MOV     R6,A
0086 7C00              MOV     R4,#00H
0088 7D05              MOV     R5,#05H
008A 120000      E     LCALL   ?C?IMUL
008D 900000      E     MOV     DPTR,#g_mem+038H
0090 E0                MOVX    A,@DPTR
0091 FD                MOV     R5,A
0092 EF                MOV     A,R7
0093 A805              MOV     R0,AR5
0095 08                INC     R0
0096 8005              SJMP    ?C0201
0098         ?C0200:
0098 C3                CLR     C
0099 33                RLC     A
009A CE                XCH     A,R6
009B 33                RLC     A
009C CE                XCH     A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 85  

009D         ?C0201:
009D D8F9              DJNZ    R0,?C0200
009F FF                MOV     R7,A
00A0 EE                MOV     A,R6
00A1 33                RLC     A
00A2 95E0              SUBB    A,ACC
00A4 FD                MOV     R5,A
00A5 FC                MOV     R4,A
00A6 900000      R     MOV     DPTR,#aux
00A9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1129
00AC 900000      R     MOV     DPTR,#aux
00AF E0                MOVX    A,@DPTR
00B0 FC                MOV     R4,A
00B1 A3                INC     DPTR
00B2 E0                MOVX    A,@DPTR
00B3 FD                MOV     R5,A
00B4 A3                INC     DPTR
00B5 E0                MOVX    A,@DPTR
00B6 FE                MOV     R6,A
00B7 A3                INC     DPTR
00B8 E0                MOVX    A,@DPTR
00B9 FF                MOV     R7,A
00BA 900000      E     MOV     DPTR,#g_refOld+04H
00BD E0                MOVX    A,@DPTR
00BE F8                MOV     R0,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F9                MOV     R1,A
00C2 A3                INC     DPTR
00C3 E0                MOVX    A,@DPTR
00C4 FA                MOV     R2,A
00C5 A3                INC     DPTR
00C6 E0                MOVX    A,@DPTR
00C7 2F                ADD     A,R7
00C8 FF                MOV     R7,A
00C9 EA                MOV     A,R2
00CA 3E                ADDC    A,R6
00CB FE                MOV     R6,A
00CC E9                MOV     A,R1
00CD 3D                ADDC    A,R5
00CE FD                MOV     R5,A
00CF E8                MOV     A,R0
00D0 3C                ADDC    A,R4
00D1 FC                MOV     R4,A
00D2 900000      E     MOV     DPTR,#g_refNew+04H
00D5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1131
00D8 900000      R     MOV     DPTR,#phase_counter
00DB E0                MOVX    A,@DPTR
00DC C3                CLR     C
00DD 940A              SUBB    A,#0AH
00DF 4031              JC      ?C0187
00E1 E4                CLR     A
00E2 FF                MOV     R7,A
00E3 FE                MOV     R6,A
00E4 FD                MOV     R5,A
00E5 FC                MOV     R4,A
00E6 900000      E     MOV     DPTR,#dev_tension
00E9 E0                MOVX    A,@DPTR
00EA F8                MOV     R0,A
00EB A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 86  

00EC E0                MOVX    A,@DPTR
00ED F9                MOV     R1,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 FA                MOV     R2,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 FB                MOV     R3,A
00F4 D3                SETB    C
00F5 120000      E     LCALL   ?C?SLCMP
00F8 5018              JNC     ?C0187
                                           ; SOURCE LINE # 1132
00FA C200        E     CLR     pretensioning_flag
                                           ; SOURCE LINE # 1133
00FC E4                CLR     A
00FD FF                MOV     R7,A
00FE FE                MOV     R6,A
00FF FD                MOV     R5,A
0100 FC                MOV     R4,A
0101 900000      E     MOV     DPTR,#g_refNew
0104 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1134
0107 E4                CLR     A
0108 FF                MOV     R7,A
0109 FE                MOV     R6,A
010A FD                MOV     R5,A
010B FC                MOV     R4,A
010C 900000      E     MOV     DPTR,#g_refNew+04H
010F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1135
0112         ?C0187:
                                           ; SOURCE LINE # 1137
0112 900000      R     MOV     DPTR,#phase_counter
0115 E0                MOVX    A,@DPTR
0116 04                INC     A
0117 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1139
0118 900000      R     MOV     DPTR,#epsilon
011B E0                MOVX    A,@DPTR
011C FE                MOV     R6,A
011D A3                INC     DPTR
011E E0                MOVX    A,@DPTR
011F FF                MOV     R7,A
0120 C3                CLR     C
0121 74DC              MOV     A,#0DCH
0123 9F                SUBB    A,R7
0124 FD                MOV     R5,A
0125 E4                CLR     A
0126 9E                SUBB    A,R6
0127 FC                MOV     R4,A
0128 D3                SETB    C
0129 900000      E     MOV     DPTR,#g_meas+0DH
012C E0                MOVX    A,@DPTR
012D 9D                SUBB    A,R5
012E EC                MOV     A,R4
012F 6480              XRL     A,#080H
0131 F8                MOV     R0,A
0132 900000      E     MOV     DPTR,#g_meas+0CH
0135 E0                MOVX    A,@DPTR
0136 6480              XRL     A,#080H
0138 98                SUBB    A,R0
0139 5003              JNC     $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 87  

013B 020000      R     LJMP    ?C0195
013E EF                MOV     A,R7
013F 2424              ADD     A,#024H
0141 FF                MOV     R7,A
0142 EE                MOV     A,R6
0143 34FF              ADDC    A,#0FFH
0145 FE                MOV     R6,A
0146 C3                CLR     C
0147 900000      E     MOV     DPTR,#g_meas+0FH
014A E0                MOVX    A,@DPTR
014B 9F                SUBB    A,R7
014C EE                MOV     A,R6
014D 6480              XRL     A,#080H
014F F8                MOV     R0,A
0150 900000      E     MOV     DPTR,#g_meas+0EH
0153 E0                MOVX    A,@DPTR
0154 6480              XRL     A,#080H
0156 98                SUBB    A,R0
0157 4003              JC      $ + 5H
0159 020000      R     LJMP    ?C0195
                                           ; SOURCE LINE # 1140
015C 900000      R     MOV     DPTR,#phase
015F 7401              MOV     A,#01H
0161 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1141
0162 E4                CLR     A
0163 A3                INC     DPTR
0164 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1144
                                           ; SOURCE LINE # 1145
0165 22                RET     
                                           ; SOURCE LINE # 1146
0166         ?C0189:
                                           ; SOURCE LINE # 1148
0166 900000      E     MOV     DPTR,#g_mem+037H
0169 E0                MOVX    A,@DPTR
016A FF                MOV     R7,A
016B 7410              MOV     A,#010H
016D 7E00              MOV     R6,#00H
016F A807              MOV     R0,AR7
0171 08                INC     R0
0172 8005              SJMP    ?C0203
0174         ?C0202:
0174 C3                CLR     C
0175 33                RLC     A
0176 CE                XCH     A,R6
0177 33                RLC     A
0178 CE                XCH     A,R6
0179         ?C0203:
0179 D8F9              DJNZ    R0,?C0202
017B FF                MOV     R7,A
017C EE                MOV     A,R6
017D 33                RLC     A
017E 95E0              SUBB    A,ACC
0180 FD                MOV     R5,A
0181 FC                MOV     R4,A
0182 900000      R     MOV     DPTR,#aux
0185 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1149
0188 900000      R     MOV     DPTR,#aux
018B E0                MOVX    A,@DPTR
018C FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 88  

018D A3                INC     DPTR
018E E0                MOVX    A,@DPTR
018F FD                MOV     R5,A
0190 A3                INC     DPTR
0191 E0                MOVX    A,@DPTR
0192 FE                MOV     R6,A
0193 A3                INC     DPTR
0194 E0                MOVX    A,@DPTR
0195 FF                MOV     R7,A
0196 900000      E     MOV     DPTR,#g_refOld
0199 E0                MOVX    A,@DPTR
019A F8                MOV     R0,A
019B A3                INC     DPTR
019C E0                MOVX    A,@DPTR
019D F9                MOV     R1,A
019E A3                INC     DPTR
019F E0                MOVX    A,@DPTR
01A0 FA                MOV     R2,A
01A1 A3                INC     DPTR
01A2 E0                MOVX    A,@DPTR
01A3 2F                ADD     A,R7
01A4 FF                MOV     R7,A
01A5 EA                MOV     A,R2
01A6 3E                ADDC    A,R6
01A7 FE                MOV     R6,A
01A8 E9                MOV     A,R1
01A9 3D                ADDC    A,R5
01AA FD                MOV     R5,A
01AB E8                MOV     A,R0
01AC 3C                ADDC    A,R4
01AD FC                MOV     R4,A
01AE 900000      E     MOV     DPTR,#g_refNew
01B1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1151
01B4 900000      E     MOV     DPTR,#g_mem+038H
01B7 E0                MOVX    A,@DPTR
01B8 FF                MOV     R7,A
01B9 7410              MOV     A,#010H
01BB 7E00              MOV     R6,#00H
01BD A807              MOV     R0,AR7
01BF 08                INC     R0
01C0 8005              SJMP    ?C0205
01C2         ?C0204:
01C2 C3                CLR     C
01C3 33                RLC     A
01C4 CE                XCH     A,R6
01C5 33                RLC     A
01C6 CE                XCH     A,R6
01C7         ?C0205:
01C7 D8F9              DJNZ    R0,?C0204
01C9 FF                MOV     R7,A
01CA EE                MOV     A,R6
01CB 33                RLC     A
01CC 95E0              SUBB    A,ACC
01CE FD                MOV     R5,A
01CF FC                MOV     R4,A
01D0 900000      R     MOV     DPTR,#aux
01D3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1152
01D6 900000      R     MOV     DPTR,#aux
01D9 E0                MOVX    A,@DPTR
01DA F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 89  

01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD F9                MOV     R1,A
01DE A3                INC     DPTR
01DF E0                MOVX    A,@DPTR
01E0 FA                MOV     R2,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FB                MOV     R3,A
01E4 900000      E     MOV     DPTR,#g_refOld+04H
01E7 E0                MOVX    A,@DPTR
01E8 FC                MOV     R4,A
01E9 A3                INC     DPTR
01EA E0                MOVX    A,@DPTR
01EB FD                MOV     R5,A
01EC A3                INC     DPTR
01ED E0                MOVX    A,@DPTR
01EE FE                MOV     R6,A
01EF A3                INC     DPTR
01F0 E0                MOVX    A,@DPTR
01F1 C3                CLR     C
01F2 9B                SUBB    A,R3
01F3 FF                MOV     R7,A
01F4 EE                MOV     A,R6
01F5 9A                SUBB    A,R2
01F6 FE                MOV     R6,A
01F7 ED                MOV     A,R5
01F8 99                SUBB    A,R1
01F9 FD                MOV     R5,A
01FA EC                MOV     A,R4
01FB 98                SUBB    A,R0
01FC FC                MOV     R4,A
01FD 900000      E     MOV     DPTR,#g_refNew+04H
0200 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1154
0203 900000      R     MOV     DPTR,#phase_counter
0206 E0                MOVX    A,@DPTR
0207 D3                SETB    C
0208 9450              SUBB    A,#050H
020A 404B              JC      ?C0190
                                           ; SOURCE LINE # 1155
020C C200        E     CLR     pretensioning_flag
                                           ; SOURCE LINE # 1156
020E D200        E     SETB    pret_done
                                           ; SOURCE LINE # 1157
0210 E4                CLR     A
0211 900000      R     MOV     DPTR,#phase
0214 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1158
0215 D200        E     SETB    reset_last_value_flag
                                           ; SOURCE LINE # 1159
0217 900000      R     MOV     DPTR,#i
021A F0                MOVX    @DPTR,A
021B         ?C0191:
021B 900000      R     MOV     DPTR,#i
021E E0                MOVX    A,@DPTR
021F FB                MOV     R3,A
0220 C3                CLR     C
0221 9403              SUBB    A,#03H
0223 5032              JNC     ?C0190
                                           ; SOURCE LINE # 1160
0225 EB                MOV     A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 90  

0226 25E0              ADD     A,ACC
0228 25E0              ADD     A,ACC
022A 2400        E     ADD     A,#LOW g_refNew
022C F582              MOV     DPL,A
022E E4                CLR     A
022F 3400        E     ADDC    A,#HIGH g_refNew
0231 F583              MOV     DPH,A
0233 E0                MOVX    A,@DPTR
0234 FC                MOV     R4,A
0235 A3                INC     DPTR
0236 E0                MOVX    A,@DPTR
0237 FD                MOV     R5,A
0238 A3                INC     DPTR
0239 E0                MOVX    A,@DPTR
023A FE                MOV     R6,A
023B A3                INC     DPTR
023C E0                MOVX    A,@DPTR
023D FF                MOV     R7,A
023E EB                MOV     A,R3
023F 25E0              ADD     A,ACC
0241 25E0              ADD     A,ACC
0243 2400        E     ADD     A,#LOW pret_offset_pos
0245 F582              MOV     DPL,A
0247 E4                CLR     A
0248 3400        E     ADDC    A,#HIGH pret_offset_pos
024A F583              MOV     DPH,A
024C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1167
024F 900000      R     MOV     DPTR,#i
0252 E0                MOVX    A,@DPTR
0253 04                INC     A
0254 F0                MOVX    @DPTR,A
0255 80C4              SJMP    ?C0191
                                           ; SOURCE LINE # 1179
0257         ?C0190:
                                           ; SOURCE LINE # 1181
0257 900000      R     MOV     DPTR,#phase_counter
025A E0                MOVX    A,@DPTR
025B 04                INC     A
025C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1182
                                           ; SOURCE LINE # 1183
                                           ; SOURCE LINE # 1184
                                           ; SOURCE LINE # 1185
                                           ; SOURCE LINE # 1186
025D         ?C0195:
025D 22                RET     
             ; FUNCTION pretensioning_process (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5869    ----
   CONSTANT SIZE    =     97    ----
   XDATA SIZE       =    173      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6      73
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/19/2018 16:15:14 PAGE 91  

   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
